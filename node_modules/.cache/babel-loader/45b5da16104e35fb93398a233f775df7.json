{"ast":null,"code":"var _toConsumableArray = require(\"/home/jeff/bobawedding/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/toConsumableArray\");\nvar _objectSpread = require(\"/home/jeff/bobawedding/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/objectSpread\");\nvar isDisjoint = require('../help/is_disjoint');\nvar base64url = require('../help/base64url');\nvar validateCrit = require('../help/validate_crit');\nvar _require = require('../errors'),\n  JWEInvalid = _require.JWEInvalid,\n  JOSENotSupported = _require.JOSENotSupported;\nvalidateCrit = validateCrit.bind(undefined, JWEInvalid);\nmodule.exports = function (prot, unprotected, recipients, checkAlgorithms, crit) {\n  if (typeof prot === 'string') {\n    try {\n      prot = base64url.JSON.decode(prot);\n    } catch (err) {\n      throw new JWEInvalid('could not parse JWE protected header');\n    }\n  }\n  var alg = [];\n  var enc = new Set();\n  if (!isDisjoint(prot, unprotected) || !recipients.every(function (_ref) {\n    var header = _ref.header;\n    if (typeof header === 'object') {\n      alg.push(header.alg);\n      enc.add(header.enc);\n    }\n    var combined = _objectSpread({}, unprotected, header);\n    validateCrit(prot, combined, crit);\n    if ('zip' in combined) {\n      throw new JWEInvalid('\"zip\" Header Parameter MUST be integrity protected');\n    } else if (prot && 'zip' in prot && prot.zip !== 'DEF') {\n      throw new JOSENotSupported('only \"DEF\" compression algorithm is supported');\n    }\n    return isDisjoint(header, prot) && isDisjoint(header, unprotected);\n  })) {\n    throw new JWEInvalid('JWE Shared Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint');\n  }\n  if (typeof prot === 'object') {\n    alg.push(prot.alg);\n    enc.add(prot.enc);\n  }\n  if (typeof unprotected === 'object') {\n    alg.push(unprotected.alg);\n    enc.add(unprotected.enc);\n  }\n  alg = alg.filter(Boolean);\n  enc.delete(undefined);\n  if (recipients.length !== 1) {\n    if (alg.includes('dir') || alg.includes('ECDH-ES')) {\n      throw new JWEInvalid('dir and ECDH-ES alg may only be used with a single recipient');\n    }\n  }\n  if (checkAlgorithms) {\n    if (alg.length !== recipients.length) {\n      throw new JWEInvalid('missing Key Management algorithm');\n    }\n    if (enc.size === 0) {\n      throw new JWEInvalid('missing Content Encryption algorithm');\n    } else if (enc.size !== 1) {\n      throw new JWEInvalid('there must only be one Content Encryption algorithm');\n    }\n  } else {\n    if (enc.size > 1) {\n      throw new JWEInvalid('there must only be one Content Encryption algorithm');\n    }\n  }\n  return _toConsumableArray(enc)[0];\n};","map":null,"metadata":{},"sourceType":"script"}