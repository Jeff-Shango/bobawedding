{"ast":null,"code":"var debug = require('../lib/debug')('attemptSilentLogin');\nvar COOKIES = require('../lib/cookies');\nvar weakRef = require('../lib/weakCache');\nvar COOKIE_NAME = 'skipSilentLogin';\nvar cancelSilentLogin = function cancelSilentLogin(req, res) {\n  var _weakRef = weakRef(req.oidc),\n    _weakRef$config$sessi = _weakRef.config.session.cookie,\n    secure = _weakRef$config$sessi.secure,\n    domain = _weakRef$config$sessi.domain,\n    path = _weakRef$config$sessi.path,\n    sameSite = _weakRef$config$sessi.sameSite;\n  res.cookie(COOKIE_NAME, true, {\n    httpOnly: true,\n    secure: secure,\n    domain: domain,\n    path: path,\n    sameSite: sameSite\n  });\n};\nvar resumeSilentLogin = function resumeSilentLogin(req, res) {\n  var _weakRef2 = weakRef(req.oidc),\n    _weakRef2$config$sess = _weakRef2.config.session.cookie,\n    domain = _weakRef2$config$sess.domain,\n    path = _weakRef2$config$sess.path,\n    sameSite = _weakRef2$config$sess.sameSite,\n    secure = _weakRef2$config$sess.secure;\n  res.clearCookie(COOKIE_NAME, {\n    httpOnly: true,\n    domain: domain,\n    path: path,\n    sameSite: sameSite,\n    secure: secure\n  });\n};\nmodule.exports = function attemptSilentLogin() {\n  return function (req, res, next) {\n    if (!req.oidc) {\n      next(new Error('req.oidc is not found, did you include the auth middleware?'));\n      return;\n    }\n    var silentLoginAttempted = !!(req[COOKIES] || {})[COOKIE_NAME];\n    if (!silentLoginAttempted && !req.oidc.isAuthenticated() && req.accepts('html')) {\n      debug('Attempting silent login');\n      cancelSilentLogin(req, res);\n      return res.oidc.silentLogin();\n    }\n    next();\n  };\n};\nmodule.exports.cancelSilentLogin = cancelSilentLogin;\nmodule.exports.resumeSilentLogin = resumeSilentLogin;","map":null,"metadata":{},"sourceType":"script"}