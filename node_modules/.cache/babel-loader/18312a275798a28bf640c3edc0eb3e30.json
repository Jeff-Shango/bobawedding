{"ast":null,"code":"\"use strict\";\n\nimport _objectSpread from \"/home/jeff/bobawedding/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"/home/jeff/bobawedding/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/jeff/bobawedding/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/jeff/bobawedding/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = \"function\" == typeof Symbol ? Symbol : {}, a = i.iterator || \"@@iterator\", c = i.asyncIterator || \"@@asyncIterator\", u = i.toStringTag || \"@@toStringTag\"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, \"\"); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, \"_invoke\", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: \"normal\", arg: t.call(e, r) }; } catch (t) { return { type: \"throw\", arg: t }; } } e.wrap = wrap; var h = \"suspendedStart\", l = \"suspendedYield\", f = \"executing\", s = \"completed\", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { [\"next\", \"throw\", \"return\"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if (\"throw\" !== c.type) { var u = c.arg, h = u.value; return h && \"object\" == typeof h && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) { invoke(\"next\", t, i, a); }, function (t) { invoke(\"throw\", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke(\"throw\", t, i, a); }); } a(c.arg); } var r; o(this, \"_invoke\", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw new Error(\"Generator is already running\"); if (o === s) { if (\"throw\" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else \"return\" === n.method && n.abrupt(\"return\", n.arg); o = f; var p = tryCatch(e, r, n); if (\"normal\" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, \"throw\" === n && e.iterator.return && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y; var i = tryCatch(o, e.iterator, r.arg); if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = \"normal\", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: \"root\" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || \"\" === e) { var r = e[a]; if (r) return r.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(typeof e + \" is not iterable\"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, \"constructor\", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) { var e = \"function\" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () { return this; }), define(g, \"toString\", function () { return \"[object Generator]\"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if (\"throw\" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if (\"root\" === i.tryLoc) return handle(\"end\"); if (i.tryLoc <= this.prev) { var c = n.call(i, \"catchLoc\"), u = n.call(i, \"finallyLoc\"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw new Error(\"try statement without catch or finally\"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) { var i = o; break; } } i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if (\"throw\" === t.type) throw t.arg; return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, catch: function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if (\"throw\" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw new Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, \"next\" === this.method && (this.arg = t), y; } }, e; }\nvar _a;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AutoEncrypter = exports.AutoEncryptionLoggerLevel = void 0;\nvar bson_1 = require(\"../bson\");\nvar deps_1 = require(\"../deps\");\nvar error_1 = require(\"../error\");\nvar mongo_client_1 = require(\"../mongo_client\");\nvar utils_1 = require(\"../utils\");\nvar cryptoCallbacks = require(\"./crypto_callbacks\");\nvar errors_1 = require(\"./errors\");\nvar mongocryptd_manager_1 = require(\"./mongocryptd_manager\");\nvar providers_1 = require(\"./providers\");\nvar state_machine_1 = require(\"./state_machine\");\n/** @public */\nexports.AutoEncryptionLoggerLevel = Object.freeze({\n  FatalError: 0,\n  Error: 1,\n  Warning: 2,\n  Info: 3,\n  Trace: 4\n});\n// Typescript errors if we index objects with `Symbol.for(...)`, so\n// to avoid TS errors we pull them out into variables.  Then we can type\n// the objects (and class) that we expect to see them on and prevent TS\n// errors.\n/** @internal */\nvar kDecorateResult = Symbol.for('@@mdb.decorateDecryptionResult');\n/** @internal */\nvar kDecoratedKeys = Symbol.for('@@mdb.decryptedKeys');\n/**\n * @internal An internal class to be used by the driver for auto encryption\n * **NOTE**: Not meant to be instantiated directly, this is for internal use only.\n */\nvar AutoEncrypter = /*#__PURE__*/function () {\n  _createClass(AutoEncrypter, null, [{\n    key: \"getMongoCrypt\",\n    /** @internal */value: function getMongoCrypt() {\n      var encryption = (0, deps_1.getMongoDBClientEncryption)();\n      if ('kModuleError' in encryption) {\n        throw encryption.kModuleError;\n      }\n      return encryption.MongoCrypt;\n    }\n    /**\n     * Create an AutoEncrypter\n     *\n     * **Note**: Do not instantiate this class directly. Rather, supply the relevant options to a MongoClient\n     *\n     * **Note**: Supplying `options.schemaMap` provides more security than relying on JSON Schemas obtained from the server.\n     * It protects against a malicious server advertising a false JSON Schema, which could trick the client into sending unencrypted data that should be encrypted.\n     * Schemas supplied in the schemaMap only apply to configuring automatic encryption for Client-Side Field Level Encryption.\n     * Other validation rules in the JSON schema will not be enforced by the driver and will result in an error.\n     *\n     * @example <caption>Create an AutoEncrypter that makes use of mongocryptd</caption>\n     * ```ts\n     * // Enabling autoEncryption via a MongoClient using mongocryptd\n     * const { MongoClient } = require('mongodb');\n     * const client = new MongoClient(URL, {\n     *   autoEncryption: {\n     *     kmsProviders: {\n     *       aws: {\n     *         accessKeyId: AWS_ACCESS_KEY,\n     *         secretAccessKey: AWS_SECRET_KEY\n     *       }\n     *     }\n     *   }\n     * });\n     * ```\n     *\n     * await client.connect();\n     * // From here on, the client will be encrypting / decrypting automatically\n     * @example <caption>Create an AutoEncrypter that makes use of libmongocrypt's CSFLE shared library</caption>\n     * ```ts\n     * // Enabling autoEncryption via a MongoClient using CSFLE shared library\n     * const { MongoClient } = require('mongodb');\n     * const client = new MongoClient(URL, {\n     *   autoEncryption: {\n     *     kmsProviders: {\n     *       aws: {}\n     *     },\n     *     extraOptions: {\n     *       cryptSharedLibPath: '/path/to/local/crypt/shared/lib',\n     *       cryptSharedLibRequired: true\n     *     }\n     *   }\n     * });\n     * ```\n     *\n     * await client.connect();\n     * // From here on, the client will be encrypting / decrypting automatically\n     */\n  }]);\n  function AutoEncrypter(client, options) {\n    _classCallCheck(this, AutoEncrypter);\n    /**\n     * Used by devtools to enable decorating decryption results.\n     *\n     * When set and enabled, `decrypt` will automatically recursively\n     * traverse a decrypted document and if a field has been decrypted,\n     * it will mark it as decrypted.  Compass uses this to determine which\n     * fields were decrypted.\n     */\n    this[_a] = false;\n    this._client = client;\n    this._bypassEncryption = options.bypassAutoEncryption === true;\n    this._keyVaultNamespace = options.keyVaultNamespace || 'admin.datakeys';\n    this._keyVaultClient = options.keyVaultClient || client;\n    this._metaDataClient = options.metadataClient || client;\n    this._proxyOptions = options.proxyOptions || {};\n    this._tlsOptions = options.tlsOptions || {};\n    this._kmsProviders = options.kmsProviders || {};\n    var mongoCryptOptions = {\n      cryptoCallbacks: cryptoCallbacks\n    };\n    if (options.schemaMap) {\n      mongoCryptOptions.schemaMap = Buffer.isBuffer(options.schemaMap) ? options.schemaMap : (0, bson_1.serialize)(options.schemaMap);\n    }\n    if (options.encryptedFieldsMap) {\n      mongoCryptOptions.encryptedFieldsMap = Buffer.isBuffer(options.encryptedFieldsMap) ? options.encryptedFieldsMap : (0, bson_1.serialize)(options.encryptedFieldsMap);\n    }\n    mongoCryptOptions.kmsProviders = !Buffer.isBuffer(this._kmsProviders) ? (0, bson_1.serialize)(this._kmsProviders) : this._kmsProviders;\n    if (options.options?.logger) {\n      mongoCryptOptions.logger = options.options.logger;\n    }\n    if (options.extraOptions && options.extraOptions.cryptSharedLibPath) {\n      mongoCryptOptions.cryptSharedLibPath = options.extraOptions.cryptSharedLibPath;\n    }\n    if (options.bypassQueryAnalysis) {\n      mongoCryptOptions.bypassQueryAnalysis = options.bypassQueryAnalysis;\n    }\n    this._bypassMongocryptdAndCryptShared = this._bypassEncryption || !!options.bypassQueryAnalysis;\n    if (options.extraOptions && options.extraOptions.cryptSharedLibSearchPaths) {\n      // Only for driver testing\n      mongoCryptOptions.cryptSharedLibSearchPaths = options.extraOptions.cryptSharedLibSearchPaths;\n    } else if (!this._bypassMongocryptdAndCryptShared) {\n      mongoCryptOptions.cryptSharedLibSearchPaths = ['$SYSTEM'];\n    }\n    var MongoCrypt = AutoEncrypter.getMongoCrypt();\n    this._mongocrypt = new MongoCrypt(mongoCryptOptions);\n    this._contextCounter = 0;\n    if (options.extraOptions && options.extraOptions.cryptSharedLibRequired && !this.cryptSharedLibVersionInfo) {\n      throw new errors_1.MongoCryptInvalidArgumentError('`cryptSharedLibRequired` set but no crypt_shared library loaded');\n    }\n    // Only instantiate mongocryptd manager/client once we know for sure\n    // that we are not using the CSFLE shared library.\n    if (!this._bypassMongocryptdAndCryptShared && !this.cryptSharedLibVersionInfo) {\n      this._mongocryptdManager = new mongocryptd_manager_1.MongocryptdManager(options.extraOptions);\n      var clientOptions = {\n        serverSelectionTimeoutMS: 10000\n      };\n      if (options.extraOptions == null || typeof options.extraOptions.mongocryptdURI !== 'string') {\n        clientOptions.family = 4;\n      }\n      this._mongocryptdClient = new mongo_client_1.MongoClient(this._mongocryptdManager.uri, clientOptions);\n    }\n  }\n  /**\n   * Initializes the auto encrypter by spawning a mongocryptd and connecting to it.\n   *\n   * This function is a no-op when bypassSpawn is set or the crypt shared library is used.\n   */\n  _createClass(AutoEncrypter, [{\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var client, message;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!(this._bypassMongocryptdAndCryptShared || this.cryptSharedLibVersionInfo)) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 2:\n              if (this._mongocryptdManager) {\n                _context.next = 4;\n                break;\n              }\n              throw new error_1.MongoRuntimeError('Reached impossible state: mongocryptdManager is undefined when neither bypassSpawn nor the shared lib are specified.');\n            case 4:\n              if (this._mongocryptdClient) {\n                _context.next = 6;\n                break;\n              }\n              throw new error_1.MongoRuntimeError('Reached impossible state: mongocryptdClient is undefined when neither bypassSpawn nor the shared lib are specified.');\n            case 6:\n              if (this._mongocryptdManager.bypassSpawn) {\n                _context.next = 9;\n                break;\n              }\n              _context.next = 9;\n              return this._mongocryptdManager.spawn();\n            case 9:\n              _context.prev = 9;\n              _context.next = 12;\n              return this._mongocryptdClient.connect();\n            case 12:\n              client = _context.sent;\n              return _context.abrupt(\"return\", client);\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](9);\n              message = _context.t0.message;\n              if (!(message && (message.match(/timed out after/) || message.match(/ENOTFOUND/)))) {\n                _context.next = 21;\n                break;\n              }\n              throw new error_1.MongoRuntimeError('Unable to connect to `mongocryptd`, please make sure it is running or in your PATH for auto-spawn', {\n                cause: _context.t0\n              });\n            case 21:\n              throw _context.t0;\n            case 22:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[9, 16]]);\n      }));\n      function init() {\n        return _init.apply(this, arguments);\n      }\n      return init;\n    }()\n    /**\n     * Cleans up the `_mongocryptdClient`, if present.\n     */\n  }, {\n    key: \"teardown\",\n    value: function () {\n      var _teardown = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(force) {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return this._mongocryptdClient?.close(force);\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function teardown(_x) {\n        return _teardown.apply(this, arguments);\n      }\n      return teardown;\n    }()\n    /**\n     * Encrypt a command for a given namespace.\n     */\n  }, {\n    key: \"encrypt\",\n    value: function () {\n      var _encrypt = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(ns, cmd) {\n        var options,\n          commandBuffer,\n          context,\n          stateMachine,\n          _args3 = arguments;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              options = _args3.length > 2 && _args3[2] !== undefined ? _args3[2] : {};\n              if (!this._bypassEncryption) {\n                _context3.next = 3;\n                break;\n              }\n              return _context3.abrupt(\"return\", cmd);\n            case 3:\n              commandBuffer = Buffer.isBuffer(cmd) ? cmd : (0, bson_1.serialize)(cmd, options);\n              context = this._mongocrypt.makeEncryptionContext(utils_1.MongoDBCollectionNamespace.fromString(ns).db, commandBuffer);\n              context.id = this._contextCounter++;\n              context.ns = ns;\n              context.document = cmd;\n              stateMachine = new state_machine_1.StateMachine({\n                promoteValues: false,\n                promoteLongs: false,\n                proxyOptions: this._proxyOptions,\n                tlsOptions: this._tlsOptions\n              });\n              return _context3.abrupt(\"return\", stateMachine.execute(this, context));\n            case 10:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function encrypt(_x2, _x3) {\n        return _encrypt.apply(this, arguments);\n      }\n      return encrypt;\n    }()\n    /**\n     * Decrypt a command response\n     */\n  }, {\n    key: \"decrypt\",\n    value: function () {\n      var _decrypt = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(response) {\n        var options,\n          buffer,\n          context,\n          stateMachine,\n          decorateResult,\n          result,\n          _args4 = arguments;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              options = _args4.length > 1 && _args4[1] !== undefined ? _args4[1] : {};\n              buffer = Buffer.isBuffer(response) ? response : (0, bson_1.serialize)(response, options);\n              context = this._mongocrypt.makeDecryptionContext(buffer);\n              context.id = this._contextCounter++;\n              stateMachine = new state_machine_1.StateMachine(_objectSpread({}, options, {\n                proxyOptions: this._proxyOptions,\n                tlsOptions: this._tlsOptions\n              }));\n              decorateResult = this[kDecorateResult];\n              _context4.next = 8;\n              return stateMachine.execute(this, context);\n            case 8:\n              result = _context4.sent;\n              if (decorateResult) {\n                decorateDecryptionResult(result, response);\n              }\n              return _context4.abrupt(\"return\", result);\n            case 11:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function decrypt(_x4) {\n        return _decrypt.apply(this, arguments);\n      }\n      return decrypt;\n    }()\n    /**\n     * Ask the user for KMS credentials.\n     *\n     * This returns anything that looks like the kmsProviders original input\n     * option. It can be empty, and any provider specified here will override\n     * the original ones.\n     */\n  }, {\n    key: \"askForKMSCredentials\",\n    value: function () {\n      var _askForKMSCredentials = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              return _context5.abrupt(\"return\", (0, providers_1.refreshKMSCredentials)(this._kmsProviders));\n            case 1:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n      function askForKMSCredentials() {\n        return _askForKMSCredentials.apply(this, arguments);\n      }\n      return askForKMSCredentials;\n    }()\n    /**\n     * Return the current libmongocrypt's CSFLE shared library version\n     * as `{ version: bigint, versionStr: string }`, or `null` if no CSFLE\n     * shared library was loaded.\n     */\n  }, {\n    key: \"cryptSharedLibVersionInfo\",\n    get: function get() {\n      return this._mongocrypt.cryptSharedLibVersionInfo;\n    }\n  }], [{\n    key: \"libmongocryptVersion\",\n    get: function get() {\n      return AutoEncrypter.getMongoCrypt().libmongocryptVersion;\n    }\n  }]);\n  return AutoEncrypter;\n}();\nexports.AutoEncrypter = AutoEncrypter;\n_a = kDecorateResult;\n/**\n * Recurse through the (identically-shaped) `decrypted` and `original`\n * objects and attach a `decryptedKeys` property on each sub-object that\n * contained encrypted fields. Because we only call this on BSON responses,\n * we do not need to worry about circular references.\n *\n * @internal\n */\nfunction decorateDecryptionResult(decrypted, original) {\n  var isTopLevelDecorateCall = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  if (isTopLevelDecorateCall) {\n    // The original value could have been either a JS object or a BSON buffer\n    if (Buffer.isBuffer(original)) {\n      original = (0, bson_1.deserialize)(original);\n    }\n    if (Buffer.isBuffer(decrypted)) {\n      throw new error_1.MongoRuntimeError('Expected result of decryption to be deserialized BSON object');\n    }\n  }\n  if (!decrypted || typeof decrypted !== 'object') return;\n  for (var _i = 0, _Object$keys = Object.keys(decrypted); _i < _Object$keys.length; _i++) {\n    var k = _Object$keys[_i];\n    var originalValue = original[k];\n    // An object was decrypted by libmongocrypt if and only if it was\n    // a BSON Binary object with subtype 6.\n    if (originalValue && originalValue._bsontype === 'Binary' && originalValue.sub_type === 6) {\n      if (!decrypted[kDecoratedKeys]) {\n        Object.defineProperty(decrypted, kDecoratedKeys, {\n          value: [],\n          configurable: true,\n          enumerable: false,\n          writable: false\n        });\n      }\n      // this is defined in the preceding if-statement\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      decrypted[kDecoratedKeys].push(k);\n      // Do not recurse into this decrypted value. It could be a sub-document/array,\n      // in which case there is no original value associated with its subfields.\n      continue;\n    }\n    decorateDecryptionResult(decrypted[k], originalValue, false);\n  }\n}","map":{"version":3,"names":["bson_1","require","deps_1","error_1","mongo_client_1","utils_1","cryptoCallbacks","errors_1","mongocryptd_manager_1","providers_1","state_machine_1","exports","AutoEncryptionLoggerLevel","Object","freeze","FatalError","Error","Warning","Info","Trace","kDecorateResult","Symbol","for","kDecoratedKeys","AutoEncrypter","_createClass","key","value","getMongoCrypt","encryption","getMongoDBClientEncryption","kModuleError","MongoCrypt","client","options","_classCallCheck","_a","_client","_bypassEncryption","bypassAutoEncryption","_keyVaultNamespace","keyVaultNamespace","_keyVaultClient","keyVaultClient","_metaDataClient","metadataClient","_proxyOptions","proxyOptions","_tlsOptions","tlsOptions","_kmsProviders","kmsProviders","mongoCryptOptions","schemaMap","Buffer","isBuffer","serialize","encryptedFieldsMap","logger","extraOptions","cryptSharedLibPath","bypassQueryAnalysis","_bypassMongocryptdAndCryptShared","cryptSharedLibSearchPaths","_mongocrypt","_contextCounter","cryptSharedLibRequired","cryptSharedLibVersionInfo","MongoCryptInvalidArgumentError","_mongocryptdManager","MongocryptdManager","clientOptions","serverSelectionTimeoutMS","mongocryptdURI","family","_mongocryptdClient","MongoClient","uri","_init","_asyncToGenerator","_regeneratorRuntime","mark","_callee","message","wrap","_callee$","_context","prev","next","abrupt","MongoRuntimeError","bypassSpawn","spawn","connect","sent","t0","match","cause","stop","init","apply","arguments","_teardown","_callee2","force","_callee2$","_context2","close","teardown","_x","_encrypt","_callee3","ns","cmd","commandBuffer","context","stateMachine","_args3","_callee3$","_context3","length","undefined","makeEncryptionContext","MongoDBCollectionNamespace","fromString","db","id","document","StateMachine","promoteValues","promoteLongs","execute","encrypt","_x2","_x3","_decrypt","_callee4","response","buffer","decorateResult","result","_args4","_callee4$","_context4","makeDecryptionContext","_objectSpread","decorateDecryptionResult","decrypt","_x4","_askForKMSCredentials","_callee5","_callee5$","_context5","refreshKMSCredentials","askForKMSCredentials","get","libmongocryptVersion","decrypted","original","isTopLevelDecorateCall","deserialize","_i","_Object$keys","keys","k","originalValue","_bsontype","sub_type","defineProperty","configurable","enumerable","writable","push"],"sources":["../../src/client-side-encryption/auto_encrypter.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module"}