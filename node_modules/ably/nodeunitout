[4mRunning "concat:ably" (concat) task[24m
File browser/static/ably.js created.

[4mRunning "concat:ably.noencryption" (concat) task[24m
File browser/static/ably.noencryption.js created.

[4mRunning "concat:ably-commonjs" (concat) task[24m
File browser/static/ably-commonjs.js created.

[4mRunning "concat:ably-reactnative" (concat) task[24m
File browser/static/ably-reactnative.js created.

[4mRunning "concat:ably-nativescript" (concat) task[24m
File browser/static/ably-nativescript.js created.

[4mRunning "concat:ably-commonjs.noencryption" (concat) task[24m
File browser/static/ably-commonjs.noencryption.js created.

[4mRunning "concat:ably.d.ts" (concat) task[24m
File browser/static/ably.d.ts created.

[4mRunning "requirejs" task[24m

[4mRunning "nodeunit" task[24m
Running Nodeunit test suite against all tests

[1mauth.test.js[22m
Test App _tmp_TJxY7g in environment sandbox has been set up
âœ” setupauth
21:7:17.258 Ably: Connection state: connecting
21:7:17.564 Ably: Connection state: connected
21:7:17.584 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:17.588 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” authbase0
21:7:17.709 Ably: Connection state: connecting
21:7:17.885 Ably: Connection state: connected
21:7:17.889 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:17.891 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” auth_useAuthUrl_json
21:7:17.996 Ably: Connection state: connecting
21:7:18.234 Ably: Connection state: connected
21:7:18.237 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:18.238 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” auth_useAuthUrl_post_json
21:7:18.341 Ably: Connection state: connecting
21:7:18.659 Ably: Connection state: connected
21:7:18.661 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:18.666 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” auth_useAuthUrl_plainText
21:7:18.669 Ably: Connection state: connecting
21:7:18.852 Ably: Connection state: connected
21:7:18.855 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:18.857 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” auth_useAuthCallback_tokenRequestResponse
21:7:18.860 Ably: Connection state: connecting
21:7:19.46 Ably: Connection state: connected
21:7:19.49 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:19.51 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” auth_useAuthCallback_tokenDetailsResponse
21:7:19.53 Ably: Connection state: connecting
21:7:19.232 Ably: Connection state: connected
21:7:19.234 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:19.236 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” auth_useAuthCallback_tokenStringResponse
21:7:19.238 Ably: Connection state: connecting
21:7:19.425 Ably: Connection state: connected
21:7:19.425 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:19.426 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_clientid_inheritance
21:7:19.526 Ably: Connection state: connecting
21:7:19.526 Ably: Connection state: failed; reason: Mismatch between clientId in token (test client id) and current clientId (WRONG), code: 40102
21:7:19.527 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:19.527 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_clientid_inheritance2
21:7:19.625 Ably: Connection state: connecting
21:7:19.708 Ably: Connection state: connected
21:7:19.709 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:19.711 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_clientid_inheritance3
21:7:19.812 Ably: Connection state: connecting
21:7:19.893 Ably: Connection state: connected
21:7:19.894 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:19.895 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_clientid_inheritance4
21:7:19.994 Ably: Connection state: connecting
21:7:20.79 Ably: Connection state: connected
21:7:20.82 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:20.85 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” auth_clientid_inheritance5
21:7:20.87 Ably: Connection state: connecting
21:7:20.89 Ably: Auth.requestToken(): token request signing call returned error; err = Error: An error from client code that the authCallback might return
21:7:20.89 Ably: Connection state: disconnected; reason: Error: An error from client code that the authCallback might return, code: 80019
No transport established; closing connection and calling test.done()
21:7:20.90 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:20.90 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” authCallback_error
21:7:20.91 Ably: Connection state: connecting
21:7:20.193 Ably: Auth.requestToken(): Token request callback timed out after 0.1 seconds
21:7:20.193 Ably: Connection state: disconnected; reason: Token request callback timed out after 0.1 seconds, code: 80019
No transport established; closing connection and calling test.done()
21:7:20.193 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:20.193 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” authCallback_timeout
21:7:20.195 Ably: Connection state: connecting
21:7:20.196 Ably: Auth.requestToken(): Expected token request callback to call back with a token string or token request/details object, but got a undefined
21:7:20.196 Ably: Connection state: disconnected; reason: Expected token request callback to call back with a token string or token request/details object, but got a undefined, code: 80019
No transport established; closing connection and calling test.done()
21:7:20.197 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:20.197 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” authCallback_nothing
21:7:20.201 Ably: Connection state: connecting
21:7:20.203 Ably: Auth.requestToken(): Expected token request callback to call back with a token string, token request object, or token details object
21:7:20.203 Ably: Connection state: disconnected; reason: Expected token request callback to call back with a token string, token request object, or token details object, code: 80019
No transport established; closing connection and calling test.done()
21:7:20.203 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:20.203 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” authCallback_malformed
21:7:20.204 Ably: Connection state: connecting
21:7:20.205 Ably: Connection state: disconnected; reason: Token string exceeded max permitted length (was 390 bytes), code: 80019
No transport established; closing connection and calling test.done()
21:7:20.205 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:20.205 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” authCallback_too_long_string
21:7:20.206 Ably: Connection state: connecting
21:7:20.306 Ably: Auth.requestToken(): Token request callback timed out after 0.1 seconds
21:7:20.307 Ably: Connection state: disconnected; reason: Token request callback timed out after 0.1 seconds, code: 80019
No transport established; closing connection and calling test.done()
21:7:20.307 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:20.307 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” authUrl_timeout
21:7:20.308 Ably: Connection state: connecting
21:7:20.494 Ably: Auth.requestToken(): token request signing call returned error; err = { statusCode: 404, code: undefined, message: undefined }
21:7:20.494 Ably: Connection state: disconnected; reason: { statusCode: 404, code: undefined, message: undefined }, code: 80019
No transport established; closing connection and calling test.done()
21:7:20.494 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:20.494 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” authUrl_404
21:7:20.495 Ably: Connection state: connecting
21:7:20.605 Ably: Auth.requestToken(): token request signing call returned error; err = [ErrorInfo: authUrl responded with unacceptable content-type text/html, should be either text/plain or application/json; statusCode=401; code=40170]
21:7:20.605 Ably: Connection state: disconnected; reason: authUrl responded with unacceptable content-type text/html, should be either text/plain or application/json, code: 80019
No transport established; closing connection and calling test.done()
21:7:20.605 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:20.605 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” authUrl_wrong_content_type
21:7:20.724 Ably: Connection state: connecting
21:7:20.943 Ably: Connection state: connected
21:7:25.696 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:7:25.697 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:7:25.700 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:7:25.701 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:7:25.701 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:25.701 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_expires_with_web_socket_binary_transport
21:7:25.829 Ably: Connection state: connecting
21:7:25.905 Ably: Connection state: connected
21:7:30.827 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:7:30.828 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:7:30.829 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:7:30.829 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:7:30.829 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:30.829 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_expires_with_web_socket_text_transport
21:7:30.929 Ably: Connection state: connecting
21:7:31.25 Ably: Connection state: connected
21:7:35.928 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:7:35.928 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:7:35.929 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:7:35.929 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:7:35.929 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:35.929 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_expires_with_comet_binary_transport
21:7:36.28 Ably: Connection state: connecting
21:7:36.128 Ably: Connection state: connected
21:7:41.35 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:7:41.36 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:7:41.36 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:7:41.36 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:7:41.36 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:41.36 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_expires_with_comet_text_transport
21:7:41.181 Ably: Connection state: connecting
21:7:41.406 Ably: Connection state: connected
21:7:46.160 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:7:46.161 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:7:46.161 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:7:46.161 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:7:46.161 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:46.161 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_expires_with_binary_transport
21:7:46.265 Ably: Connection state: connecting
21:7:46.721 Ably: Connection state: connected
21:7:51.263 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:7:51.264 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:7:51.264 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:7:51.264 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:7:51.264 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:51.264 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_expires_with_text_transport
âœ” auth_query_time_once
21:7:51.297 Ably: Connection state: connecting
21:7:51.795 Ably: Connection state: connected
21:7:56.650 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:7:56.651 Ably: Connection state: connecting
21:7:56.886 Ably: Connection state: connected
21:7:56.886 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:7:56.887 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_tokenDetails_expiry_with_authcallback_with_web_socket_binary_transport
21:7:56.888 Ably: Connection state: connecting
21:7:57.153 Ably: Connection state: connected
21:8:2.7 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:2.8 Ably: Connection state: connecting
21:8:2.198 Ably: Connection state: connected
21:8:2.198 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:2.199 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_tokenDetails_expiry_with_authcallback_with_web_socket_text_transport
21:8:2.201 Ably: Connection state: connecting
21:8:2.471 Ably: Connection state: connected
21:8:7.312 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:7.313 Ably: Connection state: connecting
21:8:7.493 Ably: Connection state: connected
21:8:7.493 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:7.495 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_tokenDetails_expiry_with_authcallback_with_comet_binary_transport
21:8:7.497 Ably: Connection state: connecting
21:8:7.678 Ably: Connection state: connected
21:8:12.589 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:12.589 Ably: Connection state: connecting
21:8:12.765 Ably: Connection state: connected
21:8:12.766 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:12.766 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_tokenDetails_expiry_with_authcallback_with_comet_text_transport
21:8:12.767 Ably: Connection state: connecting
21:8:12.955 Ably: Connection state: connected
21:8:17.856 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:17.856 Ably: Connection state: connecting
21:8:18.29 Ably: Connection state: connected
21:8:18.29 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:18.29 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_tokenDetails_expiry_with_authcallback_with_binary_transport
21:8:18.30 Ably: Connection state: connecting
21:8:18.207 Ably: Connection state: connected
21:8:23.125 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:23.126 Ably: Connection state: connecting
21:8:23.282 Ably: Connection state: connected
21:8:23.282 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:23.283 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_tokenDetails_expiry_with_authcallback_with_text_transport
21:8:23.285 Ably: Connection state: connecting
21:8:23.442 Ably: Connection state: connected
21:8:28.389 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:28.391 Ably: Connection state: connecting
21:8:28.548 Ably: Connection state: connected
21:8:28.549 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:28.549 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_authcallback_with_web_socket_binary_transport
21:8:28.550 Ably: Connection state: connecting
21:8:28.705 Ably: Connection state: connected
21:8:33.645 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:33.646 Ably: Connection state: connecting
21:8:33.799 Ably: Connection state: connected
21:8:33.799 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:33.799 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_authcallback_with_web_socket_text_transport
21:8:33.801 Ably: Connection state: connecting
21:8:33.978 Ably: Connection state: connected
21:8:38.896 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:38.897 Ably: Connection state: connecting
21:8:39.77 Ably: Connection state: connected
21:8:39.77 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:39.78 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_authcallback_with_comet_binary_transport
21:8:39.79 Ably: Connection state: connecting
21:8:39.260 Ably: Connection state: connected
21:8:44.179 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:44.179 Ably: Connection state: connecting
21:8:44.356 Ably: Connection state: connected
21:8:44.357 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:44.358 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_authcallback_with_comet_text_transport
21:8:44.359 Ably: Connection state: connecting
21:8:44.544 Ably: Connection state: connected
21:8:49.457 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:49.457 Ably: Connection state: connecting
21:8:49.630 Ably: Connection state: connected
21:8:49.631 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:49.633 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_authcallback_with_binary_transport
21:8:49.634 Ably: Connection state: connecting
21:8:49.813 Ably: Connection state: connected
21:8:54.722 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:54.722 Ably: Connection state: connecting
21:8:54.878 Ably: Connection state: connected
21:8:54.878 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:54.878 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_authcallback_with_text_transport
21:8:54.977 Ably: Connection state: connecting
21:8:55.34 Ably: Connection state: connected
21:8:59.981 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:8:59.981 Ably: Connection state: connecting
21:8:59.981 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:8:59.981 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:8:59.981 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:8:59.981 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_token_with_web_socket_binary_transport
21:9:0.80 Ably: Connection state: connecting
21:9:0.152 Ably: Connection state: connected
21:9:5.78 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:9:5.78 Ably: Connection state: connecting
21:9:5.79 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:5.79 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:5.79 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:5.79 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_token_with_web_socket_text_transport
21:9:5.177 Ably: Connection state: connecting
21:9:5.255 Ably: Connection state: connected
21:9:10.182 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:9:10.184 Ably: Connection state: connecting
21:9:10.184 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:10.184 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:10.184 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:10.184 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_token_with_comet_binary_transport
21:9:10.282 Ably: Connection state: connecting
21:9:10.363 Ably: Connection state: connected
21:9:15.280 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:9:15.281 Ably: Connection state: connecting
21:9:15.281 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:15.281 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:15.281 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:15.281 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_token_with_comet_text_transport
21:9:15.380 Ably: Connection state: connecting
21:9:15.475 Ably: Connection state: connected
21:9:20.377 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:9:20.378 Ably: Connection state: connecting
21:9:20.378 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:20.378 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:20.378 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:20.378 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_token_with_binary_transport
21:9:20.476 Ably: Connection state: connecting
21:9:20.557 Ably: Connection state: connected
21:9:25.471 Ably: Connection state: disconnected; reason: Key/token status changed (expire), code: 40142
21:9:25.472 Ably: Connection state: connecting
21:9:25.472 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:25.472 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:25.472 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:25.472 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_token_string_expiry_with_token_with_text_transport
21:9:25.670 Ably: Connection state: connecting
21:9:25.738 Ably: Connection state: disconnected; reason: Token expired, code: 40142
21:9:25.738 Ably: Connection state: connecting
21:9:25.739 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:25.739 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:25.739 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:25.739 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_expired_token_string_with_web_socket_binary_transport
21:9:25.936 Ably: Connection state: connecting
21:9:26.4 Ably: Connection state: disconnected; reason: Token expired, code: 40142
21:9:26.4 Ably: Connection state: connecting
21:9:26.5 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:26.5 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:26.5 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:26.5 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_expired_token_string_with_web_socket_text_transport
21:9:26.204 Ably: Connection state: connecting
21:9:26.277 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:26.278 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:26.278 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:26.278 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_expired_token_string_with_comet_binary_transport
21:9:26.478 Ably: Connection state: connecting
21:9:26.555 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:26.555 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:26.556 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:26.556 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_expired_token_string_with_comet_text_transport
21:9:26.753 Ably: Connection state: connecting
21:9:26.820 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:26.820 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:26.821 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:26.821 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_expired_token_string_with_binary_transport
21:9:27.19 Ably: Connection state: connecting
21:9:27.84 Ably: Auth.requestToken(): Need a new token, but authOptions does not include any way to request one
21:9:27.84 Ably: Connection state: failed; reason: Need a new token, but authOptions does not include any way to request one, code: 40101
21:9:27.85 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:27.85 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” auth_expired_token_string_with_text_transport
21:9:27.87 Ably: Connection state: connecting
21:9:27.240 Ably: Connection state: connected
21:9:27.242 Ably: Channel state for channel "right": attaching
21:9:27.255 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:27.256 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:27.256 Ably: Channel state for channel "right": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = right; statusCode=401; code=40160]
21:9:27.371 Ably: Channel state for channel "right": attaching
21:9:27.671 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:9:37.380 Ably: Channel state for channel "right": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:9:37.381 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:37.381 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:9:37.382 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:37.382 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:37.382 Ably: Channel state for channel "right": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
[31mâœ– reauth_authCallback_with_web_socket_binary_transport[39m

Assertion Message: [35mCheck using second token, with channel attach capability[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/auth.test.js:693:12
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:9:37.397 Ably: Connection state: connecting
21:9:37.564 Ably: Connection state: connected
21:9:37.565 Ably: Channel state for channel "right": attaching
21:9:37.577 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:37.577 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:37.577 Ably: Channel state for channel "right": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = right; statusCode=401; code=40160]
21:9:37.687 Ably: Channel state for channel "right": attaching
21:9:37.708 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:9:47.691 Ably: Channel state for channel "right": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:9:47.692 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:47.692 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:9:47.692 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:47.692 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:47.692 Ably: Channel state for channel "right": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
[31mâœ– reauth_authCallback_with_web_socket_text_transport[39m

Assertion Message: [35mCheck using second token, with channel attach capability[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/auth.test.js:693:12
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:9:47.706 Ably: Connection state: connecting
21:9:47.896 Ably: Connection state: connected
21:9:47.896 Ably: Channel state for channel "right": attaching
21:9:47.949 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:47.949 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:47.949 Ably: Channel state for channel "right": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = right; statusCode=401; code=40160]
21:9:48.68 Ably: Channel state for channel "right": attaching
21:9:48.94 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:9:58.77 Ably: Channel state for channel "right": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:9:58.78 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:9:58.78 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:9:58.78 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:58.78 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:58.78 Ably: Channel state for channel "right": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
[31mâœ– reauth_authCallback_with_comet_binary_transport[39m

Assertion Message: [35mCheck using second token, with channel attach capability[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/auth.test.js:693:12
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:9:58.82 Ably: Connection state: connecting
21:9:58.260 Ably: Connection state: connected
21:9:58.260 Ably: Channel state for channel "right": attaching
21:9:58.313 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:58.313 Ably: PresenceMap.setInProgress(): inProgress = false
21:9:58.313 Ably: Channel state for channel "right": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = right; statusCode=401; code=40160]
21:9:58.429 Ably: Channel state for channel "right": attaching
21:9:58.448 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:10:8.435 Ably: Channel state for channel "right": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:10:8.435 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:8.435 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:8.435 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:8.435 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:8.435 Ably: Channel state for channel "right": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
[31mâœ– reauth_authCallback_with_comet_text_transport[39m

Assertion Message: [35mCheck using second token, with channel attach capability[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/auth.test.js:693:12
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:10:8.437 Ably: Connection state: connecting
21:10:8.618 Ably: Connection state: connected
21:10:8.619 Ably: Channel state for channel "right": attaching
21:10:8.687 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:8.687 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:8.687 Ably: Channel state for channel "right": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = right; statusCode=401; code=40160]
21:10:8.798 Ably: Channel state for channel "right": attaching
21:10:8.816 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:10:18.803 Ably: Channel state for channel "right": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:10:18.803 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:18.804 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:18.804 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:18.804 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:18.804 Ably: Channel state for channel "right": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
[31mâœ– reauth_authCallback_with_binary_transport[39m

Assertion Message: [35mCheck using second token, with channel attach capability[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/auth.test.js:693:12
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:10:18.819 Ably: Connection state: connecting
21:10:18.998 Ably: Connection state: connected
21:10:18.998 Ably: Channel state for channel "right": attaching
21:10:19.68 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:19.69 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:19.69 Ably: Channel state for channel "right": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = right; statusCode=401; code=40160]
21:10:19.179 Ably: Channel state for channel "right": attaching
21:10:19.199 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:10:29.184 Ably: Channel state for channel "right": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:10:29.185 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:29.185 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:29.185 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:29.185 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:29.185 Ably: Channel state for channel "right": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
[31mâœ– reauth_authCallback_with_text_transport[39m

Assertion Message: [35mCheck using second token, with channel attach capability[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/auth.test.js:693:12
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:10:29.199 Ably: Connection state: connecting
21:10:29.202 Ably: Auth.authorize: Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want
No transport established; closing connection and calling test.done()
21:10:29.203 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:29.204 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” authorize_updates_stored_details
21:10:29.206 Ably: Connection state: connecting
21:10:29.224 Ably: Auth.requestToken(): token request signing call returned error; err = Error: getaddrinfo ENOTFOUND invalid invalid:80
21:10:29.225 Ably: Auth.requestToken(): token request signing call returned error; err = Error: getaddrinfo ENOTFOUND invalid invalid:80
21:10:29.375 Ably: Connection state: connected
21:10:29.472 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:29.472 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” mocked_reauth

[1mchannel.test.js[22m
âœ” setupchannel
21:10:29.497 Ably: Connection state: connecting
21:10:29.569 Ably: Connection state: connected
21:10:29.570 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:29.570 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelinit0_with_web_socket_binary_transport
21:10:29.584 Ably: Connection state: connecting
21:10:29.639 Ably: Connection state: connected
21:10:29.639 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:29.639 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelinit0_with_web_socket_text_transport
21:10:29.653 Ably: Connection state: connecting
21:10:29.732 Ably: Connection state: connected
21:10:29.732 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:29.733 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelinit0_with_comet_binary_transport
21:10:29.735 Ably: Connection state: connecting
21:10:29.814 Ably: Connection state: connected
21:10:29.815 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:29.815 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelinit0_with_comet_text_transport
21:10:29.816 Ably: Connection state: connecting
21:10:29.895 Ably: Connection state: connected
21:10:29.897 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:29.897 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelinit0_with_binary_transport
21:10:29.901 Ably: Connection state: connecting
21:10:29.983 Ably: Connection state: connected
21:10:29.985 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:29.985 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelinit0_with_text_transport
21:10:29.988 Ably: Connection state: connecting
21:10:34.230 Ably: Auth.requestToken(): token request signing call returned error; err = Error: getaddrinfo ENOTFOUND invalid invalid:80
21:10:35.69 Ably: Connection state: connected
21:10:35.69 Ably: Channel state for channel "channelattach0": attaching
21:10:35.252 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.252 Ably: Channel state for channel "channelattach0": attached
21:10:35.253 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:35.253 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:35.253 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.253 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.253 Ably: Channel state for channel "channelattach0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach0_with_web_socket_binary_transport
21:10:35.266 Ably: Connection state: connecting
21:10:35.337 Ably: Connection state: connected
21:10:35.337 Ably: Channel state for channel "channelattach0": attaching
21:10:35.355 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.356 Ably: Channel state for channel "channelattach0": attached
21:10:35.356 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:35.356 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:35.356 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.356 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.356 Ably: Channel state for channel "channelattach0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach0_with_web_socket_text_transport
21:10:35.372 Ably: Connection state: connecting
21:10:35.449 Ably: Connection state: connected
21:10:35.449 Ably: Channel state for channel "channelattach0": attaching
21:10:35.508 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.508 Ably: Channel state for channel "channelattach0": attached
21:10:35.508 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:35.509 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:35.509 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.509 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.509 Ably: Channel state for channel "channelattach0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach0_with_comet_binary_transport
21:10:35.510 Ably: Connection state: connecting
21:10:35.593 Ably: Connection state: connected
21:10:35.593 Ably: Channel state for channel "channelattach0": attaching
21:10:35.651 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.651 Ably: Channel state for channel "channelattach0": attached
21:10:35.652 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:35.652 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:35.652 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.652 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.652 Ably: Channel state for channel "channelattach0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach0_with_comet_text_transport
21:10:35.653 Ably: Connection state: connecting
21:10:35.732 Ably: Connection state: connected
21:10:35.732 Ably: Channel state for channel "channelattach0": attaching
21:10:35.791 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.791 Ably: Channel state for channel "channelattach0": attached
21:10:35.791 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:35.791 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:35.791 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.791 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.792 Ably: Channel state for channel "channelattach0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach0_with_binary_transport
21:10:35.793 Ably: Connection state: connecting
21:10:35.874 Ably: Connection state: connected
21:10:35.874 Ably: Channel state for channel "channelattach0": attaching
21:10:35.933 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.933 Ably: Channel state for channel "channelattach0": attached
21:10:35.933 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:35.933 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:35.933 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.933 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:35.933 Ably: Channel state for channel "channelattach0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach0_with_text_transport
21:10:35.935 Ably: Connection state: connecting
21:10:35.935 Ably: Channel state for channel "channelattach2": attaching
21:10:35.991 Ably: Connection state: connected
21:10:36.93 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.94 Ably: Channel state for channel "channelattach2": attached
21:10:36.94 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:36.94 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:36.94 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.94 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.94 Ably: Channel state for channel "channelattach2": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach2_with_web_socket_binary_transport
21:10:36.108 Ably: Connection state: connecting
21:10:36.108 Ably: Channel state for channel "channelattach2": attaching
21:10:36.164 Ably: Connection state: connected
21:10:36.201 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.201 Ably: Channel state for channel "channelattach2": attached
21:10:36.201 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:36.202 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:36.202 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.202 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.202 Ably: Channel state for channel "channelattach2": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach2_with_web_socket_text_transport
21:10:36.215 Ably: Connection state: connecting
21:10:36.215 Ably: Channel state for channel "channelattach2": attaching
21:10:36.297 Ably: Connection state: connected
21:10:36.355 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.355 Ably: Channel state for channel "channelattach2": attached
21:10:36.356 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:36.356 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:36.356 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.356 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.356 Ably: Channel state for channel "channelattach2": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach2_with_comet_binary_transport
21:10:36.357 Ably: Connection state: connecting
21:10:36.357 Ably: Channel state for channel "channelattach2": attaching
21:10:36.441 Ably: Connection state: connected
21:10:36.500 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.500 Ably: Channel state for channel "channelattach2": attached
21:10:36.500 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:36.500 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:36.500 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.500 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.501 Ably: Channel state for channel "channelattach2": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach2_with_comet_text_transport
21:10:36.501 Ably: Connection state: connecting
21:10:36.501 Ably: Channel state for channel "channelattach2": attaching
21:10:36.577 Ably: Connection state: connected
21:10:36.635 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.635 Ably: Channel state for channel "channelattach2": attached
21:10:36.635 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:36.636 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:36.636 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.636 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.636 Ably: Channel state for channel "channelattach2": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach2_with_binary_transport
21:10:36.637 Ably: Connection state: connecting
21:10:36.637 Ably: Channel state for channel "channelattach2": attaching
21:10:36.715 Ably: Connection state: connected
21:10:36.774 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.774 Ably: Channel state for channel "channelattach2": attached
21:10:36.774 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:36.780 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:36.780 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.780 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:36.780 Ably: Channel state for channel "channelattach2": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach2_with_text_transport
21:10:36.782 Ably: Connection state: connecting
21:10:36.851 Ably: Connection state: connected
21:10:36.852 Ably: Channel state for channel "channelattach3": attaching
21:10:37.444 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:37.444 Ably: Channel state for channel "channelattach3": attached
21:10:37.445 Ably: Channel state for channel "channelattach3": detaching
21:10:37.457 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:10:47.447 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:47.447 Ably: Channel state for channel "channelattach3": attached; reason: [ErrorInfo: Channel detach timed out; statusCode=408; code=90007]
21:10:47.447 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:47.448 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:47.448 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:47.448 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:47.448 Ably: Channel state for channel "channelattach3": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
[31mâœ– channelattach3_with_web_socket_binary_transport[39m

Assertion Message: [35mDetach failed with error: 408; Channel detach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:115:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mDetach failed: State is attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:121:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 1 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at WebSocketTransport.onWsClose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:128:8)
    at WebSocket.wsConnection.onclose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:68:48)
    at WebSocket.onClose (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:446:14)
    at emitTwo (events.js:106:13)
    at WebSocket.emit (events.js:191:7)
    at WebSocket.cleanupWebsocketResources (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:950:8)
    at emitNone (events.js:91:20)

Error: Expected 1 assertions, 3 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at WebSocketTransport.onWsClose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:128:8)
    at WebSocket.wsConnection.onclose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:68:48)
    at WebSocket.onClose (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:446:14)
    at emitTwo (events.js:106:13)
    at WebSocket.emit (events.js:191:7)
    at WebSocket.cleanupWebsocketResources (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:950:8)
    at emitNone (events.js:91:20)

21:10:47.463 Ably: Connection state: connecting
[31mâœ– channelattach3_with_web_socket_binary_transport[39m

Assertion Message: [35mDetach failed with error: 408; Channel detach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:115:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mDetach failed: State is attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:121:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 1 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at WebSocketTransport.onWsClose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:128:8)
    at WebSocket.wsConnection.onclose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:68:48)
    at WebSocket.onClose (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:446:14)
    at emitTwo (events.js:106:13)
    at WebSocket.emit (events.js:191:7)
    at WebSocket.cleanupWebsocketResources (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:950:8)
    at emitNone (events.js:91:20)

Error: Expected 1 assertions, 3 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at WebSocketTransport.onWsClose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:128:8)
    at WebSocket.wsConnection.onclose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:68:48)
    at WebSocket.onClose (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:446:14)
    at emitTwo (events.js:106:13)
    at WebSocket.emit (events.js:191:7)
    at WebSocket.cleanupWebsocketResources (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:950:8)
    at emitNone (events.js:91:20)

21:10:47.464 Ably: Connection state: connecting
21:10:47.539 Ably: Connection state: connected
21:10:47.540 Ably: Channel state for channel "channelattach3": attaching
21:10:47.549 Ably: Connection state: connected
21:10:47.550 Ably: Channel state for channel "channelattach3": attaching
21:10:47.563 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:47.563 Ably: Channel state for channel "channelattach3": attached
21:10:47.563 Ably: Channel state for channel "channelattach3": detaching
21:10:47.577 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:10:47.608 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:47.608 Ably: Channel state for channel "channelattach3": attached
21:10:47.609 Ably: Channel state for channel "channelattach3": detaching
21:10:47.625 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:10:57.563 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.563 Ably: Channel state for channel "channelattach3": attached; reason: [ErrorInfo: Channel detach timed out; statusCode=408; code=90007]
21:10:57.564 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:57.564 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:57.564 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.564 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.564 Ably: Channel state for channel "channelattach3": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
[31mâœ– channelattach3_with_web_socket_text_transport[39m

Assertion Message: [35mDetach failed with error: 408; Channel detach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:115:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mDetach failed: State is attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:121:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 1 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at WebSocketTransport.onWsClose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:128:8)
    at WebSocket.wsConnection.onclose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:68:48)
    at WebSocket.onClose (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:446:14)
    at emitTwo (events.js:106:13)
    at WebSocket.emit (events.js:191:7)
    at WebSocket.cleanupWebsocketResources (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:950:8)
    at emitNone (events.js:91:20)

Error: Expected 1 assertions, 3 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at WebSocketTransport.onWsClose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:128:8)
    at WebSocket.wsConnection.onclose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:68:48)
    at WebSocket.onClose (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:446:14)
    at emitTwo (events.js:106:13)
    at WebSocket.emit (events.js:191:7)
    at WebSocket.cleanupWebsocketResources (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:950:8)
    at emitNone (events.js:91:20)

21:10:57.582 Ably: Connection state: connecting
[31mâœ– channelattach3_with_web_socket_text_transport[39m

Assertion Message: [35mDetach failed with error: 408; Channel detach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:115:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mDetach failed: State is attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:121:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 1 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at WebSocketTransport.onWsClose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:128:8)
    at WebSocket.wsConnection.onclose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:68:48)
    at WebSocket.onClose (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:446:14)
    at emitTwo (events.js:106:13)
    at WebSocket.emit (events.js:191:7)
    at WebSocket.cleanupWebsocketResources (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:950:8)
    at emitNone (events.js:91:20)

Error: Expected 1 assertions, 3 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at WebSocketTransport.onWsClose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:128:8)
    at WebSocket.wsConnection.onclose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:68:48)
    at WebSocket.onClose (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:446:14)
    at emitTwo (events.js:106:13)
    at WebSocket.emit (events.js:191:7)
    at WebSocket.cleanupWebsocketResources (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:950:8)
    at emitNone (events.js:91:20)

21:10:57.584 Ably: Connection state: connecting
21:10:57.609 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.609 Ably: Channel state for channel "channelattach3": attached; reason: [ErrorInfo: Channel detach timed out; statusCode=408; code=90007]
21:10:57.609 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:57.610 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:10:57.610 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.610 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.610 Ably: Channel state for channel "channelattach3": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
[31mâœ– channelattach3_with_comet_binary_transport[39m

Assertion Message: [35mDetach failed with error: 408; Channel detach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:115:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mDetach failed: State is attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:121:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 1 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at NodeCometTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/transport/comettransport.js:177:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

Error: Expected 1 assertions, 3 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at NodeCometTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/transport/comettransport.js:177:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

21:10:57.615 Ably: Connection state: connecting
[31mâœ– channelattach3_with_comet_binary_transport[39m

Assertion Message: [35mDetach failed with error: 408; Channel detach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:115:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mDetach failed: State is attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:121:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 1 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at NodeCometTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/transport/comettransport.js:177:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

Error: Expected 1 assertions, 3 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at NodeCometTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/transport/comettransport.js:177:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

21:10:57.616 Ably: Connection state: connecting
21:10:57.656 Ably: Connection state: connected
21:10:57.656 Ably: Channel state for channel "": attaching
21:10:57.668 Ably: Connection state: connected
21:10:57.668 Ably: Channel state for channel "channelattach3": attaching
21:10:57.675 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.675 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.675 Ably: Channel state for channel "": failed; reason: [ErrorInfo: Invalid channel id (); statusCode=400; code=40010]
21:10:57.692 Ably: Connection state: connected
21:10:57.693 Ably: Channel state for channel "": attaching
21:10:57.706 Ably: Connection state: connected
21:10:57.706 Ably: Channel state for channel "": attaching
21:10:57.707 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.707 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.707 Ably: Channel state for channel "": failed; reason: [ErrorInfo: Invalid channel id (); statusCode=400; code=40010]
21:10:57.737 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.737 Ably: Channel state for channel "channelattach3": attached
21:10:57.737 Ably: Channel state for channel "channelattach3": detaching
21:10:57.754 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:10:57.759 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.759 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:57.759 Ably: Channel state for channel "": failed; reason: [ErrorInfo: Invalid channel id (); statusCode=400; code=40010]
21:10:58.676 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:58.677 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachempty_with_web_socket_binary_transport
21:10:58.693 Ably: Connection state: connecting
21:10:58.707 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:58.708 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachempty_with_web_socket_text_transport
21:10:58.720 Ably: Connection state: connecting
21:10:58.760 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:58.760 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachempty_with_comet_binary_transport
21:10:58.764 Ably: Connection state: connecting
21:10:58.770 Ably: Connection state: connected
21:10:58.771 Ably: Channel state for channel "": attaching
21:10:58.806 Ably: Connection state: connected
21:10:58.806 Ably: Channel state for channel "": attaching
21:10:58.829 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:58.829 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:58.829 Ably: Channel state for channel "": failed; reason: [ErrorInfo: Invalid channel id (); statusCode=400; code=40010]
21:10:58.849 Ably: Connection state: connected
21:10:58.849 Ably: Channel state for channel "": attaching
21:10:58.862 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:58.862 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:58.862 Ably: Channel state for channel "": failed; reason: [ErrorInfo: Invalid channel id (); statusCode=400; code=40010]
21:10:58.909 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:58.910 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:58.910 Ably: Channel state for channel "": failed; reason: [ErrorInfo: Invalid channel id (); statusCode=400; code=40010]
21:10:59.830 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:59.830 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachempty_with_comet_text_transport
21:10:59.832 Ably: Connection state: connecting
21:10:59.862 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:59.863 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachempty_with_binary_transport
21:10:59.875 Ably: Connection state: connecting
21:10:59.888 Ably: Connection state: connected
21:10:59.889 Ably: Channel state for channel ":hell": attaching
21:10:59.901 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:59.901 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:59.901 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:10:59.910 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:10:59.910 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachempty_with_text_transport
21:10:59.923 Ably: Connection state: connecting
21:10:59.932 Ably: Connection state: connected
21:10:59.932 Ably: Channel state for channel ":hell": attaching
21:10:59.944 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:59.944 Ably: PresenceMap.setInProgress(): inProgress = false
21:10:59.944 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:10:59.999 Ably: Connection state: connected
21:10:59.999 Ably: Channel state for channel ":hell": attaching
21:11:0.50 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:0.50 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:0.50 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:0.902 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:0.903 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachinvalid_with_web_socket_binary_transport
21:11:0.916 Ably: Connection state: connecting
21:11:0.945 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:0.945 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachinvalid_with_web_socket_text_transport
21:11:0.958 Ably: Connection state: connecting
21:11:0.994 Ably: Connection state: connected
21:11:0.994 Ably: Channel state for channel ":hell": attaching
21:11:1.44 Ably: Connection state: connected
21:11:1.44 Ably: Channel state for channel ":hell": attaching
21:11:1.49 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:1.49 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:1.49 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:1.50 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:1.51 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachinvalid_with_comet_binary_transport
21:11:1.52 Ably: Connection state: connecting
21:11:1.101 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:1.101 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:1.101 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:1.135 Ably: Connection state: connected
21:11:1.135 Ably: Channel state for channel ":hell": attaching
21:11:1.188 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:1.189 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:1.189 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:2.50 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.51 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachinvalid_with_comet_text_transport
21:11:2.52 Ably: Connection state: connecting
21:11:2.102 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.103 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachinvalid_with_binary_transport
21:11:2.116 Ably: Connection state: connecting
21:11:2.123 Ably: Connection state: connected
21:11:2.124 Ably: Channel state for channel "channelattach_publish": attaching
21:11:2.174 Ably: Connection state: connected
21:11:2.174 Ably: Channel state for channel "channelattach_publish": attaching
21:11:2.189 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.189 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattachinvalid_with_text_transport
21:11:2.203 Ably: Connection state: connecting
21:11:2.279 Ably: Connection state: connected
21:11:2.280 Ably: Channel state for channel "channelattach_publish": attaching
21:11:2.475 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.475 Ably: Channel state for channel "channelattach_publish": attached
21:11:2.479 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.479 Ably: Channel state for channel "channelattach_publish": attached
21:11:2.487 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.487 Ably: Channel state for channel "channelattach_publish": attached
21:11:2.493 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.493 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:2.493 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.493 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.493 Ably: Channel state for channel "channelattach_publish": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:2.496 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.496 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:2.496 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.496 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.496 Ably: Channel state for channel "channelattach_publish": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:2.505 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.506 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:2.506 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.506 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.506 Ably: Channel state for channel "channelattach_publish": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach_publish_with_comet_binary_transport
21:11:2.508 Ably: Connection state: connecting
Transport disposed; calling test.done()
âœ” channelattach_publish_with_web_socket_binary_transport
21:11:2.511 Ably: Connection state: connecting
Transport disposed; calling test.done()
âœ” channelattach_publish_with_web_socket_text_transport
21:11:2.513 Ably: Connection state: connecting
21:11:2.595 Ably: Connection state: connected
21:11:2.596 Ably: Channel state for channel "channelattach_publish": attaching
21:11:2.598 Ably: Connection state: connected
21:11:2.598 Ably: Channel state for channel "channelattach_publish": attaching
21:11:2.603 Ably: Connection state: connected
21:11:2.603 Ably: Channel state for channel "channelattach_publish": attaching
21:11:2.677 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.677 Ably: Channel state for channel "channelattach_publish": attached
21:11:2.681 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.681 Ably: Channel state for channel "channelattach_publish": attached
21:11:2.684 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.684 Ably: Channel state for channel "channelattach_publish": attached
21:11:2.691 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:2.698 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.699 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:2.699 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.699 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.699 Ably: Channel state for channel "channelattach_publish": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach_publish_with_binary_transport
21:11:2.700 Ably: Connection state: connecting
21:11:2.704 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.704 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:2.704 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.704 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.704 Ably: Channel state for channel "channelattach_publish": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach_publish_with_text_transport
21:11:2.705 Ably: Connection state: connecting
21:11:2.708 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.708 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:2.709 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.709 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.709 Ably: Channel state for channel "channelattach_publish": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach_publish_with_comet_text_transport
21:11:2.710 Ably: Connection state: connecting
21:11:2.778 Ably: Connection state: connected
21:11:2.779 Ably: Channel state for channel ":hell": attaching
21:11:2.789 Ably: Connection state: connected
21:11:2.790 Ably: Channel state for channel ":hell": attaching
21:11:2.790 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.790 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.791 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:2.791 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.791 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:2.803 Ably: Connection state: connected
21:11:2.804 Ably: Channel state for channel ":hell": attaching
Transport disposed; calling test.done()
21:11:2.807 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.807 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.807 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:2.807 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.807 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” channelattach_publish_invalid_with_web_socket_binary_transport
21:11:2.808 Ably: Connection state: connecting
Transport disposed; calling test.done()
âœ” channelattach_publish_invalid_with_web_socket_text_transport
21:11:2.824 Ably: Connection state: connecting
21:11:2.865 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.865 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.865 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:2.865 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.866 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattach_publish_invalid_with_comet_binary_transport
21:11:2.869 Ably: Connection state: connecting
21:11:2.899 Ably: Connection state: connected
21:11:2.900 Ably: Channel state for channel ":hell": attaching
21:11:2.910 Ably: Connection state: connected
21:11:2.911 Ably: Channel state for channel ":hell": attaching
21:11:2.949 Ably: Connection state: connected
21:11:2.950 Ably: Channel state for channel ":hell": attaching
21:11:2.954 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.954 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.954 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:2.954 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.954 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattach_publish_invalid_with_comet_text_transport
21:11:2.955 Ably: Connection state: connecting
21:11:2.971 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.971 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:2.971 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:2.972 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:2.972 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattach_publish_invalid_with_binary_transport
21:11:2.974 Ably: Connection state: connecting
21:11:3.19 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:3.19 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:3.19 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:3.20 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:3.20 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” channelattach_publish_invalid_with_text_transport
21:11:3.21 Ably: Connection state: connecting
21:11:3.57 Ably: Connection state: connected
21:11:3.58 Ably: Channel state for channel ":hell": attaching
21:11:3.69 Ably: Connection state: connected
21:11:3.69 Ably: Channel state for channel ":hell": attaching
21:11:3.73 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:3.73 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:3.73 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:3.73 Ably: Channel state for channel ":hell": attaching
21:11:3.82 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:3.82 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:3.82 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:3.83 Ably: Channel state for channel ":hell": attaching
21:11:3.87 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:3.96 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:3.113 Ably: Connection state: connected
21:11:3.113 Ably: Channel state for channel ":hell": attaching
21:11:3.166 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:3.167 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:3.167 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:3.167 Ably: Channel state for channel ":hell": attaching
21:11:3.183 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:7.738 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:7.738 Ably: Channel state for channel "channelattach3": attached; reason: [ErrorInfo: Channel detach timed out; statusCode=408; code=90007]
21:11:7.738 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:7.739 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:7.739 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:7.739 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:7.739 Ably: Channel state for channel "channelattach3": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
[31mâœ– channelattach3_with_comet_text_transport[39m

Assertion Message: [35mDetach failed with error: 408; Channel detach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:115:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mDetach failed: State is attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:121:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 1 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at NodeCometTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/transport/comettransport.js:177:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

Error: Expected 1 assertions, 3 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at NodeCometTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/transport/comettransport.js:177:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

21:11:7.744 Ably: Connection state: connecting
[31mâœ– channelattach3_with_comet_text_transport[39m

Assertion Message: [35mDetach failed with error: 408; Channel detach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:115:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mDetach failed: State is attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/channel.test.js:121:13
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 1 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at NodeCometTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/transport/comettransport.js:177:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

Error: Expected 1 assertions, 3 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at NodeCometTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/transport/comettransport.js:177:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

21:11:7.745 Ably: Connection state: connecting
21:11:7.829 Ably: Connection state: connected
21:11:7.829 Ably: Channel state for channel ":hell": attaching
21:11:7.833 Ably: Connection state: connected
21:11:7.833 Ably: Channel state for channel ":hell": attaching
21:11:7.894 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:7.894 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:7.894 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:7.894 Ably: Channel state for channel ":hell": attaching
21:11:7.895 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:7.895 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:7.895 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:7.896 Ably: Channel state for channel ":hell": attaching
21:11:7.909 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:7.927 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:13.77 Ably: Channel state for channel ":hell": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:11:13.83 Ably: Channel state for channel ":hell": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:11:13.167 Ably: Channel state for channel ":hell": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:11:14.78 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:14.79 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:14.79 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.79 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.79 Ably: Channel state for channel ":hell": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:14.82 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:14.82 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:14.83 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.83 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.83 Ably: Channel state for channel ":hell": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach_invalid_twice_with_web_socket_binary_transport
21:11:14.92 Ably: Connection state: connecting
Transport disposed; calling test.done()
âœ” channelattach_invalid_twice_with_web_socket_text_transport
21:11:14.96 Ably: Connection state: connecting
21:11:14.96 Ably: Channel state for channel "channelattachOnceOrIf": attaching
21:11:14.168 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:14.168 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:14.168 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.168 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.168 Ably: Channel state for channel ":hell": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach_invalid_twice_with_comet_binary_transport
21:11:14.170 Ably: Connection state: connecting
21:11:14.170 Ably: Channel state for channel "channelattachOnceOrIf": attaching
21:11:14.174 Ably: Connection state: connected
21:11:14.174 Ably: Channel state for channel ":hell": attaching
21:11:14.179 Ably: Connection state: connected
21:11:14.237 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.237 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.237 Ably: Channel state for channel ":hell": failed; reason: [ErrorInfo: Invalid channel id (:hell); statusCode=400; code=40010]
21:11:14.237 Ably: Channel state for channel ":hell": attaching
21:11:14.254 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:14.263 Ably: Connection state: connected
21:11:14.568 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.568 Ably: Channel state for channel "channelattachOnceOrIf": attached
21:11:14.569 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:14.569 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:14.569 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.569 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.569 Ably: Channel state for channel "channelattachOnceOrIf": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattachOnceOrIfAfter
21:11:14.573 Ably: Connection state: connecting
21:11:14.575 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.575 Ably: Channel state for channel "channelattachOnceOrIf": attached
21:11:14.575 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:14.576 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:14.576 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.576 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.576 Ably: Channel state for channel "channelattachOnceOrIf": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattachOnceOrIfBefore
21:11:14.580 Ably: Connection state: connecting
21:11:14.657 Ably: Connection state: connected
21:11:14.657 Ably: Channel state for channel "channelsubscribe0": attaching
21:11:14.665 Ably: Connection state: connected
21:11:14.666 Ably: Channel state for channel "channelsubscribe1-event": attaching
21:11:14.805 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.805 Ably: Channel state for channel "channelsubscribe0": attached
21:11:14.820 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:14.833 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.833 Ably: Channel state for channel "channelsubscribe1-event": attached
21:11:14.835 Ably: Channel state for channel "channelsubscribe1-listener": attaching
21:11:14.850 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:14.960 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:14.960 Ably: Channel state for channel "channelsubscribe1-listener": attached
21:11:14.961 Ably: Channel state for channel "channelsubscribe1-all": attaching
21:11:15.144 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.144 Ably: Channel state for channel "channelsubscribe1-all": attached
21:11:15.806 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:15.807 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:15.807 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.807 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.807 Ably: Channel state for channel "channelsubscribe0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelsubscribe0
21:11:15.823 Ably: Connection state: connecting
21:11:15.882 Ably: Connection state: connected
21:11:15.882 Ably: Channel state for channel "server_sent_detached": attaching
21:11:15.884 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:15.885 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:15.885 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.885 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.885 Ably: Channel state for channel "channelsubscribe1-event": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:15.885 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.885 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.885 Ably: Channel state for channel "channelsubscribe1-listener": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:15.885 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.885 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.885 Ably: Channel state for channel "channelsubscribe1-all": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelsubscribe1
21:11:15.902 Ably: Connection state: connecting
21:11:15.957 Ably: Connection state: connected
21:11:15.957 Ably: Channel state for channel "server_sent_detached_while_attaching": attaching
21:11:15.958 Ably: Channel state for channel "server_sent_detached_while_attaching": suspended; reason: [ErrorInfo: generic serverside failure; statusCode=500; code=50000]
21:11:15.958 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:15.958 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:15.958 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.959 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:15.959 Ably: Channel state for channel "server_sent_detached_while_attaching": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” server_sent_detached_while_attaching
21:11:15.971 Ably: Connection state: connecting
21:11:16.52 Ably: Connection state: connected
21:11:16.53 Ably: Channel state for channel "server_sent_error": attaching
21:11:16.67 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:16.67 Ably: Channel state for channel "server_sent_detached": attached
21:11:16.68 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:16.281 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:16.281 Ably: Channel state for channel "server_sent_error": attached
21:11:16.282 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:16.296 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:17.896 Ably: Channel state for channel ":hell": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:11:17.913 Ably: Channel state for channel ":hell": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:11:18.897 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:18.898 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:18.898 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:18.898 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:18.898 Ably: Channel state for channel ":hell": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach_invalid_twice_with_comet_text_transport
21:11:18.900 Ably: Connection state: connecting
21:11:18.914 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:18.914 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:18.914 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:18.914 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:18.914 Ably: Channel state for channel ":hell": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach_invalid_twice_with_binary_transport
21:11:18.932 Ably: Connection state: connecting
21:11:18.983 Ably: Connection state: connected
21:11:18.983 Ably: Channel state for channel "server_sent_attached_err": attaching
21:11:19.14 Ably: Connection state: connected
21:11:19.15 Ably: Channel state for channel "publish_no_queueing": attaching
21:11:19.152 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:19.152 Ably: Channel state for channel "server_sent_attached_err": attached
21:11:19.153 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:19.166 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:19.184 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:19.184 Ably: Channel state for channel "publish_no_queueing": attached
21:11:19.185 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
No transport established; closing connection and calling test.done()
21:11:19.185 Ably: Connection state: connecting
21:11:19.185 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:19.185 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:19.185 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:19.185 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:19.185 Ably: Channel state for channel "publish_no_queueing": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” publish_no_queueing
21:11:19.186 Ably: Connection state: connecting
21:11:19.268 Ably: Connection state: connected
21:11:19.269 Ably: Channel state for channel "channel_attach_timeout": attaching
21:11:19.369 Ably: Channel state for channel "channel_attach_timeout": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:11:19.385 Ably: Channel state for channel "channel_attach_timeout": attaching
21:11:19.385 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:19.386 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:19.386 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:19.386 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:19.386 Ably: Channel state for channel "channel_attach_timeout": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channel_attach_timeout
21:11:19.403 Ably: Connection state: connecting
21:11:19.469 Ably: Connection state: connected
21:11:19.470 Ably: Channel state for channel "suspended_connection": attaching
21:11:19.653 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:19.653 Ably: Channel state for channel "suspended_connection": attached
21:11:19.654 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:11:19.654 Ably: Connection state: connecting
21:11:19.654 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:11:19.655 Ably: Channel state for channel "suspended_connection": suspended; reason: [ErrorInfo: Connection to server unavailable; statusCode=400; code=80002]
21:11:20.655 Ably: Connection state: connecting
21:11:20.711 Ably: Connection state: connected
21:11:20.712 Ably: Channel state for channel "suspended_connection": attaching
21:11:20.813 Ably: Channel state for channel "suspended_connection": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:11:20.813 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:20.814 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:20.814 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:20.814 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:20.814 Ably: Channel state for channel "suspended_connection": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” suspended_connection

[1mconnection.test.js[22m
âœ” setupConnection
21:11:20.829 Ably: Connection state: connecting
21:11:20.906 Ably: Connection state: connected
21:11:20.910 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:20.911 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” connectionPing
21:11:20.913 Ably: Connection state: connecting
21:11:20.997 Ably: Connection state: connected
21:11:21.52 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.52 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” connectionPingWithCallback
21:11:21.54 Ably: Connection state: connecting
21:11:21.136 Ably: Connection state: connected
21:11:21.136 Ably: Channel state for channel "connectionattributes": attaching
21:11:21.374 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:21.374 Ably: Channel state for channel "connectionattributes": attached
21:11:21.390 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
connectionAttributes test: connection serial is 0
21:11:21.406 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.407 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:21.407 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:21.407 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:21.407 Ably: Channel state for channel "connectionattributes": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
No transport established; closing connection and calling test.done()
âœ” connectionAttributes
21:11:21.408 Ably: Connection state: connecting
21:11:21.494 Ably: ConnectionManager.activateTransport(): error = [ErrorInfo: Unable to recover connection: not found (ablyjs_test_fake); statusCode=400; code=80008]
21:11:21.494 Ably: Connection state: connected; reason: Unable to recover connection: not found (ablyjs_test_fake), code: 80008
21:11:21.496 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.497 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” unrecoverableConnection
21:11:21.499 Ably: Connection state: connecting
21:11:21.579 Ably: Channel state for channel "connectionQueuing": attaching
21:11:21.579 Ably: Connection state: connected
21:11:21.761 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:21.761 Ably: Channel state for channel "connectionQueuing": attached
21:11:21.762 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:11:21.762 Ably: Connection state: connecting
21:11:21.823 Ably: Connection state: connected
21:11:21.824 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:21.839 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.840 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:21.840 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:21.840 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:21.840 Ably: Channel state for channel "connectionQueuing": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” connectionQueuing

[1mconnectivity.test.js[22m
âœ” setupConnectivity
âœ” http_connectivity_check

[1mcrypto.test.js[22m
âœ” setupCrypto
âœ” generateRandomKey0
âœ” generateRandomKey1
âœ” getDefaultParams_wordArray_key
âœ” getDefaultParams_base64_key
âœ” getDefaultParams_check_keylength
âœ” getDefaultParams_preserves_custom_algorithms
21:11:21.868 Ably: Connection state: connecting
21:11:21.869 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.871 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.871 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.871 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
No transport established; closing connection and calling test.done()
21:11:21.873 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.874 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” encrypt_message_128
21:11:21.875 Ably: Connection state: connecting
21:11:21.875 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.876 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.876 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.876 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
No transport established; closing connection and calling test.done()
21:11:21.879 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.879 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” encrypt_message_256
21:11:21.880 Ably: Connection state: connecting
21:11:21.880 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.881 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.881 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.882 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
No transport established; closing connection and calling test.done()
21:11:21.885 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.885 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” decrypt_message_128
21:11:21.886 Ably: Connection state: connecting
21:11:21.886 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.887 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.887 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.887 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
No transport established; closing connection and calling test.done()
21:11:21.888 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.888 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” decrypt_message_256
21:11:21.889 Ably: Connection state: connecting
21:11:21.889 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.891 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.891 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.892 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
No transport established; closing connection and calling test.done()
21:11:21.894 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.894 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” msgpack_128
21:11:21.896 Ably: Connection state: connecting
21:11:21.897 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.898 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.898 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:21.899 Ably: Message.fromEncoded(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
No transport established; closing connection and calling test.done()
21:11:21.900 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:21.901 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” msgpack_256
21:11:21.902 Ably: Connection state: connecting
21:11:21.903 Ably: Channel state for channel "single_send": attaching
21:11:21.968 Ably: Connection state: connected
21:11:22.85 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.85 Ably: Channel state for channel "single_send": attached
21:11:22.102 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:22.103 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:22.103 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.103 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.103 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_128_with_web_socket_binary_transport
21:11:22.117 Ably: Connection state: connecting
21:11:22.118 Ably: Channel state for channel "single_send": attaching
21:11:22.191 Ably: Connection state: connected
21:11:22.215 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.215 Ably: Channel state for channel "single_send": attached
21:11:22.233 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:22.234 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:22.234 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.234 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.234 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_128_with_web_socket_text_transport
21:11:22.248 Ably: Connection state: connecting
21:11:22.248 Ably: Channel state for channel "single_send": attaching
21:11:22.326 Ably: Connection state: connected
21:11:22.384 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.385 Ably: Channel state for channel "single_send": attached
21:11:22.405 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:22.405 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:22.405 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.405 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.405 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_128_with_comet_binary_transport
21:11:22.406 Ably: Connection state: connecting
21:11:22.406 Ably: Channel state for channel "single_send": attaching
21:11:22.482 Ably: Connection state: connected
21:11:22.550 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.550 Ably: Channel state for channel "single_send": attached
21:11:22.570 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:22.571 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:22.571 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.571 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.571 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_128_with_comet_text_transport
21:11:22.572 Ably: Connection state: connecting
21:11:22.572 Ably: Channel state for channel "single_send": attaching
21:11:22.651 Ably: Connection state: connected
21:11:22.730 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.730 Ably: Channel state for channel "single_send": attached
21:11:22.744 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:22.763 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:22.763 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:22.763 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.763 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.764 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_128_with_binary_transport
21:11:22.777 Ably: Connection state: connecting
21:11:22.777 Ably: Channel state for channel "single_send": attaching
21:11:22.855 Ably: Connection state: connected
21:11:22.914 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.914 Ably: Channel state for channel "single_send": attached
21:11:22.934 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:22.934 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:22.934 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.934 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:22.934 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_128_with_text_transport
21:11:22.936 Ably: Connection state: connecting
21:11:22.936 Ably: Channel state for channel "single_send": attaching
21:11:23.9 Ably: Connection state: connected
21:11:23.23 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.23 Ably: Channel state for channel "single_send": attached
21:11:23.40 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:23.41 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:23.41 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.41 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.41 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_256_with_web_socket_binary_transport
21:11:23.57 Ably: Connection state: connecting
21:11:23.58 Ably: Channel state for channel "single_send": attaching
21:11:23.114 Ably: Connection state: connected
21:11:23.127 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.127 Ably: Channel state for channel "single_send": attached
21:11:23.143 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:23.144 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:23.144 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.144 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.144 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_256_with_web_socket_text_transport
21:11:23.157 Ably: Connection state: connecting
21:11:23.157 Ably: Channel state for channel "single_send": attaching
21:11:23.238 Ably: Connection state: connected
21:11:23.317 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.317 Ably: Channel state for channel "single_send": attached
21:11:23.339 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:23.339 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:23.339 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.339 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.339 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_256_with_comet_binary_transport
21:11:23.341 Ably: Connection state: connecting
21:11:23.341 Ably: Channel state for channel "single_send": attaching
21:11:23.425 Ably: Connection state: connected
21:11:23.492 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.493 Ably: Channel state for channel "single_send": attached
21:11:23.513 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:23.513 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:23.513 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.513 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.513 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_256_with_comet_text_transport
21:11:23.515 Ably: Connection state: connecting
21:11:23.516 Ably: Channel state for channel "single_send": attaching
21:11:23.595 Ably: Connection state: connected
21:11:23.674 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.674 Ably: Channel state for channel "single_send": attached
21:11:23.690 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:23.708 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:23.708 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:23.708 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.708 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.708 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_256_with_binary_transport
21:11:23.725 Ably: Connection state: connecting
21:11:23.725 Ably: Channel state for channel "single_send": attaching
21:11:23.813 Ably: Connection state: connected
21:11:23.872 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.872 Ably: Channel state for channel "single_send": attached
21:11:23.892 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:23.893 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:23.893 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.893 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:23.893 Ably: Channel state for channel "single_send": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” single_send_256_with_text_transport
21:11:23.896 Ably: Connection state: connecting
21:11:23.899 Ably: Channel state for channel "multiple_send_binary_2_200": attaching
21:11:23.981 Ably: Connection state: connected
21:11:24.230 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:24.230 Ably: Channel state for channel "multiple_send_binary_2_200": attached
21:11:24.237 Ably: Channel state for channel ":hell": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:11:24.246 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:24.252 Ably: Channel state for channel ":hell": attaching
21:11:24.254 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:24.254 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:24.255 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:24.255 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:24.255 Ably: Channel state for channel "multiple_send_binary_2_200": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” multiple_send_binary_2_200
21:11:24.257 Ably: Connection state: connecting
21:11:24.259 Ably: Channel state for channel "multiple_send_text_2_200": attaching
21:11:24.264 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:24.338 Ably: Connection state: connected
21:11:24.487 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:24.487 Ably: Channel state for channel "multiple_send_text_2_200": attached
21:11:24.502 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:24.510 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:24.510 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:24.511 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:24.511 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:24.511 Ably: Channel state for channel "multiple_send_text_2_200": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” multiple_send_text_2_200
21:11:24.516 Ably: Connection state: connecting
21:11:24.518 Ably: Channel state for channel "multiple_send_binary_20_100": attaching
21:11:24.592 Ably: Connection state: connected
21:11:24.741 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:24.741 Ably: Channel state for channel "multiple_send_binary_20_100": attached
21:11:24.759 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:25.237 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:25.238 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:25.238 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:25.238 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:25.238 Ably: Channel state for channel ":hell": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” channelattach_invalid_twice_with_text_transport
TypeError: Cannot read property 'setUp' of undefined
    at wrapGroup (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:285:14)
    at Object.exports.runSuite (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:93:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:125:21
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:513:13
    at iterate (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:123:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:134:25
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:515:17
    at Immediate.<anonymous> (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:146:17)
    at runCallback (timers.js:637:20)
    at tryOnImmediate (timers.js:610:5)
    at processImmediate [as _immediateCallback] (timers.js:582:5)
21:11:26.453 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:26.454 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:26.454 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:26.454 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:26.454 Ably: Channel state for channel "multiple_send_binary_20_100": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” multiple_send_binary_20_100
21:11:26.470 Ably: Connection state: connecting
21:11:26.471 Ably: Channel state for channel "multiple_send_text_20_100": attaching
21:11:26.554 Ably: Connection state: connected
21:11:26.783 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:26.783 Ably: Channel state for channel "multiple_send_text_20_100": attached
21:11:26.798 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:28.404 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:28.404 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:28.404 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.404 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.404 Ably: Channel state for channel "multiple_send_text_20_100": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” multiple_send_text_20_100
21:11:28.419 Ably: Connection state: connecting
21:11:28.419 Ably: Connection state: connecting
21:11:28.426 Ably: Channel state for channel "single_send_separate_realtimes": attaching
21:11:28.426 Ably: Channel state for channel "single_send_separate_realtimes": attaching
21:11:28.502 Ably: Connection state: connected
21:11:28.506 Ably: Connection state: connected
21:11:28.651 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.651 Ably: Channel state for channel "single_send_separate_realtimes": attached
21:11:28.652 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.652 Ably: Channel state for channel "single_send_separate_realtimes": attached
21:11:28.666 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:28.683 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:28.687 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:28.687 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.687 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.688 Ably: Channel state for channel "single_send_separate_realtimes": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:28.688 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:28.689 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:28.689 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.689 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.689 Ably: Channel state for channel "single_send_separate_realtimes": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” single_send_binary_text
21:11:28.704 Ably: Connection state: connecting
21:11:28.704 Ably: Connection state: connecting
21:11:28.709 Ably: Channel state for channel "single_send_separate_realtimes": attaching
21:11:28.709 Ably: Channel state for channel "single_send_separate_realtimes": attaching
21:11:28.788 Ably: Connection state: connected
21:11:28.792 Ably: Connection state: connected
21:11:28.847 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.847 Ably: Channel state for channel "single_send_separate_realtimes": attached
21:11:28.858 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.858 Ably: Channel state for channel "single_send_separate_realtimes": attached
21:11:28.879 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:28.879 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:28.879 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.879 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.879 Ably: Channel state for channel "single_send_separate_realtimes": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:28.880 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:28.880 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:28.880 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.880 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:28.880 Ably: Channel state for channel "single_send_separate_realtimes": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” single_send_text_binary
21:11:28.883 Ably: Connection state: connecting
21:11:28.883 Ably: Connection state: connecting
21:11:28.886 Ably: Channel state for channel "publish_immediately": attaching
21:11:28.971 Ably: Connection state: connected
21:11:28.974 Ably: Connection state: connected
21:11:29.124 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.124 Ably: Channel state for channel "publish_immediately": attached
21:11:29.125 Ably: Channel state for channel "publish_immediately": attaching
21:11:29.140 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:29.150 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.150 Ably: Channel state for channel "publish_immediately": attached
21:11:29.167 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:29.167 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:29.168 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.168 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.168 Ably: Channel state for channel "publish_immediately": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:29.168 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:29.168 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:29.168 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.168 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.168 Ably: Channel state for channel "publish_immediately": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” publish_immediately
21:11:29.184 Ably: Connection state: connecting
21:11:29.184 Ably: Connection state: connecting
21:11:29.184 Ably: Channel state for channel "single_send_key_mismatch": attaching
21:11:29.184 Ably: Channel state for channel "single_send_key_mismatch": attaching
21:11:29.268 Ably: Connection state: connected
21:11:29.271 Ably: Connection state: connected
21:11:29.487 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.487 Ably: Channel state for channel "single_send_key_mismatch": attached
21:11:29.488 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.489 Ably: Channel state for channel "single_send_key_mismatch": attached
21:11:29.513 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:29.539 Ably: RealtimeChannel.onMessage(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜error:06065064:digital envelope routines:EVP_DecryptFinal_ex:bad decryptâ€™; statusCode=400; code=40013]
21:11:29.539 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:29.540 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:29.540 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.540 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.540 Ably: Channel state for channel "single_send_key_mismatch": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:29.540 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:29.541 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:29.541 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.541 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.541 Ably: Channel state for channel "single_send_key_mismatch": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” single_send_key_mismatch
21:11:29.564 Ably: Connection state: connecting
21:11:29.565 Ably: Connection state: connecting
21:11:29.565 Ably: Channel state for channel "single_send_unencrypted": attaching
21:11:29.565 Ably: Channel state for channel "single_send_unencrypted": attaching
21:11:29.645 Ably: Connection state: connected
21:11:29.649 Ably: Connection state: connected
21:11:29.876 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.876 Ably: Channel state for channel "single_send_unencrypted": attached
21:11:29.884 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.884 Ably: Channel state for channel "single_send_unencrypted": attached
21:11:29.891 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:29.899 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:29.916 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:29.916 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:29.917 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.917 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.917 Ably: Channel state for channel "single_send_unencrypted": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:29.917 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:29.917 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:29.917 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.917 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:29.917 Ably: Channel state for channel "single_send_unencrypted": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” single_send_unencrypted
21:11:29.933 Ably: Connection state: connecting
21:11:29.934 Ably: Connection state: connecting
21:11:29.934 Ably: Channel state for channel "single_send_encrypted_unhandled": attaching
21:11:29.934 Ably: Channel state for channel "single_send_encrypted_unhandled": attaching
21:11:30.23 Ably: Connection state: connected
21:11:30.33 Ably: Connection state: connected
21:11:30.332 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.332 Ably: Channel state for channel "single_send_encrypted_unhandled": attached
21:11:30.332 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.332 Ably: Channel state for channel "single_send_encrypted_unhandled": attached
21:11:30.349 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:30.349 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:30.363 Ably: RealtimeChannel.onMessage(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:30.364 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:30.364 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:30.364 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.364 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.364 Ably: Channel state for channel "single_send_encrypted_unhandled": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:30.364 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:30.365 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:30.365 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.365 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.365 Ably: Channel state for channel "single_send_encrypted_unhandled": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” single_send_encrypted_unhandled
21:11:30.381 Ably: Connection state: connecting
21:11:30.381 Ably: Connection state: connecting
21:11:30.382 Ably: Channel state for channel "set_cipher_params": attaching
21:11:30.382 Ably: Channel state for channel "set_cipher_params": attaching
21:11:30.458 Ably: Connection state: connected
21:11:30.469 Ably: Connection state: connected
21:11:30.686 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.687 Ably: Channel state for channel "set_cipher_params": attached
21:11:30.688 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.688 Ably: Channel state for channel "set_cipher_params": attached
21:11:30.700 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:30.705 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:11:30.730 Ably: RealtimeChannel.onMessage(): [ErrorInfo: Error processing the cipher encoding, decoder returned â€˜Unable to decrypt message; not an encrypted channelâ€™; statusCode=400; code=40013]
21:11:30.749 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:30.750 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:30.750 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.750 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.750 Ably: Channel state for channel "set_cipher_params": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:11:30.751 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:11:30.751 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:11:30.751 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.751 Ably: PresenceMap.setInProgress(): inProgress = false
21:11:30.751 Ably: Channel state for channel "set_cipher_params": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” set_cipher_params0

[1mencoding.test.js[22m
âœ” setupEncoding
[31mâœ– server_sent_detached[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 4 assertions, 1 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

TypeError: Cannot read property 'setUp' of undefined
    at wrapGroup (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:285:14)
    at Object.exports.runSuite (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:93:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:125:21
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:513:13
    at iterate (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:123:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:134:25
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:515:17
    at Immediate.<anonymous> (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:146:17)
    at runCallback (timers.js:637:20)
    at tryOnImmediate (timers.js:610:5)
    at processImmediate [as _immediateCallback] (timers.js:582:5)
[31mâœ– server_sent_error[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 2 assertions, 1 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

TypeError: Cannot read property 'setUp' of undefined
    at wrapGroup (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:285:14)
    at Object.exports.runSuite (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:93:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:125:21
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:513:13
    at iterate (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:123:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:134:25
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:515:17
    at Immediate.<anonymous> (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:146:17)
    at runCallback (timers.js:637:20)
    at tryOnImmediate (timers.js:610:5)
    at processImmediate [as _immediateCallback] (timers.js:582:5)
[31mâœ– server_sent_attached_err[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 6 assertions, 1 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

TypeError: Cannot read property 'setUp' of undefined
    at wrapGroup (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:285:14)
    at Object.exports.runSuite (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:93:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:125:21
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:513:13
    at iterate (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:123:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:134:25
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:515:17
    at Immediate.<anonymous> (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:146:17)
    at runCallback (timers.js:637:20)
    at tryOnImmediate (timers.js:610:5)
    at processImmediate [as _immediateCallback] (timers.js:582:5)
[31mâœ– message_decoding[39m

Assertion Message: [35mUnable to get test assets; err = ENOENT: no such file or directory, open '/mnt/terra/home/simon/ably/ably-js/spec/common/ably-common/test-resources/messages-encoding.json'[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/encoding.test.js:30:10
    at ReadFileContext.callback (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/testapp_manager.js:232:5)
    at FSReqWrap.readFileAfterOpen [as oncomplete] (fs.js:365:13)

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

[31mâœ– message_encoding[39m

Assertion Message: [35mUnable to get test assets; err = ENOENT: no such file or directory, open '/mnt/terra/home/simon/ably/ably-js/spec/common/ably-common/test-resources/messages-encoding.json'[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/encoding.test.js:96:10
    at ReadFileContext.callback (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/testapp_manager.js:232:5)
    at FSReqWrap.readFileAfterOpen [as oncomplete] (fs.js:365:13)

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)


[1mevent_emitter.test.js[22m
âœ” setupauth
21:13:30.809 Ably: Connection state: connecting
21:13:30.881 Ably: Connection state: connected
21:13:30.881 Ably: Channel state for channel "channel": attaching
21:13:31.61 Ably: PresenceMap.setInProgress(): inProgress = false
21:13:31.61 Ably: Channel state for channel "channel": attached
21:13:31.62 Ably: Channel state for channel "channel": detaching
21:13:31.74 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:13:41.70 Ably: PresenceMap.setInProgress(): inProgress = false
21:13:41.70 Ably: Channel state for channel "channel": attached; reason: [ErrorInfo: Channel detach timed out; statusCode=408; code=90007]
[31mâœ– attachdetach0[39m

Assertion Message: [35mUnexpected attached event received[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/realtime/event_emitter.test.js:74:12)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 8 assertions, 7 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:14:30.810 Ably: EventEmitter.emit(): Unexpected listener exception: Expected failure 1; stack = undefined
21:14:30.810 Ably: EventEmitter.emit(): Unexpected listener exception: Expected failure 2; stack = undefined
No transport established; closing connection and calling test.done()
21:14:30.810 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.811 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” emitCallsAllCallbacksIgnoringExceptions
No transport established; closing connection and calling test.done()
21:14:30.811 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.812 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” onceCalledOnlyOnce
No transport established; closing connection and calling test.done()
21:14:30.812 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.812 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” onceCallbackDoesNotImpactOnCallback
No transport established; closing connection and calling test.done()
21:14:30.813 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.813 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” offRemovesAllMatchingListeners
No transport established; closing connection and calling test.done()
21:14:30.814 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.814 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” offRemovesAllListeners
No transport established; closing connection and calling test.done()
21:14:30.815 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.815 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” offRemovesAllMatchingEventListeners
No transport established; closing connection and calling test.done()
21:14:30.815 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.815 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” offRemovesAllMatchingEvents
No transport established; closing connection and calling test.done()
21:14:30.816 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.816 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” offRemovesEmptyEventNameListeners
No transport established; closing connection and calling test.done()
21:14:30.817 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.817 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” arrayOfEvents
No transport established; closing connection and calling test.done()
21:14:30.818 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.818 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” listenerAddedInListenerCb
No transport established; closing connection and calling test.done()
21:14:30.819 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:30.819 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” listenerRemovedInListenerCb

[1mfailure.test.js[22m
âœ” setupFailure
21:14:30.824 Ably: Connection state: connecting
21:14:30.824 Ably: Connection state: connecting
21:14:30.824 Ably: Connection state: connecting
21:14:31.20 Ably: Connection state: failed; reason: No application found with id this, code: 40400
21:14:31.29 Ably: Connection state: failed; reason: No application found with id this, code: 40400
21:14:31.30 Ably: Connection state: failed; reason: No application found with id this, code: 40400
No transport established; closing connection and calling test.done()
No transport established; closing connection and calling test.done()
No transport established; closing connection and calling test.done()
21:14:31.31 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:31.31 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:31.31 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:31.31 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:31.31 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:31.31 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” invalid_cred_failure
21:14:31.32 Ably: Connection state: connecting
21:14:31.33 Ably: Connection state: connecting
21:14:31.33 Ably: Connection state: connecting
21:14:31.43 Ably: WebSocketTransport.onWsClose(): Unclean disconnection of WebSocket ; code = 1008
21:14:31.121 Ably: Connection state: connected
21:14:31.122 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:14:31.129 Ably: Connection state: connected
21:14:31.129 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:14:31.322 Ably: Connection state: connected
21:14:31.322 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
No transport established; closing connection and calling test.done()
No transport established; closing connection and calling test.done()
21:14:31.323 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:31.323 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:31.323 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:31.323 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:31.323 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:31.323 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” break_transport
21:14:31.336 Ably: Connection state: connecting
21:14:31.336 Ably: Connection state: connecting
21:14:31.336 Ably: Connection state: connecting
21:14:31.352 Ably: WebSocketTransport.onError(): Unexpected error from WebSocket: getaddrinfo ENOTFOUND invalid invalid:443
21:14:31.352 Ably: WebSocketTransport.onWsClose(): Unclean disconnection of WebSocket ; code = 1006
21:14:31.353 Ably: Connection state: disconnected; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:31.354 Ably: Connection state: disconnected; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:31.439 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:14:32.354 Ably: Connection state: connecting
21:14:32.356 Ably: Connection state: connecting
21:14:32.372 Ably: Connection state: disconnected; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:32.421 Ably: WebSocketTransport.onError(): Unexpected error from WebSocket: getaddrinfo ENOTFOUND invalid invalid:443
21:14:32.421 Ably: WebSocketTransport.onWsClose(): Unclean disconnection of WebSocket ; code = 1006
21:14:32.421 Ably: Connection state: disconnected; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:32.438 Ably: Connection state: connecting
21:14:32.452 Ably: Connection state: disconnected; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:33.372 Ably: Connection state: connecting
21:14:33.385 Ably: Connection state: disconnected; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:33.420 Ably: Connection state: connecting
21:14:33.434 Ably: WebSocketTransport.onError(): Unexpected error from WebSocket: getaddrinfo ENOTFOUND invalid invalid:443
21:14:33.434 Ably: WebSocketTransport.onWsClose(): Unclean disconnection of WebSocket ; code = 1006
21:14:33.434 Ably: Connection state: disconnected; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:33.451 Ably: Connection state: connecting
21:14:33.485 Ably: Connection state: disconnected; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:34.237 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:14:34.237 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:14:34.238 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:14:35.238 Ably: Connection state: connecting
21:14:35.238 Ably: Connection state: connecting
21:14:35.242 Ably: Connection state: connecting
21:14:35.254 Ably: WebSocketTransport.onError(): Unexpected error from WebSocket: getaddrinfo ENOTFOUND invalid invalid:443
21:14:35.254 Ably: WebSocketTransport.onWsClose(): Unclean disconnection of WebSocket ; code = 1006
21:14:35.254 Ably: Connection state: suspended; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:35.257 Ably: Connection state: suspended; reason: Unable to connect (and no more fallback hosts to try), code: 80000
21:14:35.342 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
No transport established; closing connection and calling test.done()
No transport established; closing connection and calling test.done()
No transport established; closing connection and calling test.done()
21:14:36.137 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:36.137 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:36.137 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:36.137 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:36.137 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:36.138 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” no_connection_lifecycle
21:14:36.139 Ably: Connection state: connecting
21:14:36.221 Ably: Connection state: connected
21:14:36.221 Ably: Channel state for channel "::": attaching
21:14:36.280 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.280 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.280 Ably: Channel state for channel "::": failed; reason: [ErrorInfo: Invalid channel id (::); statusCode=400; code=40010]
21:14:36.282 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:36.283 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” failed_channel
21:14:36.284 Ably: Connection state: connecting
21:14:36.372 Ably: Connection state: connected
21:14:36.373 Ably: Channel state for channel "failed_attach": attaching
21:14:36.382 Ably: Channel state for channel "failed_attach": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:14:36.393 Ably: Channel state for channel "failed_attach": attaching
21:14:36.393 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:36.394 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:36.394 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.394 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.394 Ably: Channel state for channel "failed_attach": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” attach_timeout
21:14:36.396 Ably: Connection state: connecting
21:14:36.473 Ably: Connection state: connected
21:14:36.474 Ably: Channel state for channel "nack_on_connection_failure": attaching
21:14:36.522 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.522 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.522 Ably: Channel state for channel "failed_attach": failed; reason: [ErrorInfo: Connection already closed; statusCode=400; code=80017]
21:14:36.523 Ably: CometTransport.sendItems(): on complete: err = {"code":"ECONNRESET"}
21:14:36.653 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.654 Ably: Channel state for channel "nack_on_connection_failure": attached
21:14:36.655 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:14:36.655 Ably: Connection state: connecting
21:14:36.655 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:14:36.655 Ably: Channel state for channel "nack_on_connection_failure": suspended; reason: [ErrorInfo: Connection to server unavailable; statusCode=400; code=80002]
No transport established; closing connection and calling test.done()
21:14:36.659 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:36.659 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:36.660 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.660 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.660 Ably: Channel state for channel "nack_on_connection_failure": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” nack_on_connection_suspended
21:14:36.660 Ably: Connection state: connecting
21:14:36.728 Ably: Connection state: connected
21:14:36.729 Ably: Channel state for channel "nack_on_connection_failure": attaching
21:14:36.744 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.744 Ably: Channel state for channel "nack_on_connection_failure": attached
21:14:36.746 Ably: Connection state: failed; reason: connection failed because reasons, code: 40100
21:14:36.746 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.746 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.746 Ably: Channel state for channel "nack_on_connection_failure": failed; reason: [object Object]
No transport established; closing connection and calling test.done()
21:14:36.746 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:36.746 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” nack_on_connection_failed
21:14:36.747 Ably: Connection state: connecting
21:14:36.804 Ably: Connection state: connected
21:14:36.805 Ably: Channel state for channel "nack_on_connection_failure": attaching
21:14:36.818 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.818 Ably: Channel state for channel "nack_on_connection_failure": attached
21:14:36.818 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:36.819 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:36.819 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.819 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:36.819 Ably: Channel state for channel "nack_on_connection_failure": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
No transport established; closing connection and calling test.done()
âœ” nack_on_connection_closed
21:14:36.820 Ably: Connection state: connecting
21:14:36.899 Ably: Connection state: connected
21:14:37.168 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 200ms; assuming connection has dropped
21:14:37.168 Ably: Connection state: disconnected; reason: No activity seen from realtime in 200ms; assuming connection has dropped, code: 80003
21:14:37.168 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:14:37.171 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:37.171 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” idle_transport_timeout

[1mhistory.test.js[22m
âœ” setup_realtime_history
21:14:37.176 Ably: Connection state: connecting
21:14:37.282 Ably: Connection state: connected
21:14:42.282 Ably: Channel state for channel "persisted:history_until_attach": attaching
21:14:42.303 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:42.304 Ably: Channel state for channel "persisted:history_until_attach": attached
21:14:42.539 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:42.539 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:42.539 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:42.539 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:42.539 Ably: Channel state for channel "persisted:history_until_attach": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” history_until_attach

[1minit.test.js[22m
âœ” setupInit
21:14:42.558 Ably: Connection state: connecting
21:14:42.651 Ably: Connection state: connected
21:14:42.653 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:42.654 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” initbase0
21:14:42.656 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:14:42.660 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:42.661 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” init_key_string
21:14:42.780 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:14:42.782 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:42.782 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” init_token_string
21:14:42.783 Ably: Connection state: connecting
21:14:42.970 Ably: Connection state: connected
21:14:42.972 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:42.973 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” init_key_with_usetokenauth
21:14:42.975 Ably: Connection state: connecting
21:14:43.181 Ably: Connection state: connected
21:14:43.183 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:43.185 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” init_usetokenauth_defaulttokenparams_wildcard
21:14:43.186 Ably: Connection state: connecting
21:14:43.387 Ably: Connection state: connected
21:14:43.389 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:43.390 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” init_defaulttokenparams_nonwildcard
21:14:43.392 Ably: Connection state: connecting
21:14:43.615 Ably: Connection state: connected
21:14:43.617 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:43.619 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” init_conflicting_clientids
21:14:43.620 Ably: Auth(): Cannot authenticate with basic auth as a clientId implies token auth
âœ” init_with_usetokenauth_false_and_a_clientid
21:14:43.621 Ably: Connection state: connecting
21:14:43.839 Ably: Connection state: failed; reason: No application found with id not_a, code: 40400
21:14:43.840 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:43.840 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” init_defaulthost
21:14:43.841 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:14:43.842 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:43.842 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” init_timeouts
21:14:43.843 Ably: Connection state: connecting
21:14:44.541 Ably: Connection state: disconnected; reason: Unable to connect (and no more fallback hosts to try), code: 80000
No transport established; closing connection and calling test.done()
21:14:44.542 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:44.542 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” init_fallbacks
21:14:44.543 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:14:44.544 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:44.544 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” node_transports
21:14:44.546 Ably: Connection state: connecting
21:14:44.738 Ably: Connection state: connected
21:14:44.738 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:44.740 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” init_and_connection_details

[1mmessage.test.js[22m
âœ” setupMessage
21:14:44.751 Ably: Connection state: connecting
21:14:44.855 Ably: Connection state: connected
21:14:44.855 Ably: Channel state for channel "publishonce": attaching
21:14:45.104 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:45.104 Ably: Channel state for channel "publishonce": attached
21:14:45.134 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:45.135 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:45.135 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:45.136 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:45.136 Ably: Channel state for channel "publishonce": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishonce
21:14:45.138 Ably: Connection state: connecting
21:14:45.231 Ably: Connection state: connected
21:14:45.231 Ably: Channel state for channel "publishfast_9947632676650997": attaching
21:14:45.330 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:45.330 Ably: Channel state for channel "publishfast_9947632676650997": attached
21:14:45.844 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:45.845 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:45.845 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:45.845 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:45.845 Ably: Channel state for channel "publishfast_9947632676650997": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishfast_with_web_socket_binary_transport
21:14:45.858 Ably: Connection state: connecting
21:14:45.958 Ably: Connection state: connected
21:14:45.958 Ably: Channel state for channel "publishfast_6715889788061067": attaching
21:14:46.58 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:46.58 Ably: Channel state for channel "publishfast_6715889788061067": attached
21:14:46.573 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:46.573 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:46.573 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:46.573 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:46.573 Ably: Channel state for channel "publishfast_6715889788061067": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishfast_with_web_socket_text_transport
21:14:46.587 Ably: Connection state: connecting
21:14:46.694 Ably: Connection state: connected
21:14:46.694 Ably: Channel state for channel "publishfast_9238504099769995": attaching
21:14:47.213 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:47.213 Ably: Channel state for channel "publishfast_9238504099769995": attached
21:14:47.365 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:47.366 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:47.366 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:47.366 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:47.366 Ably: Channel state for channel "publishfast_9238504099769995": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishfast_with_comet_binary_transport
21:14:47.367 Ably: Connection state: connecting
21:14:47.456 Ably: Connection state: connected
21:14:47.457 Ably: Channel state for channel "publishfast_1285229960364631": attaching
21:14:47.717 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:47.717 Ably: Channel state for channel "publishfast_1285229960364631": attached
21:14:47.896 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:47.897 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:47.897 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:47.897 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:47.897 Ably: Channel state for channel "publishfast_1285229960364631": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishfast_with_comet_text_transport
21:14:47.898 Ably: Connection state: connecting
21:14:47.997 Ably: Connection state: connected
21:14:47.997 Ably: Channel state for channel "publishfast_47537157049512935": attaching
21:14:48.226 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:48.227 Ably: Channel state for channel "publishfast_47537157049512935": attached
21:14:48.244 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:14:48.760 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:48.760 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:48.760 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:48.760 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:48.760 Ably: Channel state for channel "publishfast_47537157049512935": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishfast_with_binary_transport
21:14:48.775 Ably: Connection state: connecting
21:14:48.862 Ably: Connection state: connected
21:14:48.862 Ably: Channel state for channel "publishfast_07642963700950745": attaching
21:14:49.51 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:49.51 Ably: Channel state for channel "publishfast_07642963700950745": attached
21:14:49.67 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:14:49.587 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:49.588 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:49.588 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:49.588 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:49.588 Ably: Channel state for channel "publishfast_07642963700950745": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishfast_with_text_transport
21:14:49.602 Ably: Channel state for channel "publishQueued_9243287167587442": attaching
21:14:49.602 Ably: Connection state: connecting
21:14:49.735 Ably: Connection state: connected
21:14:49.835 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:49.835 Ably: Channel state for channel "publishQueued_9243287167587442": attached
21:14:50.869 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:50.869 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:50.869 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:50.869 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:50.869 Ably: Channel state for channel "publishQueued_9243287167587442": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishQueued_with_web_socket_binary_transport
21:14:50.883 Ably: Channel state for channel "publishQueued_3643068205511597": attaching
21:14:50.884 Ably: Connection state: connecting
21:14:50.956 Ably: Connection state: connected
21:14:51.139 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:51.139 Ably: Channel state for channel "publishQueued_3643068205511597": attached
21:14:52.166 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:52.166 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:52.166 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:52.166 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:52.167 Ably: Channel state for channel "publishQueued_3643068205511597": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishQueued_with_web_socket_text_transport
21:14:52.181 Ably: Channel state for channel "publishQueued_8336147377895493": attaching
21:14:52.181 Ably: Connection state: connecting
21:14:52.344 Ably: Connection state: connected
21:14:52.675 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:52.675 Ably: Channel state for channel "publishQueued_8336147377895493": attached
21:14:53.229 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:53.230 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:53.230 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:53.230 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:53.230 Ably: Channel state for channel "publishQueued_8336147377895493": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishQueued_with_comet_binary_transport
21:14:53.231 Ably: Channel state for channel "publishQueued_8633422326713658": attaching
21:14:53.231 Ably: Connection state: connecting
21:14:53.371 Ably: Connection state: connected
21:14:53.711 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:53.711 Ably: Channel state for channel "publishQueued_8633422326713658": attached
21:14:54.243 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:54.244 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:54.244 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:54.244 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:54.244 Ably: Channel state for channel "publishQueued_8633422326713658": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishQueued_with_comet_text_transport
21:14:54.245 Ably: Channel state for channel "publishQueued_03261399338125459": attaching
21:14:54.246 Ably: Connection state: connecting
21:14:54.376 Ably: Connection state: connected
21:14:54.756 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:54.756 Ably: Channel state for channel "publishQueued_03261399338125459": attached
21:14:54.791 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:14:55.323 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:55.325 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:55.325 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:55.325 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:55.325 Ably: Channel state for channel "publishQueued_03261399338125459": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishQueued_with_binary_transport
21:14:55.340 Ably: Channel state for channel "publishQueued_4077475021285053": attaching
21:14:55.340 Ably: Connection state: connecting
21:14:55.441 Ably: Connection state: connected
21:14:55.610 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:55.610 Ably: Channel state for channel "publishQueued_4077475021285053": attached
21:14:55.626 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:14:56.668 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:56.668 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:56.668 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:56.668 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:56.669 Ably: Channel state for channel "publishQueued_4077475021285053": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishQueued_with_text_transport
21:14:56.686 Ably: Connection state: connecting
21:14:56.686 Ably: Connection state: connecting
21:14:56.687 Ably: Channel state for channel "publishecho": attaching
21:14:56.772 Ably: Connection state: connected
21:14:56.793 Ably: Connection state: connected
21:14:56.930 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:56.931 Ably: Channel state for channel "publishecho": attached
21:14:56.931 Ably: Channel state for channel "publishecho": attaching
21:14:56.946 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:14:56.951 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:56.951 Ably: Channel state for channel "publishecho": attached
21:14:56.982 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:56.983 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:56.983 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:56.983 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:56.983 Ably: Channel state for channel "publishecho": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:14:56.983 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:56.983 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:56.984 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:56.984 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:56.984 Ably: Channel state for channel "publishecho": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” publishEcho
21:14:57.1 Ably: Connection state: connecting
21:14:57.157 Ably: Connection state: connected
21:14:57.159 Ably: Channel state for channel "publishVariations": attaching
21:14:57.435 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:57.436 Ably: Channel state for channel "publishVariations": attached
21:14:57.452 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:14:59.735 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:14:59.735 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:14:59.735 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:59.735 Ably: PresenceMap.setInProgress(): inProgress = false
21:14:59.735 Ably: Channel state for channel "publishVariations": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishVariations
21:14:59.765 Ably: Connection state: connecting
21:14:59.854 Ably: Connection state: connected
21:14:59.855 Ably: Channel state for channel "publishDisallowed": attaching
21:15:0.103 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:0.103 Ably: Channel state for channel "publishDisallowed": attached
21:15:0.104 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:0.105 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:0.105 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:0.105 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:0.105 Ably: Channel state for channel "publishDisallowed": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishDisallowed
21:15:0.107 Ably: Connection state: connecting
21:15:0.189 Ably: Connection state: connected
21:15:0.189 Ably: Channel state for channel "publishEncodings": attaching
21:15:0.437 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:0.437 Ably: Channel state for channel "publishEncodings": attached
21:15:0.454 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:0.484 Ably: RealtimeChannel.onMessage(): [ErrorInfo: Error processing the utf-8 encoding, decoder returned â€˜Expected input of utf8Decode to be a buffer or CryptoJS WordArrayâ€™; statusCode=400; code=40013]
21:15:0.528 Ably: RealtimeChannel.onMessage(): [ErrorInfo: Error processing the choahofhpxf encoding, decoder returned â€˜Unknown encodingâ€™; statusCode=400; code=40013]
21:15:0.528 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:0.528 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:0.528 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:0.528 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:0.528 Ably: Channel state for channel "publishEncodings": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishEncodings
21:15:0.543 Ably: Connection state: connecting
21:15:0.543 Ably: Channel state for channel "restpublish": attaching
21:15:0.624 Ably: Connection state: connected
21:15:0.884 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:0.884 Ably: Channel state for channel "restpublish": attached
21:15:0.899 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:5.575 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:5.576 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:5.576 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:5.576 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:5.576 Ably: Channel state for channel "restpublish": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” restpublish
21:15:5.590 Ably: Connection state: connecting
21:15:5.591 Ably: Channel state for channel "publish {"transports":["web_socket"],"useBinaryProtocol":true}": attaching
sending: undefined
sending: undefined
21:15:5.647 Ably: Connection state: connected
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
21:15:5.749 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:5.749 Ably: Channel state for channel "publish {"transports":["web_socket"],"useBinaryProtocol":true}": attached
sending: undefined
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
sending: undefined
sending: undefined
publish callback called
publish callback called
publish callback called
21:15:6.269 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:6.269 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:6.269 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:6.269 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:6.269 Ably: Channel state for channel "publish {"transports":["web_socket"],"useBinaryProtocol":true}": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publish_with_web_socket_binary_transport
21:15:6.284 Ably: Connection state: connecting
21:15:6.284 Ably: Channel state for channel "publish {"transports":["web_socket"],"useBinaryProtocol":false}": attaching
sending: undefined
sending: undefined
21:15:6.346 Ably: Connection state: connected
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
21:15:6.531 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:6.532 Ably: Channel state for channel "publish {"transports":["web_socket"],"useBinaryProtocol":false}": attached
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
21:15:6.556 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:6.556 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:6.556 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:6.556 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:6.556 Ably: Channel state for channel "publish {"transports":["web_socket"],"useBinaryProtocol":false}": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publish_with_web_socket_text_transport
21:15:6.570 Ably: Connection state: connecting
21:15:6.571 Ably: Channel state for channel "publish {"transports":["comet"],"useBinaryProtocol":true}": attaching
sending: undefined
sending: undefined
sending: undefined
21:15:6.649 Ably: Connection state: connected
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
21:15:6.817 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:6.818 Ably: Channel state for channel "publish {"transports":["comet"],"useBinaryProtocol":true}": attached
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
21:15:6.849 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:6.849 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:6.849 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:6.849 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:6.849 Ably: Channel state for channel "publish {"transports":["comet"],"useBinaryProtocol":true}": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publish_with_comet_binary_transport
21:15:6.851 Ably: Connection state: connecting
21:15:6.851 Ably: Channel state for channel "publish {"transports":["comet"],"useBinaryProtocol":false}": attaching
sending: undefined
sending: undefined
sending: undefined
21:15:6.931 Ably: Connection state: connected
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
21:15:7.80 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:7.80 Ably: Channel state for channel "publish {"transports":["comet"],"useBinaryProtocol":false}": attached
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
21:15:7.110 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:7.111 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:7.111 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:7.111 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:7.111 Ably: Channel state for channel "publish {"transports":["comet"],"useBinaryProtocol":false}": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publish_with_comet_text_transport
21:15:7.112 Ably: Connection state: connecting
21:15:7.112 Ably: Channel state for channel "publish {"useBinaryProtocol":true}": attaching
sending: undefined
sending: undefined
sending: undefined
sending: undefined
21:15:7.201 Ably: Connection state: connected
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
21:15:7.440 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:7.440 Ably: Channel state for channel "publish {"useBinaryProtocol":true}": attached
21:15:7.455 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
21:15:7.469 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:7.469 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:7.469 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:7.469 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:7.469 Ably: Channel state for channel "publish {"useBinaryProtocol":true}": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publish_with_binary_transport
21:15:7.486 Ably: Connection state: connecting
21:15:7.486 Ably: Channel state for channel "publish {"useBinaryProtocol":false}": attaching
sending: undefined
sending: undefined
sending: undefined
sending: undefined
21:15:7.573 Ably: Connection state: connected
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
sending: undefined
21:15:7.822 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:7.822 Ably: Channel state for channel "publish {"useBinaryProtocol":false}": attached
21:15:7.840 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
publish callback called
21:15:7.853 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:7.853 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:7.853 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:7.854 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:7.854 Ably: Channel state for channel "publish {"useBinaryProtocol":false}": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publish_with_text_transport
21:15:7.872 Ably: Connection state: connecting
21:15:8.54 Ably: Connection state: connected
21:15:8.54 Ably: Channel state for channel "implicit_client_id_0": attaching
21:15:8.212 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:8.213 Ably: Channel state for channel "implicit_client_id_0": attached
21:15:8.227 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:8.233 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:8.234 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:8.234 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:8.234 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:8.234 Ably: Channel state for channel "implicit_client_id_0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” implicit_client_id_0
21:15:8.252 Ably: Connection state: connecting
21:15:8.510 Ably: Connection state: connected
21:15:8.510 Ably: Channel state for channel "explicit_client_id_0": attaching
21:15:8.732 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:8.732 Ably: Channel state for channel "explicit_client_id_0": attached
21:15:8.748 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:8.758 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:8.758 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:8.758 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:8.758 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:8.758 Ably: Channel state for channel "explicit_client_id_0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” explicit_client_id_0
21:15:8.901 Ably: Connection state: connecting
21:15:8.901 Ably: Channel state for channel "explicit_client_id_1": attaching
21:15:9.72 Ably: Connection state: connected
21:15:9.392 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:9.392 Ably: Channel state for channel "explicit_client_id_1": attached
21:15:9.411 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:9.415 Ably: Protocol.onNack(): serial = 0; count = 1; err = [ErrorInfo: Malformed message; mismatched clientId; statusCode=400; code=40012]
21:15:9.916 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:9.917 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:9.917 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:9.917 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:9.917 Ably: Channel state for channel "explicit_client_id_1": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” explicit_client_id_1
21:15:9.931 Ably: Connection state: connecting
21:15:10.10 Ably: Connection state: connected
21:15:10.11 Ably: Channel state for channel "subscribe_with_event_array": attaching
21:15:10.159 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:10.159 Ably: Channel state for channel "subscribe_with_event_array": attached
21:15:10.175 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:10.191 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:10.192 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:10.192 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:10.192 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:10.192 Ably: Channel state for channel "subscribe_with_event_array": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” subscribe_with_event_array
21:15:10.205 Ably: Connection state: connecting
21:15:10.286 Ably: Connection state: connected
21:15:10.287 Ably: Channel state for channel "extras_field": attaching
21:15:10.534 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:10.534 Ably: Channel state for channel "extras_field": attached
21:15:10.551 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:10.558 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:10.559 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:10.559 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:10.559 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:10.559 Ably: Channel state for channel "extras_field": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” extras_field

[1mpresence.test.js[22m
âœ” setupPresence
âœ” setupPresenceTokens
21:15:10.766 Ably: Connection state: connecting
21:15:10.844 Ably: Connection state: connected
Listener connected
21:15:10.845 Ably: Channel state for channel "attachAndEnter": attaching
21:15:11.93 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.93 Ably: Channel state for channel "attachAndEnter": attached
Listener attached to channel attachAndEnter
presenceChannel: attachAndEnter
21:15:11.94 Ably: Connection state: connecting
21:15:11.108 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:11.187 Ably: Connection state: connected
21:15:11.188 Ably: Channel state for channel "attachAndEnter": attaching
21:15:11.256 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.256 Ably: Channel state for channel "attachAndEnter": attached
21:15:11.271 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
in callback, err =  null
21:15:11.290 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:11.290 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:11.290 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.290 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.290 Ably: Channel state for channel "attachAndEnter": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:11.290 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:11.292 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:11.292 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.292 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.292 Ably: Channel state for channel "attachAndEnter": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceAttachAndEnter
21:15:11.307 Ably: Connection state: connecting
21:15:11.384 Ably: Connection state: connected
Listener connected
21:15:11.384 Ably: Channel state for channel "enterWithoutAttach": attaching
21:15:11.563 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.563 Ably: Channel state for channel "enterWithoutAttach": attached
Listener attached to channel enterWithoutAttach
presenceChannel: enterWithoutAttach
21:15:11.564 Ably: Connection state: connecting
21:15:11.578 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:11.654 Ably: Connection state: connected
21:15:11.654 Ably: Channel state for channel "enterWithoutAttach": attaching
21:15:11.743 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.743 Ably: Channel state for channel "enterWithoutAttach": attached
21:15:11.758 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
in callback, err =  null
21:15:11.767 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:11.767 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:11.767 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.767 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.768 Ably: Channel state for channel "enterWithoutAttach": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:11.768 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:11.768 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:11.768 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.768 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:11.768 Ably: Channel state for channel "enterWithoutAttach": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterWithoutAttach
21:15:11.784 Ably: Connection state: connecting
21:15:11.861 Ably: Connection state: connected
Listener connected
21:15:11.863 Ably: Channel state for channel "enterWithoutConnect": attaching
21:15:12.90 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.90 Ably: Channel state for channel "enterWithoutConnect": attached
Listener attached to channel enterWithoutConnect
presenceChannel: enterWithoutConnect
21:15:12.91 Ably: Connection state: connecting
21:15:12.92 Ably: Channel state for channel "enterWithoutConnect": attaching
21:15:12.106 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:12.171 Ably: Connection state: connected
21:15:12.230 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.230 Ably: Channel state for channel "enterWithoutConnect": attached
in callback, err =  null
21:15:12.254 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:12.255 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:12.255 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.255 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.255 Ably: Channel state for channel "enterWithoutConnect": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:12.255 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:12.255 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:12.255 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.255 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.255 Ably: Channel state for channel "enterWithoutConnect": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterWithoutConnect
21:15:12.272 Ably: Connection state: connecting
21:15:12.357 Ably: Connection state: connected
Listener connected
21:15:12.357 Ably: Channel state for channel "enterDetachRace": attaching
21:15:12.605 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.605 Ably: Channel state for channel "enterDetachRace": attached
Listener attached to channel enterDetachRace
21:15:12.606 Ably: Connection state: connecting
21:15:12.620 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:12.699 Ably: Connection state: connected
21:15:12.699 Ably: Channel state for channel "enterDetachRace": attaching
21:15:12.778 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.778 Ably: Channel state for channel "enterDetachRace": attached
21:15:12.779 Ably: Channel state for channel "enterDetachRace": detaching
21:15:12.802 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:12.803 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:12.803 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.803 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.803 Ably: Channel state for channel "enterDetachRace": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:12.803 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:12.803 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:12.803 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.803 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:12.804 Ably: Channel state for channel "enterDetachRace": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterDetachRace
21:15:12.823 Ably: Connection state: connecting
21:15:12.909 Ably: Connection state: connected
Listener connected
21:15:12.910 Ably: Channel state for channel "enterWithCallback": attaching
21:15:13.58 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.59 Ably: Channel state for channel "enterWithCallback": attached
Listener attached to channel enterWithCallback
presenceChannel: enterWithCallback
21:15:13.59 Ably: Connection state: connecting
21:15:13.74 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:13.168 Ably: Connection state: connected
21:15:13.169 Ably: Channel state for channel "enterWithCallback": attaching
21:15:13.237 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.237 Ably: Channel state for channel "enterWithCallback": attached
21:15:13.257 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
in callback, err =  null
21:15:13.262 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:13.263 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:13.263 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.263 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.263 Ably: Channel state for channel "enterWithCallback": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:13.263 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:13.263 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:13.263 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.263 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.263 Ably: Channel state for channel "enterWithCallback": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterWithCallback
21:15:13.281 Ably: Connection state: connecting
21:15:13.365 Ably: Connection state: connected
Listener connected
21:15:13.366 Ably: Channel state for channel "enterWithNothing": attaching
21:15:13.615 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.615 Ably: Channel state for channel "enterWithNothing": attached
Listener attached to channel enterWithNothing
presenceChannel: enterWithNothing
21:15:13.616 Ably: Connection state: connecting
21:15:13.629 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:13.701 Ably: Connection state: connected
21:15:13.701 Ably: Channel state for channel "enterWithNothing": attaching
21:15:13.770 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.770 Ably: Channel state for channel "enterWithNothing": attached
in callback, err =  null
21:15:13.792 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:13.792 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:13.792 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.792 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.792 Ably: Channel state for channel "enterWithNothing": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:13.792 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:13.793 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:13.793 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.793 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:13.793 Ably: Channel state for channel "enterWithNothing": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterWithNothing
21:15:13.809 Ably: Connection state: connecting
21:15:13.889 Ably: Connection state: connected
Listener connected
21:15:13.889 Ably: Channel state for channel "enterWithData": attaching
21:15:14.117 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:14.118 Ably: Channel state for channel "enterWithData": attached
Listener attached to channel enterWithData
presenceChannel: enterWithData
21:15:14.118 Ably: Connection state: connecting
21:15:14.132 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:14.210 Ably: Connection state: connected
21:15:14.210 Ably: Channel state for channel "enterWithData": attaching
21:15:14.288 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:14.289 Ably: Channel state for channel "enterWithData": attached
21:15:14.306 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
in callback, err =  null
21:15:14.324 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:14.324 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:14.324 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:14.324 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:14.324 Ably: Channel state for channel "enterWithData": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:14.325 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:14.325 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:14.325 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:14.325 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:14.325 Ably: Channel state for channel "enterWithData": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterWithData
21:15:14.341 Ably: Connection state: connecting
21:15:14.341 Ably: Channel state for channel "presenceMessageAction": attaching
21:15:14.423 Ably: Connection state: connected
21:15:14.671 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:14.672 Ably: Channel state for channel "presenceMessageAction": attached
21:15:14.691 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:14.694 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:14.694 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:14.694 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:14.694 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:14.694 Ably: Channel state for channel "presenceMessageAction": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” presenceMessageAction
21:15:14.697 Ably: Connection state: connecting
21:15:14.792 Ably: Connection state: connected
Listener connected
21:15:14.792 Ably: Channel state for channel "enterDetachEnter": attaching
21:15:15.31 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:15.31 Ably: Channel state for channel "enterDetachEnter": attached
Listener attached to channel enterDetachEnter
presenceChannel: enterDetachEnter
21:15:15.32 Ably: Connection state: connecting
21:15:15.47 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:15.110 Ably: Connection state: connected
21:15:15.111 Ably: Channel state for channel "enterDetachEnter": attaching
21:15:15.132 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:15.132 Ably: Channel state for channel "enterDetachEnter": attached
21:15:15.149 Ably: Channel state for channel "enterDetachEnter": detaching
21:15:15.160 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:15.160 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:15.160 Ably: Channel state for channel "enterDetachEnter": detached; reason: [ErrorInfo: Channel detached; statusCode=404; code=90001]
21:15:15.161 Ably: Channel state for channel "enterDetachEnter": attaching
21:15:15.171 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:15.174 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
in callback, err =  ErrorInfo {
  message: 'Channel attach timed out',
  code: 90007,
  statusCode: 408 }
21:15:25.162 Ably: Channel state for channel "enterDetachEnter": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:15:25.163 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:25.163 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:25.163 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.163 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.163 Ably: Channel state for channel "enterDetachEnter": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:25.163 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:25.163 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:25.163 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.163 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.163 Ably: Channel state for channel "enterDetachEnter": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
[31mâœ– presenceEnterDetachEnter[39m

Assertion Message: [35m408; Channel attach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/presence.test.js:77:12
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:726:13
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at done (/mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:241:17)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:44:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:723:17
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at Object.callback (/mnt/terra/home/simon/ably/ably-js/spec/realtime/presence.test.js:419:8)
    at RealtimePresence.failPendingPresence (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimepresence.js:340:30)
    at RealtimePresence.actOnChannelState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimepresence.js:330:10)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:440:17)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)

Error: Expected 4 assertions, 3 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:100:11
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:726:13
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at done (/mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:246:17)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:44:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:723:17
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:95:44
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)

21:15:25.181 Ably: Connection state: connecting
21:15:25.265 Ably: Connection state: connected
21:15:25.265 Ably: Channel state for channel "": attaching
21:15:25.322 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.322 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.322 Ably: Channel state for channel "": failed; reason: [ErrorInfo: Invalid channel id (); statusCode=400; code=40010]
21:15:25.322 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:25.322 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” presenceEnterInvalid
21:15:25.323 Ably: Connection state: connecting
21:15:25.409 Ably: Connection state: connected
Listener connected
21:15:25.409 Ably: Channel state for channel "enterAndLeave": attaching
21:15:25.577 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.577 Ably: Channel state for channel "enterAndLeave": attached
Listener attached to channel enterAndLeave
presenceChannel: enterAndLeave
21:15:25.578 Ably: Connection state: connecting
21:15:25.591 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:25.659 Ably: Connection state: connected
21:15:25.659 Ably: Channel state for channel "enterAndLeave": attaching
21:15:25.748 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.748 Ably: Channel state for channel "enterAndLeave": attached
21:15:25.767 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
in callback, err =  null
21:15:25.787 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:25.787 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:25.788 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.788 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.788 Ably: Channel state for channel "enterAndLeave": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:25.788 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:25.788 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:25.788 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.788 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:25.788 Ably: Channel state for channel "enterAndLeave": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterAndLeave
21:15:25.802 Ably: Connection state: connecting
21:15:25.888 Ably: Connection state: connected
Listener connected
21:15:25.889 Ably: Channel state for channel "enterUpdate": attaching
21:15:26.127 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.127 Ably: Channel state for channel "enterUpdate": attached
Listener attached to channel enterUpdate
presenceChannel: enterUpdate
21:15:26.128 Ably: Connection state: connecting
21:15:26.143 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:26.217 Ably: Connection state: connected
21:15:26.218 Ably: Channel state for channel "enterUpdate": attaching
21:15:26.285 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.286 Ably: Channel state for channel "enterUpdate": attached
21:15:26.305 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:26.310 Ably: PresenceMap.setInProgress(): inProgress = true
21:15:26.311 Ably: PresenceMap.setInProgress(): inProgress = false
in callback, err =  null
21:15:26.326 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:26.326 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:26.326 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.326 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.326 Ably: Channel state for channel "enterUpdate": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:26.326 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:26.326 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:26.326 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.326 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.326 Ably: Channel state for channel "enterUpdate": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterUpdate
21:15:26.343 Ably: Connection state: connecting
21:15:26.420 Ably: Connection state: connected
Listener connected
21:15:26.420 Ably: Channel state for channel "enterGet": attaching
21:15:26.669 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.669 Ably: Channel state for channel "enterGet": attached
Listener attached to channel enterGet
presenceChannel: enterGet
21:15:26.670 Ably: Connection state: connecting
21:15:26.684 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:26.754 Ably: Connection state: connected
21:15:26.755 Ably: Channel state for channel "enterGet": attaching
21:15:26.843 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.843 Ably: Channel state for channel "enterGet": attached
21:15:26.858 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
in callback, err =  null
21:15:26.877 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:26.877 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:26.877 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.877 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.877 Ably: Channel state for channel "enterGet": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:26.877 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:26.877 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:26.878 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.878 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:26.878 Ably: Channel state for channel "enterGet": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterGet
21:15:26.893 Ably: Connection state: connecting
21:15:26.974 Ably: Connection state: connected
21:15:26.974 Ably: Channel state for channel "subscribeUnattached": attaching
21:15:26.975 Ably: Connection state: connecting
21:15:27.203 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:27.203 Ably: Channel state for channel "subscribeUnattached": attached
21:15:27.216 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:32.61 Ably: Connection state: connected
21:15:32.62 Ably: Channel state for channel "subscribeUnattached": attaching
21:15:32.140 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:32.140 Ably: Channel state for channel "subscribeUnattached": attached
21:15:32.154 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:32.163 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:32.163 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:32.164 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:32.164 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:32.164 Ably: Channel state for channel "subscribeUnattached": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:15:32.164 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:15:32.164 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:15:32.164 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:32.164 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:32.164 Ably: Channel state for channel "subscribeUnattached": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceSubscribeUnattached
21:15:32.178 Ably: Connection state: connecting
21:15:32.269 Ably: Connection state: connected
21:15:32.269 Ably: Channel state for channel "getUnattached": attaching
21:15:32.438 Ably: PresenceMap.setInProgress(): inProgress = false
21:15:32.439 Ably: Channel state for channel "getUnattached": attached
21:15:32.454 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:15:32.465 Ably: Connection state: connecting
21:15:32.559 Ably: Connection state: connected
21:15:32.560 Ably: Channel state for channel "getUnattached": attaching
21:15:32.638 Ably: PresenceMap.setInProgress(): inProgress = true
21:15:32.638 Ably: Channel state for channel "getUnattached": attached
21:15:32.648 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– presenceGetUnattached[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 5 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:16:32.180 Ably: Connection state: connecting
21:16:32.281 Ably: Connection state: connected
Listener connected
21:16:32.281 Ably: Channel state for channel "enterLeaveGet": attaching
21:16:32.450 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:32.450 Ably: Channel state for channel "enterLeaveGet": attached
Listener attached to channel enterLeaveGet
presenceChannel: enterLeaveGet
21:16:32.451 Ably: Connection state: connecting
21:16:32.464 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:16:32.540 Ably: Connection state: connected
21:16:32.540 Ably: Channel state for channel "enterLeaveGet": attaching
21:16:32.599 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:32.599 Ably: Channel state for channel "enterLeaveGet": attached
21:16:32.612 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
in callback, err =  null
21:16:33.129 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:16:33.129 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:16:33.129 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:33.129 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:33.129 Ably: Channel state for channel "enterLeaveGet": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:16:33.130 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:16:33.130 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:16:33.130 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:33.130 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:33.130 Ably: Channel state for channel "enterLeaveGet": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterLeaveGet
21:16:33.144 Ably: Connection state: connecting
21:16:33.231 Ably: Connection state: connected
21:16:33.232 Ably: Channel state for channel "history": attaching
21:16:33.371 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:33.371 Ably: Channel state for channel "history": attached
21:16:33.386 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:16:33.904 Ably: Channel state for channel "history": detaching
21:16:33.917 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:33.917 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:33.917 Ably: Channel state for channel "history": detached; reason: [ErrorInfo: Channel detached; statusCode=404; code=90001]
21:16:33.956 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:16:33.957 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” presenceHistory
21:16:33.981 Ably: Connection state: connecting
21:16:34.162 Ably: Connection state: connected
21:16:34.162 Ably: Channel state for channel "historyUntilAttach": attaching
21:16:34.310 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:34.311 Ably: Channel state for channel "historyUntilAttach": attached
21:16:34.328 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:16:34.848 Ably: Channel state for channel "historyUntilAttach": detaching
21:16:34.862 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:34.862 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:34.862 Ably: Channel state for channel "historyUntilAttach": detached; reason: [ErrorInfo: Channel detached; statusCode=404; code=90001]
21:16:34.862 Ably: Channel state for channel "historyUntilAttach": attaching
21:16:34.876 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:16:34.878 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:16:42.560 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:16:42.561 Ably: Connection state: connecting; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:16:44.865 Ably: Channel state for channel "historyUntilAttach": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:16:44.866 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:16:44.866 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:16:44.866 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:44.866 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:44.867 Ably: Channel state for channel "historyUntilAttach": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
[31mâœ– presenceHistoryUntilAttach[39m

Assertion Message: [35mAttach failed with error: 408; Channel attach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/presence.test.js:781:11
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 6 assertions, 1 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:50:47
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at WebSocketTransport.onWsClose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:128:8)
    at WebSocket.wsConnection.onclose (/mnt/terra/home/simon/ably/ably-js/common/lib/transport/websockettransport.js:68:48)
    at WebSocket.onClose (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:446:14)
    at emitTwo (events.js:106:13)
    at WebSocket.emit (events.js:191:7)
    at WebSocket.cleanupWebsocketResources (/mnt/terra/home/simon/ably/ably-js/node_modules/ws/lib/WebSocket.js:950:8)
    at emitNone (events.js:91:20)

21:16:44.882 Ably: Connection state: connecting
21:16:44.960 Ably: Connection state: connected
21:16:44.961 Ably: Channel state for channel "secondConnection": attaching
21:16:45.130 Ably: PresenceMap.setInProgress(): inProgress = false
21:16:45.130 Ably: Channel state for channel "secondConnection": attached
21:16:45.143 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:16:45.159 Ably: Connection state: connecting
21:16:45.250 Ably: Connection state: connected
21:16:45.250 Ably: Channel state for channel "secondConnection": attaching
21:16:45.329 Ably: PresenceMap.setInProgress(): inProgress = true
21:16:45.329 Ably: Channel state for channel "secondConnection": attached
21:16:45.329 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– presenceSecondConnection[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:17:44.887 Ably: Connection state: connecting
21:17:44.888 Ably: Connection state: connecting
21:17:44.970 Ably: Connection state: connected
21:17:44.970 Ably: Channel state for channel "twoMembers": attaching
21:17:44.974 Ably: Connection state: connected
21:17:44.975 Ably: Channel state for channel "twoMembers": attaching
21:17:45.273 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.273 Ably: Channel state for channel "twoMembers": attached
21:17:45.279 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.279 Ably: Channel state for channel "twoMembers": attached
21:17:45.291 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:45.298 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:45.317 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:45.317 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:45.317 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.317 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.317 Ably: Channel state for channel "twoMembers": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:17:45.318 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:45.318 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:45.318 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.318 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.318 Ably: Channel state for channel "twoMembers": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceTwoMembers
21:17:45.343 Ably: Connection state: connecting
21:17:45.422 Ably: Connection state: connected
Listener connected
21:17:45.422 Ably: Channel state for channel "enterAfterClose": attaching
21:17:45.651 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.651 Ably: Channel state for channel "enterAfterClose": attached
Listener attached to channel enterAfterClose
presenceChannel: enterAfterClose
21:17:45.653 Ably: Connection state: connecting
21:17:45.666 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:45.749 Ably: Connection state: connected
21:17:45.750 Ably: Channel state for channel "enterAfterClose": attaching
21:17:45.818 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.819 Ably: Channel state for channel "enterAfterClose": attached
21:17:45.833 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:45.843 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:45.843 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:45.843 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.843 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.844 Ably: Channel state for channel "enterAfterClose": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:17:45.845 Ably: Connection state: connecting
21:17:45.922 Ably: Connection state: connected
21:17:45.922 Ably: Channel state for channel "enterAfterClose": attaching
21:17:45.939 Ably: PresenceMap.setInProgress(): inProgress = true
21:17:45.939 Ably: Channel state for channel "enterAfterClose": attached
21:17:45.941 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
in callback, err =  null
21:17:45.955 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:45.955 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:45.955 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.955 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.955 Ably: Channel state for channel "enterAfterClose": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:17:45.955 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:45.955 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:45.955 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.955 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:45.955 Ably: Channel state for channel "enterAfterClose": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEnterAfterClose
21:17:45.970 Ably: Connection state: connecting
21:17:46.49 Ably: Connection state: connected
21:17:46.49 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:46.50 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” presenceEnterClosed
21:17:46.51 Ably: Connection state: connecting
21:17:46.51 Ably: Channel state for channel "presenceClientIdIsImplicit": attaching
21:17:46.229 Ably: Connection state: connected
21:17:46.467 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:46.468 Ably: Channel state for channel "presenceClientIdIsImplicit": attached
21:17:46.485 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:47.16 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:47.17 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:47.17 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:47.17 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:47.17 Ably: Channel state for channel "presenceClientIdIsImplicit": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” presenceClientIdIsImplicit
21:17:47.33 Ably: Connection state: connecting
21:17:47.119 Ably: Connection state: connected
Listener connected
21:17:47.120 Ably: Channel state for channel "enterOn": attaching
21:17:47.278 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:47.278 Ably: Channel state for channel "enterOn": attached
Listener attached to channel enterOn
presenceChannel: enterOn
21:17:47.279 Ably: Deprecation warning - 'presence.on' is deprecated and will be removed from a future version. Please use 'presence.subscribe' instead.
21:17:47.279 Ably: Connection state: connecting
21:17:47.292 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:47.365 Ably: Connection state: connected
21:17:47.366 Ably: Channel state for channel "enterOn": attaching
21:17:47.434 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:47.434 Ably: Channel state for channel "enterOn": attached
in callback, err =  null
21:17:47.457 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:47.457 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:47.458 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:47.458 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:47.458 Ably: Channel state for channel "enterOn": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:17:47.458 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:47.458 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:47.458 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:47.458 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:47.458 Ably: Channel state for channel "enterOn": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceOn
realtimeBin
21:17:47.476 Ably: Connection state: connecting
21:17:47.555 Ably: Channel state for channel "presence-bin-encoding": attaching
21:17:47.555 Ably: Connection state: connected
21:17:47.827 Ably: PresenceMap.setInProgress(): inProgress = false
realtimeJson
21:17:47.828 Ably: Connection state: connecting
21:17:47.828 Ably: Channel state for channel "presence-bin-encoding": attached
21:17:47.897 Ably: Channel state for channel "presence-json-encoding": attaching
21:17:47.897 Ably: Connection state: connected
21:17:48.76 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.77 Ably: Channel state for channel "presence-json-encoding": attached
21:17:48.77 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:48.77 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:48.77 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.77 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.77 Ably: Channel state for channel "presence-bin-encoding": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:17:48.77 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:48.78 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:48.78 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.78 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.78 Ably: Channel state for channel "presence-json-encoding": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presenceEncoding
21:17:48.95 Ably: Connection state: connecting
21:17:48.180 Ably: Connection state: connected
Listener connected
21:17:48.180 Ably: Channel state for channel "enter_inherited_clientid": attaching
21:17:48.339 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.339 Ably: Channel state for channel "enter_inherited_clientid": attached
Listener attached to channel enter_inherited_clientid
presenceChannel: enter_inherited_clientid
21:17:48.340 Ably: Connection state: connecting
21:17:48.355 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:48.522 Ably: Connection state: connected
21:17:48.523 Ably: Channel state for channel "enter_inherited_clientid": attaching
21:17:48.591 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.591 Ably: Channel state for channel "enter_inherited_clientid": attached
in callback, err =  null
21:17:48.614 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:48.614 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:48.614 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.614 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.614 Ably: Channel state for channel "enter_inherited_clientid": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:17:48.615 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:48.615 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:48.615 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.615 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.615 Ably: Channel state for channel "enter_inherited_clientid": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presence_enter_inherited_clientid
21:17:48.635 Ably: Connection state: connecting
21:17:48.715 Ably: Connection state: connected
Listener connected
21:17:48.716 Ably: Channel state for channel "enter_before_know_clientid": attaching
21:17:48.934 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:48.935 Ably: Channel state for channel "enter_before_know_clientid": attached
Listener attached to channel enter_before_know_clientid
presenceChannel: enter_before_know_clientid
21:17:48.948 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:49.32 Ably: Channel state for channel "enter_before_know_clientid": attaching
21:17:49.32 Ably: Connection state: connecting
21:17:49.112 Ably: Connection state: connected
21:17:49.181 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:49.182 Ably: Channel state for channel "enter_before_know_clientid": attached
in callback, err =  null
21:17:49.206 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:49.206 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:49.206 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:49.206 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:49.206 Ably: Channel state for channel "enter_before_know_clientid": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:17:49.206 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:17:49.206 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:17:49.206 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:49.206 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:49.206 Ably: Channel state for channel "enter_before_know_clientid": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
âœ” presence_enter_before_know_clientid
21:17:49.223 Ably: Connection state: connecting
21:17:49.223 Ably: Connection state: connecting
21:17:49.305 Ably: Connection state: connected
21:17:49.305 Ably: Channel state for channel "presence_refresh_on_detach": attaching
21:17:49.309 Ably: Connection state: connected
21:17:49.458 Ably: PresenceMap.setInProgress(): inProgress = false
21:17:49.458 Ably: Channel state for channel "presence_refresh_on_detach": attached
21:17:49.473 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:49.491 Ably: Channel state for channel "presence_refresh_on_detach": attaching
21:17:49.514 Ably: PresenceMap.setInProgress(): inProgress = true
21:17:49.514 Ably: Channel state for channel "presence_refresh_on_detach": attached
21:17:49.517 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:17:55.248 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:17:55.249 Ably: Connection state: connecting; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:18:42.563 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:18:42.564 Ably: Channel state for channel "getUnattached": suspended; reason: [ErrorInfo: Connection to server unavailable; statusCode=400; code=80002]
21:18:42.564 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
[31mâœ– presence_refresh_on_detach[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 7 assertions, 1 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:18:49.224 Ably: Connection state: connecting
21:18:49.225 Ably: Connection state: connecting
21:18:49.329 Ably: Connection state: connected
21:18:49.329 Ably: Channel state for channel "presence_detach_during_sync": attaching
21:18:49.332 Ably: Connection state: connected
21:18:49.508 Ably: PresenceMap.setInProgress(): inProgress = false
21:18:49.509 Ably: Channel state for channel "presence_detach_during_sync": attached
21:18:49.530 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:18:49.534 Ably: Channel state for channel "presence_detach_during_sync": attaching
21:18:49.552 Ably: PresenceMap.setInProgress(): inProgress = true
21:18:49.552 Ably: Channel state for channel "presence_detach_during_sync": attached
21:18:49.553 Ably: Channel state for channel "presence_detach_during_sync": detaching
21:18:49.555 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:18:49.566 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:18:57.568 Ably: Connection state: connecting
21:18:57.649 Ably: Connection state: connected
21:18:57.649 Ably: Channel state for channel "getUnattached": attaching
21:18:57.707 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:18:57.718 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:18:59.554 Ably: PresenceMap.setInProgress(): inProgress = false
21:18:59.554 Ably: Channel state for channel "presence_detach_during_sync": attached; reason: [ErrorInfo: Channel detach timed out; statusCode=408; code=90007]
21:18:59.555 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:18:59.555 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:18:59.555 Ably: PresenceMap.setInProgress(): inProgress = false
21:18:59.555 Ably: PresenceMap.setInProgress(): inProgress = false
21:18:59.556 Ably: Channel state for channel "presence_detach_during_sync": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:18:59.556 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:18:59.556 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:18:59.556 Ably: PresenceMap.setInProgress(): inProgress = false
21:18:59.556 Ably: PresenceMap.setInProgress(): inProgress = false
21:18:59.556 Ably: Channel state for channel "presence_detach_during_sync": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
[31mâœ– presence_detach_during_sync[39m

Assertion Message: [35m408; Channel detach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/presence.test.js:1434:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:726:13
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:264:21
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:44:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:723:17
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:192:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:511:10)

21:18:59.572 Ably: Connection state: connecting
21:18:59.656 Ably: Connection state: connected
21:18:59.656 Ably: Channel state for channel "presence_auto_reenter": attaching
21:18:59.884 Ably: PresenceMap.setInProgress(): inProgress = false
21:18:59.884 Ably: Channel state for channel "presence_auto_reenter": attached
21:18:59.898 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:18:59.917 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:18:59.918 Ably: Connection state: connecting
21:18:59.918 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:18:59.918 Ably: Channel state for channel "presence_auto_reenter": suspended; reason: [ErrorInfo: Connection to server unavailable; statusCode=400; code=80002]
21:18:59.918 Ably: Connection state: connecting
21:19:0.2 Ably: Connection state: connected
21:19:0.2 Ably: Channel state for channel "presence_auto_reenter": attaching
21:19:0.27 Ably: PresenceMap.setInProgress(): inProgress = true
21:19:0.27 Ably: Channel state for channel "presence_auto_reenter": attached
21:19:0.32 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:19:7.652 Ably: Channel state for channel "getUnattached": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:19:7.653 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:19:7.653 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:19:7.653 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:7.653 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:7.653 Ably: Channel state for channel "getUnattached": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:19:7.653 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:19:7.653 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:19:7.653 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:7.653 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:7.653 Ably: Channel state for channel "getUnattached": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
Transport disposed; calling test.done()
[31mâœ– presenceGetUnattached[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 5 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mpresence get failed with error: 408; Channel attach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/presence.test.js:635:13
    at /mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimepresence.js:32:14
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 5 assertions, 4 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:100:11
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:726:13
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at done (/mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:246:17)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:44:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:723:17
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:95:44
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:82:5)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at WebSocketTransport.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)

21:19:7.772 Ably: Connection state: connecting
21:19:7.864 Ably: Connection state: connected
21:19:7.864 Ably: Channel state for channel "presence_failed_auto_reenter": attaching
21:19:8.103 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:8.103 Ably: Channel state for channel "presence_failed_auto_reenter": attached
21:19:8.105 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:19:8.105 Ably: Connection state: connecting
21:19:8.106 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:19:8.106 Ably: Channel state for channel "presence_failed_auto_reenter": suspended; reason: [ErrorInfo: Connection to server unavailable; statusCode=400; code=80002]
21:19:8.106 Ably: Connection state: connecting
21:19:8.192 Ably: Connection state: connected
21:19:8.193 Ably: Channel state for channel "presence_failed_auto_reenter": attaching
21:19:8.281 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:19:18.193 Ably: Channel state for channel "presence_failed_auto_reenter": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:19:18.207 Ably: Channel state for channel "presence_failed_auto_reenter": attaching
21:19:18.208 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:19:18.221 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:19:28.211 Ably: Channel state for channel "presence_failed_auto_reenter": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:19:55.249 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:19:55.249 Ably: Channel state for channel "secondConnection": suspended; reason: [ErrorInfo: Connection to server unavailable; statusCode=400; code=80002]
21:19:55.250 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:19:55.250 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:19:55.250 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:19:55.250 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:55.250 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:55.250 Ably: Channel state for channel "secondConnection": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
[31mâœ– presenceSecondConnection[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Assertion Message: [35mConnection monitoring: state changed to suspended, aborting test[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:32:11)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at Connection.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/client/connection.js:19:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

Error: Expected 3 assertions, 4 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:33:11)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at Connection.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/client/connection.js:19:10
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)

21:19:55.253 Ably: Connection state: connecting
21:19:55.317 Ably: Connection state: connected
21:19:55.317 Ably: Channel state for channel "multiple_pending": attaching
21:19:55.440 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:55.441 Ably: Channel state for channel "multiple_pending": attached
21:19:55.471 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:19:55.471 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:19:55.471 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:55.471 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:55.471 Ably: Channel state for channel "multiple_pending": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” multiple_pending
21:19:55.484 Ably: Connection state: connecting
21:19:55.485 Ably: Connection state: connecting
21:19:55.583 Ably: Connection state: connected
21:19:55.676 Ably: Connection state: connected
21:19:55.676 Ably: Channel state for channel "leave_published_for_member_missing_from_sync": attaching
21:19:55.851 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:55.851 Ably: Channel state for channel "leave_published_for_member_missing_from_sync": attached
21:19:55.866 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:19:55.883 Ably: Channel state for channel "leave_published_for_member_missing_from_sync": attaching
21:19:55.907 Ably: PresenceMap.setInProgress(): inProgress = true
21:19:55.907 Ably: Channel state for channel "leave_published_for_member_missing_from_sync": attached
21:19:55.911 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– presence_auto_reenter[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 7 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:19:59.577 Ably: Connection state: connecting
21:19:59.660 Ably: Connection state: connected
21:19:59.660 Ably: Channel state for channel "leave_published_for_members_on_presenceless_attached": attaching
21:19:59.898 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:59.899 Ably: Channel state for channel "leave_published_for_members_on_presenceless_attached": attached
21:19:59.900 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:59.901 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:19:59.901 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:19:59.901 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:59.901 Ably: PresenceMap.setInProgress(): inProgress = false
21:19:59.901 Ably: Channel state for channel "leave_published_for_members_on_presenceless_attached": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” leave_published_for_members_on_presenceless_attached
21:19:59.903 Ably: Connection state: connecting
21:19:59.903 Ably: Connection state: connecting
21:19:59.904 Ably: Connection state: connecting
21:20:0.94 Ably: Connection state: connected
21:20:0.94 Ably: Channel state for channel "suspended_preserves_presence": attaching
21:20:0.161 Ably: Connection state: connected
21:20:0.168 Ably: Connection state: connected
21:20:0.252 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:0.253 Ably: Channel state for channel "suspended_preserves_presence": attached
21:20:0.268 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:0.290 Ably: Channel state for channel "suspended_preserves_presence": attaching
21:20:0.315 Ably: PresenceMap.setInProgress(): inProgress = true
21:20:0.315 Ably: Channel state for channel "suspended_preserves_presence": attached
21:20:0.318 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:0.334 Ably: Channel state for channel "suspended_preserves_presence": attaching
21:20:0.348 Ably: PresenceMap.setInProgress(): inProgress = true
21:20:0.348 Ably: Channel state for channel "suspended_preserves_presence": attached
21:20:0.352 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:0.365 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:20:0.366 Ably: Connection state: connecting
21:20:0.366 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:20:0.366 Ably: Channel state for channel "suspended_preserves_presence": suspended; reason: [ErrorInfo: Connection to server unavailable; statusCode=400; code=80002]
21:20:0.367 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:20:0.368 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:20:0.368 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:0.368 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:0.368 Ably: Channel state for channel "suspended_preserves_presence": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:20:0.368 Ably: Connection state: connecting
21:20:0.431 Ably: Connection state: connected
21:20:0.431 Ably: Channel state for channel "suspended_preserves_presence": attaching
21:20:0.444 Ably: PresenceMap.setInProgress(): inProgress = true
21:20:0.444 Ably: Channel state for channel "suspended_preserves_presence": attached
21:20:0.447 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– presence_failed_auto_reenter[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 5 assertions, 2 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)


[1mreauth.test.js[22m
âœ” setupreauth
21:20:7.784 Ably: Connection state: connecting
21:20:7.840 Ably: Connection state: connected
21:20:7.841 Ably: Channel state for channel "rightchannel": attaching
21:20:7.853 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:7.853 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:7.853 Ably: Channel state for channel "rightchannel": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = rightchannel; statusCode=401; code=40160]
21:20:7.965 Ably: Channel state for channel "rightchannel": attaching
21:20:8.146 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:17.967 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
[31mâœ– reauthCapabilityUpgradeNewChannel_with_web_socket_binary_transport[39m

Assertion Message: [35mreauthCapabilityUpgradeNewChannel: 408; Channel attach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:90:5
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)

21:20:18.67 Ably: Connection state: connecting
21:20:18.150 Ably: Connection state: connected
21:20:18.150 Ably: Channel state for channel "rightchannel": attaching
21:20:18.164 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:18.164 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:18.164 Ably: Channel state for channel "rightchannel": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = rightchannel; statusCode=401; code=40160]
21:20:18.275 Ably: Channel state for channel "rightchannel": attaching
21:20:18.288 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:28.276 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
[31mâœ– reauthCapabilityUpgradeNewChannel_with_web_socket_text_transport[39m

Assertion Message: [35mreauthCapabilityUpgradeNewChannel: 408; Channel attach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:90:5
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)

21:20:28.373 Ably: Connection state: connecting
21:20:28.457 Ably: Connection state: connected
21:20:28.457 Ably: Channel state for channel "rightchannel": attaching
21:20:28.512 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:28.512 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:28.512 Ably: Channel state for channel "rightchannel": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = rightchannel; statusCode=401; code=40160]
21:20:28.628 Ably: Channel state for channel "rightchannel": attaching
21:20:28.655 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:32.968 Ably: Channel state for channel "rightchannel": attaching
21:20:32.981 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:38.629 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
[31mâœ– reauthCapabilityUpgradeNewChannel_with_comet_binary_transport[39m

Assertion Message: [35mreauthCapabilityUpgradeNewChannel: 408; Channel attach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:90:5
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)

21:20:38.729 Ably: Connection state: connecting
21:20:38.818 Ably: Connection state: connected
21:20:38.818 Ably: Channel state for channel "rightchannel": attaching
21:20:38.875 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:38.875 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:38.875 Ably: Channel state for channel "rightchannel": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = rightchannel; statusCode=401; code=40160]
21:20:38.994 Ably: Channel state for channel "rightchannel": attaching
21:20:39.27 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:42.969 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:20:43.277 Ably: Channel state for channel "rightchannel": attaching
21:20:43.318 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:48.995 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
[31mâœ– reauthCapabilityUpgradeNewChannel_with_comet_text_transport[39m

Assertion Message: [35mreauthCapabilityUpgradeNewChannel: 408; Channel attach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:90:5
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)

21:20:49.93 Ably: Connection state: connecting
21:20:49.172 Ably: Connection state: connected
21:20:49.174 Ably: Channel state for channel "rightchannel": attaching
21:20:49.232 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:49.232 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:49.232 Ably: Channel state for channel "rightchannel": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = rightchannel; statusCode=401; code=40160]
21:20:49.344 Ably: Channel state for channel "rightchannel": attaching
21:20:49.365 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:53.278 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:20:53.630 Ably: Channel state for channel "rightchannel": attaching
21:20:53.655 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– leave_published_for_member_missing_from_sync[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 6 assertions, 1 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

TypeError: Cannot read property 'setUp' of undefined
    at wrapGroup (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:285:14)
    at Object.exports.runSuite (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:93:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:125:21
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:513:13
    at iterate (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:123:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:134:25
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:515:17
    at Immediate.<anonymous> (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:146:17)
    at runCallback (timers.js:637:20)
    at tryOnImmediate (timers.js:610:5)
    at processImmediate [as _immediateCallback] (timers.js:582:5)
21:20:57.972 Ably: Channel state for channel "rightchannel": attaching
21:20:57.984 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:20:59.345 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
[31mâœ– reauthCapabilityUpgradeNewChannel_with_binary_transport[39m

Assertion Message: [35mreauthCapabilityUpgradeNewChannel: 408; Channel attach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:90:5
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)

21:20:59.442 Ably: Connection state: connecting
21:20:59.524 Ably: Connection state: connected
21:20:59.527 Ably: Channel state for channel "rightchannel": attaching
21:20:59.596 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:59.596 Ably: PresenceMap.setInProgress(): inProgress = false
21:20:59.596 Ably: Channel state for channel "rightchannel": failed; reason: [ErrorInfo: Channel denied access based on given capability; channelId = rightchannel; statusCode=401; code=40160]
21:20:59.705 Ably: Channel state for channel "rightchannel": attaching
21:20:59.717 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– suspended_preserves_presence[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Error: Expected 8 assertions, 6 ran
    at Object.done (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:121:25)
    at Object.test.done (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:139:22)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:143:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

TypeError: Cannot read property 'setUp' of undefined
    at wrapGroup (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:285:14)
    at Object.exports.runSuite (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:93:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/core.js:125:21
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:513:13
    at iterate (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:123:13)
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:134:25
    at /mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/deps/async.js:515:17
    at Immediate.<anonymous> (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:146:17)
    at runCallback (timers.js:637:20)
    at tryOnImmediate (timers.js:610:5)
    at processImmediate [as _immediateCallback] (timers.js:582:5)
21:21:3.631 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:3.996 Ably: Channel state for channel "rightchannel": attaching
21:21:4.26 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:7.972 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:8.277 Ably: Channel state for channel "rightchannel": attaching
21:21:8.291 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:9.706 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
[31mâœ– reauthCapabilityUpgradeNewChannel_with_text_transport[39m

Assertion Message: [35mreauthCapabilityUpgradeNewChannel: 408; Channel attach timed out[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:90:5
    at Object.<anonymous> (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:152:8)
    at callListener (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:14:13)
    at /mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:164:4
    at Array.forEach (native)
    at Function.Utils.arrForEach.Array.forEach.len [as arrForEach] (/mnt/terra/home/simon/ably/ably-js/common/lib/util/utils.js:250:8)
    at RealtimeChannel.EventEmitter.emit (/mnt/terra/home/simon/ably/ably-js/common/lib/util/eventemitter.js:163:9)
    at RealtimeChannel.notifyState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:467:8)
    at RealtimeChannel.timeoutPendingState (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:507:10)
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/common/lib/client/realtimechannel.js:525:10)

21:21:9.805 Ably: Connection state: connecting
21:21:9.890 Ably: Connection state: connected
21:21:9.890 Ably: Channel state for channel "channel": attaching
21:21:10.74 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:10.74 Ably: Channel state for channel "channel": attached
21:21:10.187 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:13.997 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:14.346 Ably: Channel state for channel "rightchannel": attaching
21:21:14.359 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– reauthCapabilityDowngradeFullChannel_with_web_socket_binary_transport[39m

Assertion Message: [35mreauthCapabilityDowngradeFullChannel: waitChannelState: expected state not reached within 5s. Expected failed, currently attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:113:5)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:21:15.284 Ably: Connection state: connecting
21:21:15.352 Ably: Connection state: connected
21:21:15.352 Ably: Channel state for channel "channel": attaching
21:21:15.370 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:15.371 Ably: Channel state for channel "channel": attached
21:21:15.482 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:18.278 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:18.631 Ably: Channel state for channel "rightchannel": attaching
21:21:18.655 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– reauthCapabilityDowngradeFullChannel_with_web_socket_text_transport[39m

Assertion Message: [35mreauthCapabilityDowngradeFullChannel: waitChannelState: expected state not reached within 5s. Expected failed, currently attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:113:5)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:21:20.580 Ably: Connection state: connecting
21:21:20.666 Ably: Connection state: connected
21:21:20.667 Ably: Channel state for channel "channel": attaching
21:21:20.745 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:20.745 Ably: Channel state for channel "channel": attached
21:21:20.866 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:22.973 Ably: Channel state for channel "rightchannel": attaching
21:21:22.985 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:24.346 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:24.707 Ably: Channel state for channel "rightchannel": attaching
21:21:24.719 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– reauthCapabilityDowngradeFullChannel_with_comet_binary_transport[39m

Assertion Message: [35mreauthCapabilityDowngradeFullChannel: waitChannelState: expected state not reached within 5s. Expected failed, currently attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:113:5)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:21:25.959 Ably: Connection state: connecting
21:21:26.41 Ably: Connection state: connected
21:21:26.41 Ably: Channel state for channel "channel": attaching
21:21:26.109 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:26.110 Ably: Channel state for channel "channel": attached
21:21:26.230 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:28.631 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:28.998 Ably: Channel state for channel "rightchannel": attaching
21:21:29.26 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– reauthCapabilityDowngradeFullChannel_with_comet_text_transport[39m

Assertion Message: [35mreauthCapabilityDowngradeFullChannel: waitChannelState: expected state not reached within 5s. Expected failed, currently attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:113:5)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:21:31.323 Ably: Connection state: connecting
21:21:31.433 Ably: Connection state: connected
21:21:31.435 Ably: Channel state for channel "channel": attaching
21:21:31.512 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:31.512 Ably: Channel state for channel "channel": attached
21:21:31.535 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:31.624 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:32.974 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:33.278 Ably: Channel state for channel "rightchannel": attaching
21:21:33.292 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:34.708 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
[31mâœ– reauthCapabilityDowngradeFullChannel_with_binary_transport[39m

Assertion Message: [35mreauthCapabilityDowngradeFullChannel: waitChannelState: expected state not reached within 5s. Expected failed, currently attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:113:5)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:21:36.754 Ably: Connection state: connecting
21:21:36.842 Ably: Connection state: connected
21:21:36.845 Ably: Channel state for channel "channel": attaching
21:21:36.911 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:36.911 Ably: Channel state for channel "channel": attached
21:21:36.924 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:37.23 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:38.999 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:39.346 Ably: Channel state for channel "rightchannel": attaching
21:21:39.360 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– reauthCapabilityDowngradeFullChannel_with_text_transport[39m

Assertion Message: [35mreauthCapabilityDowngradeFullChannel: waitChannelState: expected state not reached within 5s. Expected failed, currently attached[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at /mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:172:10
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:52:16
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:696:30
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:167:37
    at /mnt/terra/home/simon/ably/ably-js/node_modules/async/lib/async.js:1209:30
    at Timeout._onTimeout (/mnt/terra/home/simon/ably/ably-js/spec/realtime/reauth.test.js:113:5)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

21:21:42.124 Ably: Connection state: connecting
21:21:42.190 Ably: Connection state: connected
21:21:42.190 Ably: Channel state for channel "channel": attaching
21:21:42.205 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:42.205 Ably: Channel state for channel "channel": attached
21:21:42.218 Ably: Protocol.onNack(): serial = 0; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:42.329 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:42.345 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:42.345 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:42.345 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:42.345 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:42.347 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityUpgradeAddPublish_with_web_socket_binary_transport
21:21:42.444 Ably: Connection state: connecting
21:21:42.518 Ably: Connection state: connected
21:21:42.519 Ably: Channel state for channel "channel": attaching
21:21:42.530 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:42.530 Ably: Channel state for channel "channel": attached
21:21:42.543 Ably: Protocol.onNack(): serial = 0; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:42.663 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:42.678 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:42.678 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:42.678 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:42.678 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:42.678 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityUpgradeAddPublish_with_web_socket_text_transport
21:21:42.775 Ably: Connection state: connecting
21:21:42.880 Ably: Connection state: connected
21:21:42.880 Ably: Channel state for channel "channel": attaching
21:21:42.939 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:42.939 Ably: Channel state for channel "channel": attached
21:21:42.957 Ably: Protocol.onNack(): serial = 0; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:43.79 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:43.93 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:43.94 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:43.95 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:43.95 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:43.95 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityUpgradeAddPublish_with_comet_binary_transport
21:21:43.194 Ably: Connection state: connecting
21:21:43.274 Ably: Connection state: connected
21:21:43.274 Ably: Channel state for channel "channel": attaching
21:21:43.278 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:43.344 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:43.344 Ably: Channel state for channel "channel": attached
21:21:43.360 Ably: Protocol.onNack(): serial = 0; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:43.483 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:43.493 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:43.493 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:43.493 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:43.493 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:43.493 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityUpgradeAddPublish_with_comet_text_transport
21:21:43.593 Ably: Connection state: connecting
21:21:43.631 Ably: Channel state for channel "rightchannel": attaching
21:21:43.661 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:43.671 Ably: Connection state: connected
21:21:43.673 Ably: Channel state for channel "channel": attaching
21:21:43.760 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:43.760 Ably: Channel state for channel "channel": attached
21:21:43.775 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:43.786 Ably: Protocol.onNack(): serial = 0; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:43.899 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:43.918 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:43.919 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:43.919 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:43.919 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:43.919 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityUpgradeAddPublish_with_binary_transport
21:21:44.16 Ably: Connection state: connecting
21:21:44.97 Ably: Connection state: connected
21:21:44.99 Ably: Channel state for channel "channel": attaching
21:21:44.175 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:44.175 Ably: Channel state for channel "channel": attached
21:21:44.188 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:44.201 Ably: Protocol.onNack(): serial = 0; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:44.312 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:44.326 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:44.326 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:44.326 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:44.326 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:44.326 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityUpgradeAddPublish_with_text_transport
21:21:44.423 Ably: Connection state: connecting
21:21:44.478 Ably: Connection state: connected
21:21:44.478 Ably: Channel state for channel "channel": attaching
21:21:44.490 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:44.490 Ably: Channel state for channel "channel": attached
21:21:44.627 Ably: Protocol.onNack(): serial = 1; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:44.627 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:44.627 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:44.628 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:44.628 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:44.628 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityDowngradePublish_with_web_socket_binary_transport
21:21:44.725 Ably: Connection state: connecting
21:21:44.791 Ably: Connection state: connected
21:21:44.791 Ably: Channel state for channel "channel": attaching
21:21:44.803 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:44.803 Ably: Channel state for channel "channel": attached
21:21:44.940 Ably: Protocol.onNack(): serial = 1; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:44.940 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:44.940 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:44.940 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:44.940 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:44.940 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityDowngradePublish_with_web_socket_text_transport
21:21:45.37 Ably: Connection state: connecting
21:21:45.130 Ably: Connection state: connected
21:21:45.130 Ably: Channel state for channel "channel": attaching
21:21:45.189 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:45.189 Ably: Channel state for channel "channel": attached
21:21:45.341 Ably: Protocol.onNack(): serial = 1; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:45.341 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:45.342 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:45.342 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:45.342 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:45.342 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityDowngradePublish_with_comet_binary_transport
21:21:45.441 Ably: Connection state: connecting
21:21:45.527 Ably: Connection state: connected
21:21:45.527 Ably: Channel state for channel "channel": attaching
21:21:45.586 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:45.586 Ably: Channel state for channel "channel": attached
21:21:45.741 Ably: Protocol.onNack(): serial = 1; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:45.741 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:45.741 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:45.741 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:45.741 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:45.741 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityDowngradePublish_with_comet_text_transport
21:21:45.840 Ably: Connection state: connecting
21:21:45.924 Ably: Connection state: connected
21:21:45.926 Ably: Channel state for channel "channel": attaching
21:21:46.13 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:46.13 Ably: Channel state for channel "channel": attached
21:21:46.26 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:46.160 Ably: Protocol.onNack(): serial = 1; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:46.161 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:46.161 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:46.161 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:46.161 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:46.161 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityDowngradePublish_with_binary_transport
21:21:46.259 Ably: Connection state: connecting
21:21:46.342 Ably: Connection state: connected
21:21:46.343 Ably: Channel state for channel "channel": attaching
21:21:46.401 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:46.401 Ably: Channel state for channel "channel": attached
21:21:46.416 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:21:46.555 Ably: Protocol.onNack(): serial = 1; count = 1; err = [ErrorInfo: Unable to perform channel operation (permission denied); statusCode=401; code=40160]
21:21:46.555 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:46.555 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:46.555 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:46.555 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:46.555 Ably: Channel state for channel "channel": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” reauthCapabilityDowngradePublish_with_text_transport

[1mresume.test.js[22m
âœ” setupResume
21:21:46.561 Ably: Connection state: connecting
21:21:46.561 Ably: Channel state for channel "resume_inactive0.7753725514048391": attaching
21:21:46.618 Ably: Connection state: connected
21:21:46.720 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:46.720 Ably: Channel state for channel "resume_inactive0.7753725514048391": attached
sending phase 1, message 0 at Thu Mar 02 2017 21:21:46 GMT+0000 (GMT)
received phase 1, message 0 at Thu Mar 02 2017 21:21:46 GMT+0000 (GMT)
sending phase 1, message 1 at Thu Mar 02 2017 21:21:47 GMT+0000 (GMT)
received phase 1, message 1 at Thu Mar 02 2017 21:21:47 GMT+0000 (GMT)
21:21:47.975 Ably: Channel state for channel "rightchannel": attaching
21:21:47.988 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 1, message 2 at Thu Mar 02 2017 21:21:48 GMT+0000 (GMT)
received phase 1, message 2 at Thu Mar 02 2017 21:21:48 GMT+0000 (GMT)
sending phase 1, message 3 at Thu Mar 02 2017 21:21:49 GMT+0000 (GMT)
received phase 1, message 3 at Thu Mar 02 2017 21:21:49 GMT+0000 (GMT)
21:21:49.346 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:49.708 Ably: Channel state for channel "rightchannel": attaching
21:21:49.720 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 1, message 4 at Thu Mar 02 2017 21:21:50 GMT+0000 (GMT)
received phase 1, message 4 at Thu Mar 02 2017 21:21:50 GMT+0000 (GMT)
phase 1 sent all messages, time:  Thu Mar 02 2017 21:21:50 GMT+0000 (GMT)
starting phase 2, time:  Thu Mar 02 2017 21:21:50 GMT+0000 (GMT)
21:21:50.29 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:21:53.632 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:53.999 Ably: Channel state for channel "rightchannel": attaching
21:21:54.25 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
starting phase 3, time:  Thu Mar 02 2017 21:21:55 GMT+0000 (GMT)
21:21:55.29 Ably: Connection state: connecting
starting phase 4, time:  Thu Mar 02 2017 21:21:55 GMT+0000 (GMT)
sending phase 4, message 0 at Thu Mar 02 2017 21:21:55 GMT+0000 (GMT)
21:21:55.103 Ably: Connection state: connected
received phase 4, message 0 at Thu Mar 02 2017 21:21:55 GMT+0000 (GMT)
sending phase 4, message 1 at Thu Mar 02 2017 21:21:55 GMT+0000 (GMT)
received phase 4, message 1 at Thu Mar 02 2017 21:21:55 GMT+0000 (GMT)
sending phase 4, message 2 at Thu Mar 02 2017 21:21:56 GMT+0000 (GMT)
received phase 4, message 2 at Thu Mar 02 2017 21:21:56 GMT+0000 (GMT)
sending phase 4, message 3 at Thu Mar 02 2017 21:21:57 GMT+0000 (GMT)
received phase 4, message 3 at Thu Mar 02 2017 21:21:57 GMT+0000 (GMT)
21:21:57.976 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:21:58.279 Ably: Channel state for channel "rightchannel": attaching
21:21:58.293 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 4, message 4 at Thu Mar 02 2017 21:21:58 GMT+0000 (GMT)
received phase 4, message 4 at Thu Mar 02 2017 21:21:58 GMT+0000 (GMT)
phase 4 sent all messages, time:  Thu Mar 02 2017 21:21:58 GMT+0000 (GMT)
21:21:58.424 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:21:58.424 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:21:58.425 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:58.425 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:58.425 Ably: Channel state for channel "resume_inactive0.7753725514048391": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_inactive_with_web_socket_binary_transport
21:21:58.439 Ably: Connection state: connecting
21:21:58.439 Ably: Channel state for channel "resume_inactive0.9749734646607431": attaching
21:21:58.506 Ably: Connection state: connected
21:21:58.686 Ably: PresenceMap.setInProgress(): inProgress = false
21:21:58.686 Ably: Channel state for channel "resume_inactive0.9749734646607431": attached
sending phase 1, message 0 at Thu Mar 02 2017 21:21:58 GMT+0000 (GMT)
received phase 1, message 0 at Thu Mar 02 2017 21:21:58 GMT+0000 (GMT)
sending phase 1, message 1 at Thu Mar 02 2017 21:21:59 GMT+0000 (GMT)
received phase 1, message 1 at Thu Mar 02 2017 21:21:59 GMT+0000 (GMT)
21:21:59.709 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
sending phase 1, message 2 at Thu Mar 02 2017 21:22:00 GMT+0000 (GMT)
received phase 1, message 2 at Thu Mar 02 2017 21:22:00 GMT+0000 (GMT)
sending phase 1, message 3 at Thu Mar 02 2017 21:22:01 GMT+0000 (GMT)
received phase 1, message 3 at Thu Mar 02 2017 21:22:01 GMT+0000 (GMT)
sending phase 1, message 4 at Thu Mar 02 2017 21:22:01 GMT+0000 (GMT)
received phase 1, message 4 at Thu Mar 02 2017 21:22:02 GMT+0000 (GMT)
phase 1 sent all messages, time:  Thu Mar 02 2017 21:22:02 GMT+0000 (GMT)
starting phase 2, time:  Thu Mar 02 2017 21:22:02 GMT+0000 (GMT)
21:22:2.5 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:22:4.0 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:4.345 Ably: Channel state for channel "rightchannel": attaching
21:22:4.361 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
starting phase 3, time:  Thu Mar 02 2017 21:22:07 GMT+0000 (GMT)
21:22:7.5 Ably: Connection state: connecting
starting phase 4, time:  Thu Mar 02 2017 21:22:07 GMT+0000 (GMT)
sending phase 4, message 0 at Thu Mar 02 2017 21:22:07 GMT+0000 (GMT)
21:22:7.78 Ably: Connection state: connected
received phase 4, message 0 at Thu Mar 02 2017 21:22:07 GMT+0000 (GMT)
sending phase 4, message 1 at Thu Mar 02 2017 21:22:07 GMT+0000 (GMT)
received phase 4, message 1 at Thu Mar 02 2017 21:22:07 GMT+0000 (GMT)
21:22:8.279 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:8.632 Ably: Channel state for channel "rightchannel": attaching
21:22:8.661 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 4, message 2 at Thu Mar 02 2017 21:22:08 GMT+0000 (GMT)
received phase 4, message 2 at Thu Mar 02 2017 21:22:08 GMT+0000 (GMT)
sending phase 4, message 3 at Thu Mar 02 2017 21:22:09 GMT+0000 (GMT)
received phase 4, message 3 at Thu Mar 02 2017 21:22:09 GMT+0000 (GMT)
sending phase 4, message 4 at Thu Mar 02 2017 21:22:10 GMT+0000 (GMT)
received phase 4, message 4 at Thu Mar 02 2017 21:22:10 GMT+0000 (GMT)
phase 4 sent all messages, time:  Thu Mar 02 2017 21:22:10 GMT+0000 (GMT)
21:22:10.379 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:22:10.380 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:22:10.380 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:10.380 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:10.380 Ably: Channel state for channel "resume_inactive0.9749734646607431": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_inactive_with_web_socket_text_transport
21:22:10.396 Ably: Connection state: connecting
21:22:10.396 Ably: Channel state for channel "resume_inactive0.007674655131445274": attaching
21:22:10.508 Ably: Connection state: connected
21:22:10.686 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:10.686 Ably: Channel state for channel "resume_inactive0.007674655131445274": attached
sending phase 1, message 0 at Thu Mar 02 2017 21:22:10 GMT+0000 (GMT)
received phase 1, message 0 at Thu Mar 02 2017 21:22:10 GMT+0000 (GMT)
sending phase 1, message 1 at Thu Mar 02 2017 21:22:11 GMT+0000 (GMT)
received phase 1, message 1 at Thu Mar 02 2017 21:22:11 GMT+0000 (GMT)
sending phase 1, message 2 at Thu Mar 02 2017 21:22:12 GMT+0000 (GMT)
received phase 1, message 2 at Thu Mar 02 2017 21:22:12 GMT+0000 (GMT)
21:22:12.977 Ably: Channel state for channel "rightchannel": attaching
21:22:12.990 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 1, message 3 at Thu Mar 02 2017 21:22:13 GMT+0000 (GMT)
received phase 1, message 3 at Thu Mar 02 2017 21:22:13 GMT+0000 (GMT)
sending phase 1, message 4 at Thu Mar 02 2017 21:22:14 GMT+0000 (GMT)
received phase 1, message 4 at Thu Mar 02 2017 21:22:14 GMT+0000 (GMT)
phase 1 sent all messages, time:  Thu Mar 02 2017 21:22:14 GMT+0000 (GMT)
starting phase 2, time:  Thu Mar 02 2017 21:22:14 GMT+0000 (GMT)
21:22:14.76 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:22:14.346 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:14.710 Ably: Channel state for channel "rightchannel": attaching
21:22:14.721 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:22:18.633 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:19.0 Ably: Channel state for channel "rightchannel": attaching
21:22:19.25 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
starting phase 3, time:  Thu Mar 02 2017 21:22:19 GMT+0000 (GMT)
21:22:19.76 Ably: Connection state: connecting
starting phase 4, time:  Thu Mar 02 2017 21:22:19 GMT+0000 (GMT)
sending phase 4, message 0 at Thu Mar 02 2017 21:22:19 GMT+0000 (GMT)
21:22:19.162 Ably: Connection state: connected
received phase 4, message 0 at Thu Mar 02 2017 21:22:19 GMT+0000 (GMT)
sending phase 4, message 1 at Thu Mar 02 2017 21:22:19 GMT+0000 (GMT)
received phase 4, message 1 at Thu Mar 02 2017 21:22:20 GMT+0000 (GMT)
sending phase 4, message 2 at Thu Mar 02 2017 21:22:20 GMT+0000 (GMT)
received phase 4, message 2 at Thu Mar 02 2017 21:22:20 GMT+0000 (GMT)
sending phase 4, message 3 at Thu Mar 02 2017 21:22:21 GMT+0000 (GMT)
received phase 4, message 3 at Thu Mar 02 2017 21:22:21 GMT+0000 (GMT)
sending phase 4, message 4 at Thu Mar 02 2017 21:22:22 GMT+0000 (GMT)
received phase 4, message 4 at Thu Mar 02 2017 21:22:22 GMT+0000 (GMT)
phase 4 sent all messages, time:  Thu Mar 02 2017 21:22:22 GMT+0000 (GMT)
21:22:22.509 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:22:22.511 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:22:22.511 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:22.511 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:22.511 Ably: Channel state for channel "resume_inactive0.007674655131445274": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_inactive_with_comet_binary_transport
21:22:22.513 Ably: Connection state: connecting
21:22:22.514 Ably: Channel state for channel "resume_inactive0.6616906016034678": attaching
21:22:22.594 Ably: Connection state: connected
21:22:22.833 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:22.833 Ably: Channel state for channel "resume_inactive0.6616906016034678": attached
sending phase 1, message 0 at Thu Mar 02 2017 21:22:22 GMT+0000 (GMT)
received phase 1, message 0 at Thu Mar 02 2017 21:22:22 GMT+0000 (GMT)
21:22:22.978 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:23.280 Ably: Channel state for channel "rightchannel": attaching
21:22:23.293 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 1, message 1 at Thu Mar 02 2017 21:22:23 GMT+0000 (GMT)
received phase 1, message 1 at Thu Mar 02 2017 21:22:23 GMT+0000 (GMT)
sending phase 1, message 2 at Thu Mar 02 2017 21:22:24 GMT+0000 (GMT)
received phase 1, message 2 at Thu Mar 02 2017 21:22:24 GMT+0000 (GMT)
21:22:24.710 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
sending phase 1, message 3 at Thu Mar 02 2017 21:22:25 GMT+0000 (GMT)
received phase 1, message 3 at Thu Mar 02 2017 21:22:25 GMT+0000 (GMT)
sending phase 1, message 4 at Thu Mar 02 2017 21:22:26 GMT+0000 (GMT)
received phase 1, message 4 at Thu Mar 02 2017 21:22:26 GMT+0000 (GMT)
phase 1 sent all messages, time:  Thu Mar 02 2017 21:22:26 GMT+0000 (GMT)
starting phase 2, time:  Thu Mar 02 2017 21:22:26 GMT+0000 (GMT)
21:22:26.183 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:22:29.1 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:29.346 Ably: Channel state for channel "rightchannel": attaching
21:22:29.360 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:22:30.666 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:22:30.667 Ably: Connection state: disconnected; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:22:30.668 Ably: Connection state: connecting
21:22:30.764 Ably: Connection state: connected
starting phase 3, time:  Thu Mar 02 2017 21:22:31 GMT+0000 (GMT)
21:22:31.184 Ably: Connection state: connecting
starting phase 4, time:  Thu Mar 02 2017 21:22:31 GMT+0000 (GMT)
sending phase 4, message 0 at Thu Mar 02 2017 21:22:31 GMT+0000 (GMT)
21:22:31.269 Ably: Connection state: connected
received phase 4, message 0 at Thu Mar 02 2017 21:22:31 GMT+0000 (GMT)
sending phase 4, message 1 at Thu Mar 02 2017 21:22:32 GMT+0000 (GMT)
received phase 4, message 1 at Thu Mar 02 2017 21:22:32 GMT+0000 (GMT)
sending phase 4, message 2 at Thu Mar 02 2017 21:22:32 GMT+0000 (GMT)
received phase 4, message 2 at Thu Mar 02 2017 21:22:32 GMT+0000 (GMT)
21:22:33.280 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:33.634 Ably: Channel state for channel "rightchannel": attaching
21:22:33.666 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 4, message 3 at Thu Mar 02 2017 21:22:33 GMT+0000 (GMT)
received phase 4, message 3 at Thu Mar 02 2017 21:22:33 GMT+0000 (GMT)
sending phase 4, message 4 at Thu Mar 02 2017 21:22:34 GMT+0000 (GMT)
received phase 4, message 4 at Thu Mar 02 2017 21:22:34 GMT+0000 (GMT)
phase 4 sent all messages, time:  Thu Mar 02 2017 21:22:34 GMT+0000 (GMT)
21:22:34.596 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:22:34.598 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:22:34.598 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:34.598 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:34.598 Ably: Channel state for channel "resume_inactive0.6616906016034678": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_inactive_with_comet_text_transport
21:22:34.600 Ably: Connection state: connecting
21:22:34.600 Ably: Channel state for channel "resume1": attaching
21:22:34.657 Ably: Connection state: connected
21:22:34.839 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:34.839 Ably: Channel state for channel "resume1": attached
sending phase 1, message 0 at Thu Mar 02 2017 21:22:34 GMT+0000 (GMT)
received phase 1, message 0 at Thu Mar 02 2017 21:22:34 GMT+0000 (GMT)
sending phase 1, message 1 at Thu Mar 02 2017 21:22:35 GMT+0000 (GMT)
received phase 1, message 1 at Thu Mar 02 2017 21:22:35 GMT+0000 (GMT)
21:22:36.39 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:22:36.40 Ably: Connection state: disconnected; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:22:36.41 Ably: Connection state: connecting
21:22:36.125 Ably: Connection state: connected
sending phase 1, message 2 at Thu Mar 02 2017 21:22:36 GMT+0000 (GMT)
received phase 1, message 2 at Thu Mar 02 2017 21:22:36 GMT+0000 (GMT)
sending phase 1, message 3 at Thu Mar 02 2017 21:22:37 GMT+0000 (GMT)
received phase 1, message 3 at Thu Mar 02 2017 21:22:37 GMT+0000 (GMT)
21:22:37.978 Ably: Channel state for channel "rightchannel": attaching
21:22:37.991 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 1, message 4 at Thu Mar 02 2017 21:22:38 GMT+0000 (GMT)
received phase 1, message 4 at Thu Mar 02 2017 21:22:38 GMT+0000 (GMT)
phase 1 sent all messages, time:  Thu Mar 02 2017 21:22:38 GMT+0000 (GMT)
21:22:38.149 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
sending (phase 2): 0
21:22:39.347 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:39.709 Ably: Channel state for channel "rightchannel": attaching
21:22:39.722 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending (phase 2): 1
sending (phase 2): 2
sending (phase 2): 3
sending (phase 2): 4
21:22:43.635 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:43.954 Ably: Connection state: connecting
21:22:44.1 Ably: Channel state for channel "rightchannel": attaching
21:22:44.12 Ably: Connection state: connected
received phase 2, message 0 at Thu Mar 02 2017 21:22:44 GMT+0000 (GMT)
received phase 2, message 1 at Thu Mar 02 2017 21:22:44 GMT+0000 (GMT)
received phase 2, message 2 at Thu Mar 02 2017 21:22:44 GMT+0000 (GMT)
received phase 2, message 3 at Thu Mar 02 2017 21:22:44 GMT+0000 (GMT)
received phase 2, message 4 at Thu Mar 02 2017 21:22:44 GMT+0000 (GMT)
21:22:44.35 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:22:46.12 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:22:46.13 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:22:46.13 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:46.13 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:46.13 Ably: Channel state for channel "resume1": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_active_with_web_socket_binary_transport
21:22:46.27 Ably: Connection state: connecting
21:22:46.28 Ably: Channel state for channel "resume1": attaching
21:22:46.90 Ably: Connection state: connected
21:22:46.101 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:46.101 Ably: Channel state for channel "resume1": attached
sending phase 1, message 0 at Thu Mar 02 2017 21:22:46 GMT+0000 (GMT)
received phase 1, message 0 at Thu Mar 02 2017 21:22:46 GMT+0000 (GMT)
sending phase 1, message 1 at Thu Mar 02 2017 21:22:46 GMT+0000 (GMT)
received phase 1, message 1 at Thu Mar 02 2017 21:22:46 GMT+0000 (GMT)
sending phase 1, message 2 at Thu Mar 02 2017 21:22:47 GMT+0000 (GMT)
received phase 1, message 2 at Thu Mar 02 2017 21:22:47 GMT+0000 (GMT)
21:22:47.979 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:48.281 Ably: Channel state for channel "rightchannel": attaching
21:22:48.295 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 1, message 3 at Thu Mar 02 2017 21:22:48 GMT+0000 (GMT)
received phase 1, message 3 at Thu Mar 02 2017 21:22:48 GMT+0000 (GMT)
sending phase 1, message 4 at Thu Mar 02 2017 21:22:49 GMT+0000 (GMT)
received phase 1, message 4 at Thu Mar 02 2017 21:22:49 GMT+0000 (GMT)
phase 1 sent all messages, time:  Thu Mar 02 2017 21:22:49 GMT+0000 (GMT)
21:22:49.412 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:22:49.710 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
sending (phase 2): 0
sending (phase 2): 1
sending (phase 2): 2
sending (phase 2): 3
21:22:54.2 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
sending (phase 2): 4
21:22:54.346 Ably: Channel state for channel "rightchannel": attaching
21:22:54.361 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:22:55.218 Ably: Connection state: connecting
21:22:55.278 Ably: Connection state: connected
received phase 2, message 0 at Thu Mar 02 2017 21:22:55 GMT+0000 (GMT)
received phase 2, message 1 at Thu Mar 02 2017 21:22:55 GMT+0000 (GMT)
received phase 2, message 2 at Thu Mar 02 2017 21:22:55 GMT+0000 (GMT)
received phase 2, message 3 at Thu Mar 02 2017 21:22:55 GMT+0000 (GMT)
received phase 2, message 4 at Thu Mar 02 2017 21:22:55 GMT+0000 (GMT)
21:22:57.280 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:22:57.281 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:22:57.281 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:57.281 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:57.281 Ably: Channel state for channel "resume1": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_active_with_web_socket_text_transport
21:22:57.296 Ably: Connection state: connecting
21:22:57.296 Ably: Channel state for channel "resume1": attaching
21:22:57.382 Ably: Connection state: connected
21:22:57.440 Ably: PresenceMap.setInProgress(): inProgress = false
21:22:57.440 Ably: Channel state for channel "resume1": attached
sending phase 1, message 0 at Thu Mar 02 2017 21:22:57 GMT+0000 (GMT)
received phase 1, message 0 at Thu Mar 02 2017 21:22:57 GMT+0000 (GMT)
sending phase 1, message 1 at Thu Mar 02 2017 21:22:58 GMT+0000 (GMT)
received phase 1, message 1 at Thu Mar 02 2017 21:22:58 GMT+0000 (GMT)
21:22:58.281 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:22:58.636 Ably: Channel state for channel "rightchannel": attaching
21:22:58.665 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 1, message 2 at Thu Mar 02 2017 21:22:59 GMT+0000 (GMT)
received phase 1, message 2 at Thu Mar 02 2017 21:22:59 GMT+0000 (GMT)
sending phase 1, message 3 at Thu Mar 02 2017 21:22:59 GMT+0000 (GMT)
received phase 1, message 3 at Thu Mar 02 2017 21:22:59 GMT+0000 (GMT)
sending phase 1, message 4 at Thu Mar 02 2017 21:23:00 GMT+0000 (GMT)
received phase 1, message 4 at Thu Mar 02 2017 21:23:00 GMT+0000 (GMT)
phase 1 sent all messages, time:  Thu Mar 02 2017 21:23:00 GMT+0000 (GMT)
21:23:0.750 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
sending (phase 2): 0
sending (phase 2): 1
21:23:2.979 Ably: Channel state for channel "rightchannel": attaching
21:23:2.992 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending (phase 2): 2
21:23:4.346 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
sending (phase 2): 3
21:23:4.710 Ably: Channel state for channel "rightchannel": attaching
21:23:4.723 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending (phase 2): 4
21:23:6.558 Ably: Connection state: connecting
21:23:6.641 Ably: Connection state: connected
received phase 2, message 0 at Thu Mar 02 2017 21:23:06 GMT+0000 (GMT)
received phase 2, message 1 at Thu Mar 02 2017 21:23:06 GMT+0000 (GMT)
received phase 2, message 2 at Thu Mar 02 2017 21:23:06 GMT+0000 (GMT)
received phase 2, message 3 at Thu Mar 02 2017 21:23:06 GMT+0000 (GMT)
received phase 2, message 4 at Thu Mar 02 2017 21:23:06 GMT+0000 (GMT)
21:23:8.637 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:8.641 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:8.643 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:23:8.643 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:8.643 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:8.643 Ably: Channel state for channel "resume1": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_active_with_comet_binary_transport
21:23:8.645 Ably: Connection state: connecting
21:23:8.645 Ably: Channel state for channel "resume1": attaching
21:23:8.724 Ably: Connection state: connected
21:23:8.783 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:8.783 Ably: Channel state for channel "resume1": attached
sending phase 1, message 0 at Thu Mar 02 2017 21:23:08 GMT+0000 (GMT)
received phase 1, message 0 at Thu Mar 02 2017 21:23:08 GMT+0000 (GMT)
21:23:9.2 Ably: Channel state for channel "rightchannel": attaching
21:23:9.23 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending phase 1, message 1 at Thu Mar 02 2017 21:23:09 GMT+0000 (GMT)
received phase 1, message 1 at Thu Mar 02 2017 21:23:09 GMT+0000 (GMT)
sending phase 1, message 2 at Thu Mar 02 2017 21:23:10 GMT+0000 (GMT)
received phase 1, message 2 at Thu Mar 02 2017 21:23:10 GMT+0000 (GMT)
sending phase 1, message 3 at Thu Mar 02 2017 21:23:11 GMT+0000 (GMT)
received phase 1, message 3 at Thu Mar 02 2017 21:23:11 GMT+0000 (GMT)
sending phase 1, message 4 at Thu Mar 02 2017 21:23:12 GMT+0000 (GMT)
received phase 1, message 4 at Thu Mar 02 2017 21:23:12 GMT+0000 (GMT)
phase 1 sent all messages, time:  Thu Mar 02 2017 21:23:12 GMT+0000 (GMT)
21:23:12.133 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
sending (phase 2): 0
21:23:12.979 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:13.282 Ably: Channel state for channel "rightchannel": attaching
21:23:13.296 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
sending (phase 2): 1
21:23:14.711 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
sending (phase 2): 2
sending (phase 2): 3
sending (phase 2): 4
21:23:17.942 Ably: Connection state: connecting
21:23:18.39 Ably: Connection state: connected
received phase 2, message 0 at Thu Mar 02 2017 21:23:18 GMT+0000 (GMT)
received phase 2, message 1 at Thu Mar 02 2017 21:23:18 GMT+0000 (GMT)
received phase 2, message 2 at Thu Mar 02 2017 21:23:18 GMT+0000 (GMT)
received phase 2, message 3 at Thu Mar 02 2017 21:23:18 GMT+0000 (GMT)
received phase 2, message 4 at Thu Mar 02 2017 21:23:18 GMT+0000 (GMT)
21:23:19.2 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:19.347 Ably: Channel state for channel "rightchannel": attaching
21:23:19.361 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:20.40 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:20.41 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:23:20.41 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.41 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.42 Ably: Channel state for channel "resume1": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_active_with_comet_text_transport
21:23:20.43 Ably: Connection state: connecting
21:23:20.101 Ably: Connection state: connected
21:23:20.101 Ably: Channel state for channel "resume_lost_continuity_attached": attaching
21:23:20.205 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.205 Ably: Channel state for channel "resume_lost_continuity_attached": attached
21:23:20.205 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:20.205 Ably: Connection state: connecting
21:23:20.265 Ably: ConnectionManager.activateTransport(): error = [ErrorInfo: Unable to recover connection: not found (ablyjs_test_fake); statusCode=400; code=80008]
21:23:20.265 Ably: Connection state: connected; reason: Unable to recover connection: not found (ablyjs_test_fake), code: 80008
21:23:20.265 Ably: Channel state for channel "resume_lost_continuity_attached": attaching
21:23:20.266 Ably: Channel state for channel "resume_lost_continuity_suspended": attaching
21:23:20.266 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:20.267 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:23:20.267 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.267 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.267 Ably: Channel state for channel "resume_lost_continuity_attached": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:23:20.267 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.267 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.267 Ably: Channel state for channel "resume_lost_continuity_suspended": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_lost_continuity_with_web_socket_binary_transport
21:23:20.282 Ably: Connection state: connecting
21:23:20.364 Ably: Connection state: connected
21:23:20.364 Ably: Channel state for channel "resume_lost_continuity_attached": attaching
21:23:20.385 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.385 Ably: Channel state for channel "resume_lost_continuity_attached": attached
21:23:20.385 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:20.386 Ably: Connection state: connecting
21:23:20.466 Ably: ConnectionManager.activateTransport(): error = [ErrorInfo: Unable to recover connection: not found (ablyjs_test_fake); statusCode=400; code=80008]
21:23:20.467 Ably: Connection state: connected; reason: Unable to recover connection: not found (ablyjs_test_fake), code: 80008
21:23:20.467 Ably: Channel state for channel "resume_lost_continuity_attached": attaching
21:23:20.467 Ably: Channel state for channel "resume_lost_continuity_suspended": attaching
21:23:20.468 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:20.468 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:23:20.468 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.468 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.468 Ably: Channel state for channel "resume_lost_continuity_attached": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:23:20.468 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.468 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.468 Ably: Channel state for channel "resume_lost_continuity_suspended": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_lost_continuity_with_web_socket_text_transport
21:23:20.486 Ably: Connection state: connecting
21:23:20.570 Ably: Connection state: connected
21:23:20.570 Ably: Channel state for channel "resume_lost_continuity_attached": attaching
21:23:20.629 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.629 Ably: Channel state for channel "resume_lost_continuity_attached": attached
21:23:20.629 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:20.630 Ably: Connection state: connecting
21:23:20.715 Ably: ConnectionManager.activateTransport(): error = [ErrorInfo: Unable to recover connection: not found (ablyjs_test_fake); statusCode=400; code=80008]
21:23:20.715 Ably: Connection state: connected; reason: Unable to recover connection: not found (ablyjs_test_fake), code: 80008
21:23:20.715 Ably: Channel state for channel "resume_lost_continuity_attached": attaching
21:23:20.717 Ably: Channel state for channel "resume_lost_continuity_suspended": attaching
21:23:20.718 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:20.719 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:23:20.719 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.719 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.719 Ably: Channel state for channel "resume_lost_continuity_attached": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:23:20.719 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.719 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.719 Ably: Channel state for channel "resume_lost_continuity_suspended": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_lost_continuity_with_comet_binary_transport
21:23:20.720 Ably: Connection state: connecting
21:23:20.781 Ably: CometTransport.sendItems(): on complete: err = {"statusCode":404,"code":40400,"message":"Unable to find connection: xb_2q0DLEmtTvgfl","serverId":"frontend.7e9b.2.eu-west-2-A.i-09a6af679d7326e29"}
21:23:20.783 Ably: CometTransport.sendItems(): on complete: err = {"code":"ECONNRESET"}
21:23:20.800 Ably: Connection state: connected
21:23:20.800 Ably: Channel state for channel "resume_lost_continuity_attached": attaching
21:23:20.869 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.869 Ably: Channel state for channel "resume_lost_continuity_attached": attached
21:23:20.870 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:20.870 Ably: Connection state: connecting
21:23:20.954 Ably: ConnectionManager.activateTransport(): error = [ErrorInfo: Unable to recover connection: not found (ablyjs_test_fake); statusCode=400; code=80008]
21:23:20.954 Ably: Connection state: connected; reason: Unable to recover connection: not found (ablyjs_test_fake), code: 80008
21:23:20.955 Ably: Channel state for channel "resume_lost_continuity_attached": attaching
21:23:20.956 Ably: Channel state for channel "resume_lost_continuity_suspended": attaching
21:23:20.956 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:20.960 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:23:20.960 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.960 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.960 Ably: Channel state for channel "resume_lost_continuity_attached": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
21:23:20.960 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.960 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:20.960 Ably: Channel state for channel "resume_lost_continuity_suspended": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” resume_lost_continuity_with_comet_text_transport
21:23:20.961 Ably: Connection state: connecting
21:23:21.28 Ably: CometTransport.sendItems(): on complete: err = {"statusCode":404,"code":40400,"message":"Unable to find connection: FUizl6Pl2DqDUQ1j","serverId":"frontend.e652.1.eu-west-2-A.i-09a6af679d7326e29"}
21:23:21.115 Ably: Connection state: connected
21:23:21.212 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:21.212 Ably: Connection state: connecting
21:23:21.274 Ably: Connection state: disconnected; reason: Token expired, code: 40142
21:23:22.211 Ably: Connection state: connecting
21:23:22.380 Ably: Connection state: connected
21:23:22.381 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:22.381 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” resume_token_error_with_web_socket_binary_transport
21:23:22.394 Ably: Connection state: connecting
21:23:22.566 Ably: Connection state: connected
21:23:22.662 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:22.663 Ably: Connection state: connecting
21:23:22.744 Ably: Connection state: disconnected; reason: Token expired, code: 40142
21:23:23.283 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:23.636 Ably: Channel state for channel "rightchannel": attaching
21:23:23.662 Ably: Connection state: connecting
21:23:23.665 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:23.817 Ably: Connection state: connected
21:23:23.817 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:23.817 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” resume_token_error_with_web_socket_text_transport
21:23:23.831 Ably: Connection state: connecting
21:23:24.5 Ably: Connection state: connected
21:23:24.102 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:24.103 Ably: Connection state: connecting
21:23:24.367 Ably: Connection state: connected
21:23:24.368 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:24.370 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” resume_token_error_with_comet_binary_transport
21:23:24.372 Ably: Connection state: connecting
21:23:24.549 Ably: Connection state: connected
21:23:24.646 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:24.646 Ably: Connection state: connecting
21:23:24.892 Ably: Connection state: connected
21:23:24.892 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:24.896 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” resume_token_error_with_comet_text_transport
21:23:24.897 Ably: Connection state: connecting
21:23:24.961 Ably: Connection state: connected
21:23:24.961 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:24.961 Ably: Connection state: connecting
21:23:25.28 Ably: Connection state: failed; reason: Provided key secret value does not match, code: 40101
No transport established; closing connection and calling test.done()
21:23:25.29 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:25.29 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” resume_fatal_error_with_web_socket_binary_transport
21:23:25.30 Ably: Connection state: connecting
21:23:25.103 Ably: Connection state: connected
21:23:25.104 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:25.104 Ably: Connection state: connecting
21:23:25.158 Ably: Connection state: failed; reason: Provided key secret value does not match, code: 40101
No transport established; closing connection and calling test.done()
21:23:25.158 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:25.158 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” resume_fatal_error_with_web_socket_text_transport
21:23:25.159 Ably: Connection state: connecting
21:23:25.238 Ably: Connection state: connected
21:23:25.240 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:25.240 Ably: Connection state: connecting
21:23:25.310 Ably: Connection state: failed; reason: Provided key secret value does not match, code: 40101
No transport established; closing connection and calling test.done()
21:23:25.310 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:25.310 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” resume_fatal_error_with_comet_binary_transport
21:23:25.311 Ably: Connection state: connecting
21:23:25.398 Ably: Connection state: connected
21:23:25.401 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:25.401 Ably: Connection state: connecting
21:23:25.469 Ably: Connection state: failed; reason: Provided key secret value does not match, code: 40101
No transport established; closing connection and calling test.done()
21:23:25.469 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:25.469 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” resume_fatal_error_with_comet_text_transport
21:23:25.470 Ably: Connection state: connecting
21:23:25.550 Ably: Connection state: connected
21:23:25.550 Ably: Channel state for channel "channel_resumed_flag": attaching
21:23:25.699 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:25.699 Ably: Channel state for channel "channel_resumed_flag": attached
21:23:25.700 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:25.700 Ably: Connection state: connecting
21:23:25.701 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:23:25.701 Ably: Channel state for channel "channel_resumed_flag": suspended; reason: [ErrorInfo: Connection to server unavailable; statusCode=400; code=80002]
21:23:25.701 Ably: Connection state: connecting
21:23:25.797 Ably: Connection state: connected
21:23:25.798 Ably: Channel state for channel "channel_resumed_flag": attaching
21:23:25.896 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:25.896 Ably: Channel state for channel "channel_resumed_flag": attached
No transport established; closing connection and calling test.done()
21:23:25.897 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:25.897 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:23:25.897 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:25.897 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:25.897 Ably: Channel state for channel "channel_resumed_flag": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” channel_resumed_flag
21:23:25.898 Ably: Connection state: connecting
21:23:25.914 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:25.973 Ably: Connection state: connected
21:23:25.975 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:23:25.975 Ably: Connection state: connecting
21:23:25.975 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:23:25.976 Ably: Connection state: connecting
No transport established; closing connection and calling test.done()
21:23:25.976 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:23:25.976 Ably: Connection state: closed; reason: Connection closed, code: 80017
âœ” no_resume_once_suspended

[1msync.test.js[22m
âœ” setupSync
21:23:25.979 Ably: PresenceMap.setInProgress(): inProgress = true
21:23:25.979 Ably: Channel state for channel "syncexistingset": attached
21:23:25.980 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:25.981 Ably: PresenceMap.setInProgress(): inProgress = true
21:23:25.982 Ably: PresenceMap.setInProgress(): inProgress = false
âœ” sync_existing_set
21:23:25.983 Ably: PresenceMap.setInProgress(): inProgress = true
21:23:25.983 Ably: Channel state for channel "sync_member_arrives_in_middle": attached
21:23:25.983 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:25.983 Ably: PresenceMap.setInProgress(): inProgress = true
21:23:25.983 Ably: PresenceMap.setInProgress(): inProgress = false
âœ” sync_member_arrives_in_middle
21:23:25.984 Ably: PresenceMap.setInProgress(): inProgress = true
21:23:25.984 Ably: Channel state for channel "sync_member_arrives_normally_after_came_in_sync": attached
21:23:25.984 Ably: PresenceMap.setInProgress(): inProgress = false
âœ” sync_member_arrives_normally_after_came_in_sync
21:23:25.985 Ably: PresenceMap.setInProgress(): inProgress = true
21:23:25.985 Ably: Channel state for channel "sync_member_arrives_normally_before_comes_in_sync": attached
21:23:25.985 Ably: PresenceMap.setInProgress(): inProgress = false
âœ” sync_member_arrives_normally_before_comes_in_sync
21:23:25.986 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:25.986 Ably: Channel state for channel "sync_ordering": attached
âœ” presence_ordering
21:23:25.988 Ably: Connection state: connecting
21:23:25.988 Ably: Connection state: connecting
21:23:26.75 Ably: Connection state: connected
21:23:26.75 Ably: Channel state for channel "presence_sync_interruptus": attaching
21:23:26.84 Ably: Connection state: connected
21:23:26.234 Ably: PresenceMap.setInProgress(): inProgress = false
21:23:26.234 Ably: Channel state for channel "presence_sync_interruptus": attached
21:23:26.250 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:26.472 Ably: Channel state for channel "presence_sync_interruptus": attaching
21:23:26.493 Ably: PresenceMap.setInProgress(): inProgress = true
21:23:26.493 Ably: Channel state for channel "presence_sync_interruptus": attached
21:23:26.534 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:26.542 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:27.981 Ably: Channel state for channel "rightchannel": attaching
21:23:27.993 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:29.347 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:29.711 Ably: Channel state for channel "rightchannel": attaching
21:23:29.723 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:33.637 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:34.3 Ably: Channel state for channel "rightchannel": attaching
21:23:34.34 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:37.982 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:38.283 Ably: Channel state for channel "rightchannel": attaching
21:23:38.297 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:39.711 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:40.763 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:23:40.764 Ably: Connection state: disconnected; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:23:40.764 Ably: Connection state: connecting
21:23:40.848 Ably: Connection state: connected
21:23:44.4 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:44.348 Ably: Channel state for channel "rightchannel": attaching
21:23:44.362 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:46.123 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:23:46.125 Ably: Connection state: disconnected; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:23:46.125 Ably: Connection state: connecting
21:23:46.221 Ably: Connection state: connected
21:23:48.283 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:48.638 Ably: Channel state for channel "rightchannel": attaching
21:23:48.665 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:52.981 Ably: Channel state for channel "rightchannel": attaching
21:23:52.993 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:54.349 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:54.712 Ably: Channel state for channel "rightchannel": attaching
21:23:54.724 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:23:58.639 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:23:59.3 Ably: Channel state for channel "rightchannel": attaching
21:23:59.28 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:2.982 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:3.283 Ably: Channel state for channel "rightchannel": attaching
21:24:3.297 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:4.712 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:9.3 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:9.350 Ably: Channel state for channel "rightchannel": attaching
21:24:9.364 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:13.285 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:13.639 Ably: Channel state for channel "rightchannel": attaching
21:24:13.665 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:17.984 Ably: Channel state for channel "rightchannel": attaching
21:24:17.997 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:19.351 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:19.713 Ably: Channel state for channel "rightchannel": attaching
21:24:19.724 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:23.639 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:24.4 Ably: Channel state for channel "rightchannel": attaching
21:24:24.28 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
[31mâœ– presence_sync_interruptus[39m

Assertion Message: [35mTest timed out after 60s[39m
AssertionError: false == true
    at Object.ok (/mnt/terra/home/simon/ably/ably-js/node_modules/nodeunit/lib/types.js:83:39)
    at Timeout.<anonymous> (/mnt/terra/home/simon/ably/ably-js/spec/common/modules/shared_helper.js:142:14)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)


[1mtmp.test.js[22m
âœ” setupauth
21:24:26.10 Ably: Connection state: connecting
21:24:26.108 Ably: Connection state: connected
21:24:26.109 Ably: Channel state for channel "channel_resumed_flag": attaching
21:24:26.207 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:26.207 Ably: Channel state for channel "channel_resumed_flag": attached
21:24:26.209 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:24:26.209 Ably: Connection state: connecting
21:24:26.209 Ably: Connection state: suspended; reason: Connection to server unavailable, code: 80002
21:24:26.209 Ably: Channel state for channel "channel_resumed_flag": suspended; reason: [ErrorInfo: Connection to server unavailable; statusCode=400; code=80002]
21:24:26.210 Ably: Connection state: connecting
21:24:26.298 Ably: Connection state: connected
21:24:26.298 Ably: Channel state for channel "channel_resumed_flag": attaching
21:24:26.376 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:26.376 Ably: Channel state for channel "channel_resumed_flag": attached
No transport established; closing connection and calling test.done()
21:24:26.377 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:26.377 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:26.377 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:26.377 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:26.377 Ably: Channel state for channel "channel_resumed_flag": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
âœ” channel_resumed_flag

[1mupgrade.test.js[22m
âœ” setupUpgrade
âœ” setupUpgradeRest
21:24:26.385 Ably: Connection state: connecting
21:24:26.391 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:26.470 Ably: Connection state: connected
21:24:26.471 Ably: Channel state for channel "publishpreupgrade": attaching
21:24:26.949 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:26.949 Ably: Channel state for channel "publishpreupgrade": attached
21:24:26.963 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:26.970 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:26.970 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:26.970 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:26.970 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:26.970 Ably: Channel state for channel "publishpreupgrade": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishpreupgrade
21:24:26.984 Ably: Connection state: connecting
21:24:26.984 Ably: Channel state for channel "publishpostupgrade0": attaching
21:24:27.61 Ably: Connection state: connected
21:24:27.219 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:27.219 Ably: Channel state for channel "publishpostupgrade0": attached
21:24:27.236 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:27.260 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:27.261 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:27.261 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:27.261 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:27.261 Ably: Channel state for channel "publishpostupgrade0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishpostupgrade0
21:24:27.275 Ably: Connection state: connecting
21:24:27.275 Ably: Channel state for channel "publishpostupgrade1": attaching
21:24:27.358 Ably: Connection state: connected
21:24:27.506 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:27.506 Ably: Channel state for channel "publishpostupgrade1": attached
21:24:27.527 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:27.553 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:27.554 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:27.554 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:27.554 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:27.554 Ably: Channel state for channel "publishpostupgrade1": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” publishpostupgrade1
21:24:27.570 Ably: Connection state: connecting
21:24:27.570 Ably: Channel state for channel "upgradepublish0": attaching
21:24:27.652 Ably: Connection state: connected
21:24:27.821 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:27.821 Ably: Channel state for channel "upgradepublish0": attached
21:24:27.840 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:27.851 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:27.852 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:27.852 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:27.852 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:27.852 Ably: Channel state for channel "upgradepublish0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” upgradepublish0
21:24:27.869 Ably: Connection state: connecting
21:24:27.869 Ably: Channel state for channel "upgradepublish1": attaching
21:24:27.945 Ably: Connection state: connected
21:24:27.984 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:28.194 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:28.194 Ably: Channel state for channel "upgradepublish1": attached
21:24:28.208 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:28.223 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:28.224 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:28.224 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:28.224 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:28.224 Ably: Channel state for channel "upgradepublish1": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” upgradepublish1
21:24:28.225 Ably: Connection state: connecting
21:24:28.286 Ably: Channel state for channel "rightchannel": attaching
21:24:28.300 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:28.310 Ably: Connection state: connected
21:24:28.390 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:28.390 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” upgradebase0
21:24:28.405 Ably: Connection state: connecting
21:24:28.505 Ably: Connection state: connected
21:24:28.580 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:28.581 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” upgradeheartbeat0
21:24:28.593 Ably: Connection state: connecting
21:24:28.674 Ably: Connection state: connected
21:24:28.757 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:28.758 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” upgradeheartbeat1
21:24:28.771 Ably: Connection state: connecting
21:24:28.850 Ably: Connection state: connected
21:24:29.713 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:30.938 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:30.938 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” upgradeheartbeat2
21:24:30.954 Ably: Connection state: connecting
21:24:31.39 Ably: Connection state: connected
21:24:33.128 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:33.129 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” upgradeheartbeat3
21:24:33.143 Ably: Connection state: connecting
21:24:33.221 Ably: Connection state: connected
21:24:33.279 Ably: ConnectionManager.scheduleTransportActivation(): Upgrade resulted in new connectionId; resetting library connectionSerial from -1 to -1; upgrade error was [ErrorInfo: Unable to recover connection: not found (ablyjs_test_fake); statusCode=400; code=80008]
21:24:33.290 Ably: ConnectionManager.activateTransport(): error = [ErrorInfo: Unable to recover connection: not found (ablyjs_test_fake); statusCode=400; code=80008]
21:24:33.292 Ably: Channel state for channel "unrecoverableUpgrade": attaching
21:24:33.395 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:33.395 Ably: Channel state for channel "unrecoverableUpgrade": attached
21:24:33.409 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:33.409 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:33.409 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:33.409 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:33.409 Ably: Channel state for channel "unrecoverableUpgrade": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” unrecoverableUpgrade
21:24:33.422 Ably: Connection state: connecting
21:24:33.506 Ably: Connection state: connected
21:24:33.506 Ably: Channel state for channel "timeout0": attaching
21:24:34.4 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:34.352 Ably: Channel state for channel "rightchannel": attaching
21:24:34.367 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:36.507 Ably: Channel state for channel "timeout0": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:36.507 Ably: Channel state for channel "timeout0": attaching
21:24:36.709 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:36.709 Ably: Channel state for channel "timeout0": attached
21:24:36.709 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:36.709 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:36.709 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:36.709 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:36.709 Ably: Channel state for channel "timeout0": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” attach_timeout_on_base_transport
21:24:36.724 Ably: Connection state: connecting
21:24:36.814 Ably: Connection state: connected
21:24:36.814 Ably: Channel state for channel "timeout1": attaching
21:24:37.42 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:37.43 Ably: Channel state for channel "timeout1": attached
21:24:37.58 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:37.74 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:37.74 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:37.74 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:37.74 Ably: PresenceMap.setInProgress(): inProgress = false
21:24:37.74 Ably: Channel state for channel "timeout1": detached; reason: [ErrorInfo: Connection closed; statusCode=400; code=80017]
Transport disposed; calling test.done()
âœ” message_timeout_stalling_upgrade
21:24:37.87 Ably: Connection state: connecting
21:24:37.169 Ably: Connection state: connected
21:24:38.286 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:38.639 Ably: Channel state for channel "rightchannel": attaching
21:24:38.666 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:24:38.666 Ably: Connection state: disconnected; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:24:38.667 Ably: Connection state: connecting
21:24:38.751 Ably: Connection state: connected
21:24:38.751 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:38.829 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:39.234 Ably: ConnectionManager.scheduleTransportActivation(): Unexpected error attempting to sync transport; transport = WebSocketTransport; uri=wss://sandbox-realtime.ably.io:443/?key=_tmp_TJxY7g.doSiEA:yUO2foIMQulk6Oh0&upgrade=e02YvIeQgA4Y6F!LN7hyRU_9LnbQTji-1100e02YvIeQgA4Y6F&format=msgpack&heartbeats=true&v=1.0&lib=js-0.9.0-beta.9; err = [ErrorInfo: Timeout waiting for sync response; statusCode=500; code=50000]
21:24:39.235 Ably: Connection state: disconnected; reason: Connection to server temporarily unavailable, code: 80003
21:24:39.236 Ably: Connection state: connecting
21:24:39.320 Ably: Connection state: connected
21:24:39.392 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:39.392 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” unresponsive_upgrade_sync
21:24:39.407 Ably: Connection state: connecting
21:24:39.493 Ably: Connection state: connected
21:24:39.571 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:39.572 Ably: Connection state: closed; reason: Connection closed, code: 80017
21:24:39.572 Ably: Connection state: connecting
21:24:39.629 Ably: Connection state: connected
21:24:39.629 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:39.629 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” persist_transport_prefs
21:24:39.642 Ably: Connection state: connecting
21:24:39.721 Ably: Connection state: connected
21:24:39.779 Ably: Connection state: connecting; reason: a non-fatal transport error, code: 50000
21:24:39.790 Ably: Connection state: connected
21:24:39.790 Ably: Connection state: closing; reason: Connection closing, code: 80017
21:24:39.791 Ably: Connection state: closed; reason: Connection closed, code: 80017
Transport disposed; calling test.done()
âœ” upgrade_original_transport_dies

[1mauth.test.js[22m
âœ” setupauth
âœ” authbase0
âœ” authbase1
âœ” authbase2
âœ” authtime0
21:24:40.249 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 401,
  code: 40101,
  message: 'Timestamp not current',
  serverId: 'frontend.7e9b.2.eu-west-2-A.i-09a6af679d7326e29' }
âœ” authtime1
âœ” authtime2
21:24:40.551 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 401,
  code: 40101,
  message: 'Nonce value replayed',
  serverId: 'frontend.7e9b.2.eu-west-2-A.i-09a6af679d7326e29' }
âœ” authnonce0
âœ” authclientid0
21:24:40.647 Ably: Auth.requestToken(): token request signing call returned error; err = [ErrorInfo: clientId canâ€™t be an empty string; statusCode=400; code=40012]
âœ” authemptyclientid
âœ” authcapability0
âœ” authkey0
âœ” authexplicit_simple
âœ” authexplicit_key
21:24:41.131 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 401,
  code: 40101,
  message: 'Request mac does not match',
  serverId: 'frontend.e652.1.eu-west-2-A.i-09a6af679d7326e29' }
âœ” authmac0
âœ” authdefaulttokenparams0
âœ” authdefaulttokenparams1
âœ” authauthorize
âœ” authttl0
21:24:41.625 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 400,
  code: 40003,
  message: 'Excessive value for ttl',
  serverId: 'frontend.7e9b.2.eu-west-2-A.i-09a6af679d7326e29' }
âœ” authttl1
21:24:41.721 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 400,
  code: 40003,
  message: 'Invalid value for ttl (-1)',
  serverId: 'frontend.e652.1.eu-west-2-A.i-09a6af679d7326e29' }
âœ” authttl2
21:24:41.818 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 400,
  code: 40003,
  message: 'Invalid value for ttl (NaN)',
  serverId: 'frontend.e652.1.eu-west-2-A.i-09a6af679d7326e29' }
âœ” authttl3
âœ” auth_createTokenRequest_given_key
âœ” auth_createTokenRequest_params0
âœ” auth_createTokenRequest_params1
âœ” auth_createTokenRequest_given_key2
âœ” auth_createTokenRequest_capability_object

[1mcapability.test.js[22m
âœ” setupcapability
âœ” authcapability0
âœ” authcapability1
21:24:42.150 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 401,
  code: 40160,
  message: 'Key does not support requested capabilities',
  serverId: 'frontend.e652.1.eu-west-2-A.i-09a6af679d7326e29' }
âœ” authcapability2
21:24:42.259 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 401,
  code: 40160,
  message: 'Key does not support requested capabilities',
  serverId: 'frontend.e652.1.eu-west-2-A.i-09a6af679d7326e29' }
âœ” authcapability3
âœ” authcapability4
âœ” authcapability5
âœ” authcapability6
âœ” authcapability7
âœ” authcapability8
âœ” authcapability9
21:24:42.985 Ably: Channel state for channel "rightchannel": attaching
âœ” authcapability10
21:24:42.997 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:43.92 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 400,
  code: 40000,
  message: 'Malformed capability',
  serverId: 'frontend.7e9b.2.eu-west-2-A.i-09a6af679d7326e29' }
âœ” invalid0
21:24:43.188 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 400,
  code: 40000,
  message: 'Malformed capability',
  serverId: 'frontend.e652.1.eu-west-2-A.i-09a6af679d7326e29' }
âœ” invalid1
21:24:43.284 Ably: Auth.requestToken(): token request API call returned error; err = { statusCode: 400,
  code: 40000,
  message: 'Malformed capability',
  serverId: 'frontend.e652.1.eu-west-2-A.i-09a6af679d7326e29' }
âœ” invalid2

[1mdefaults.test.js[22m
âœ” defaults_no_opts
âœ” defaults_production
âœ” defaults_given_environment
âœ” defaults_local_ports
âœ” defaults_given_host
âœ” defaults_given_realtimehost
âœ” defaults_given_host_using_default_fallbacks
21:24:43.292 Ably: Deprecation warning - 'host' is deprecated and will be removed from a future version. Please use 'restHost' instead.
21:24:43.293 Ably: Deprecation warning - 'wsHost' is deprecated and will be removed from a future version. Please use 'realtimeHost' instead.
âœ” defaults_given_deprecated_host
âœ” defaults_set_default_environment

[1mhistory.test.js[22m
âœ” setup_history
21:24:44.353 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
âœ” history_simple
21:24:44.713 Ably: Channel state for channel "rightchannel": attaching
21:24:44.728 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
âœ” history_multiple
âœ” history_simple_paginated_b
21:24:48.507 Ably: CometTransport.sendItems(): on complete: err = {"statusCode":400,"code":80000,"message":"Cancelled"}
21:24:48.639 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
âœ” history_simple_paginated_f
21:24:49.4 Ably: Channel state for channel "rightchannel": attaching
21:24:49.29 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:24:49.29 Ably: Connection state: disconnected; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:24:49.30 Ably: Connection state: connecting
21:24:49.129 Ably: Connection state: connected
21:24:49.129 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
21:24:49.187 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
âœ” history_multiple_paginated_b
21:24:50.848 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:24:50.849 Ably: Connection state: disconnected; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:24:50.850 Ably: Connection state: connecting
21:24:50.929 Ably: Connection state: connected
âœ” history_multiple_paginated_f
21:24:52.986 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:53.84 Ably: Message.fromResponseBody(): [ErrorInfo: Error processing the utf-8 encoding, decoder returned â€˜Expected input of utf8Decode to be a buffer or CryptoJS WordArrayâ€™; statusCode=400; code=40013]
âœ” history_encoding_errors

[1mhttp.test.js[22m
âœ” setupHttp
âœ” apiVersionHeader

[1minit.test.js[22m
âœ” setupInit
âœ” init_key_string
âœ” init_token_string
âœ” init_tls_false
âœ” init_tls_true
âœ” init_tls_absent
âœ” init_wildcard_clientId

[1mmessage.test.js[22m
âœ” setupInit
21:24:53.286 Ably: Channel state for channel "rightchannel": attaching
21:24:53.301 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
âœ” rest_implicit_client_id_0
âœ” rest_explicit_client_id_0
âœ” rest_explicit_client_id_1

[1mpresence.test.js[22m
âœ” setup_presence
âœ” presence_get_simple
âœ” presence_history_simple
âœ” presence_message_json_serialisation
âœ” presence_get_limits_and_filtering

[1mrequest.test.js[22m
âœ” setuptime
âœ” request_time
21:24:54.463 Ably: PaginatedResource.handlePage(): Unexpected error getting resource: err = {"statusCode":404,"code":40400,"message":"No application found with id ablyjs","serverId":"frontend.7e9b.2.eu-west-2-A.i-09a6af679d7326e29"}
âœ” request_404
21:24:54.714 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
âœ” request_post_get_messages

[1mstats.test.js[22m
21:24:56.209 Ably: Transport.resetIdleTimeout(): No activity seen from realtime in 25000ms; assuming connection has dropped
21:24:56.211 Ably: Connection state: disconnected; reason: No activity seen from realtime in 25000ms; assuming connection has dropped, code: 80003
21:24:56.211 Ably: Connection state: connecting
21:24:56.308 Ably: Connection state: connected
Test App _tmp_TJxY7g has been torn down
21:24:59.6 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:24:59.353 Ably: Channel state for channel "rightchannel": attaching
21:24:59.367 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
Test App _tmp_CvLZyw in environment sandbox has been set up
âœ” setup_stats
âœ” appstats_minute0
âœ” appstats_minute1
âœ” appstats_hour0
âœ” appstats_day0
âœ” appstats_month0
âœ” appstats_limit_backwards
âœ” appstats_limit_forwards
âœ” appstats_pagination_backwards
âœ” appstats_pagination_forwards
âœ” appstats_pagination_omitted

[1mtime.test.js[22m
âœ” setuptime
âœ” time0

[1mtear_down.js[22m
21:25:3.287 Ably: Channel state for channel "rightchannel": suspended; reason: [ErrorInfo: Channel attach timed out; statusCode=408; code=90007]
21:25:3.639 Ably: Channel state for channel "rightchannel": attaching
21:25:3.659 Ably: ConnectionManager.onChannelMessage() received message with different connectionSerial, but same message id as a previous; discarding; id = undefined: undefined
Test App _tmp_CvLZyw has been torn down
âœ” teardownapp

[1m[31mFAILURES: [39m[22m79/3058 assertions failed (1069706ms)
[31m>> [39mNodeunit tests failed!
